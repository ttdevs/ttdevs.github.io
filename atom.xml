<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ttdevs</title>
  <subtitle>ä½ ä¹‹æ‰€ä»¥è§‰å¾—æ—¶é—´ä¸€å¹´æ¯”ä¸€å¹´è¿‡å¾—å¿«ï¼Œæ˜¯å› ä¸ºæ—¶é—´å¯¹ä½ ä¸€å¹´æ¯”ä¸€å¹´é‡è¦</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://ttdevs.github.io/"/>
  <updated>2017-07-27T07:19:01.000Z</updated>
  <id>https://ttdevs.github.io/</id>
  
  <author>
    <name>ttdevs</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>[Android]ä»é€šè¿‡view.post()è·å–Viewå®½é«˜è°ˆAndroidæ¶ˆæ¯æœºåˆ¶</title>
    <link href="https://ttdevs.github.io/2017/07/26/Android-%E4%BB%8E%E9%80%9A%E8%BF%87view-post-%E8%8E%B7%E5%8F%96View%E5%AE%BD%E9%AB%98%E8%B0%88Android%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/"/>
    <id>https://ttdevs.github.io/2017/07/26/Android-ä»é€šè¿‡view-post-è·å–Viewå®½é«˜è°ˆAndroidæ¶ˆæ¯æœºåˆ¶/</id>
    <published>2017-07-26T05:23:19.000Z</published>
    <updated>2017-07-27T07:19:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-é€šè¿‡view-post-è·å–Viewå®½é«˜"><a href="/2017/07/26/Android-ä»é€šè¿‡view-post-è·å–Viewå®½é«˜è°ˆAndroidæ¶ˆæ¯æœºåˆ¶/#0x00-é€šè¿‡view-post-è·å–Viewå®½é«˜" class="headerlink" title="0x00 é€šè¿‡view.post()è·å–Viewå®½é«˜"></a>0x00 é€šè¿‡view.post()è·å–Viewå®½é«˜</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›åœ¨ç•Œé¢åˆå§‹è¯çš„æ—¶å€™æ ¹æ®Viewçš„å°ºå¯¸æ¥åšä¸€äº›ç›¸å…³çš„æ“ä½œï¼ˆè°ƒæ•´ï¼‰ï¼Œé‚£å¦‚ä½•è·å–Viewçš„å°ºå¯¸å‘¢ï¼Ÿ</p>
<ul>
<li><p>åœ¨Activityçš„ <code>onCreate()</code> æ–¹æ³•ä¸­ delay å‡ ç™¾æ¯«ç§’<br><br>  ç”±äºæˆ‘ä»¬çŸ¥é“åœ¨ <code>onCreate()</code> ä¸­ç›´æ¥è·å–Viewçš„å°ºå¯¸å¾—åˆ°çš„å®½é«˜éƒ½æ˜¯0ï¼Œè¿™ä¸ªä¸ç»æ€è€ƒçš„ç­”æ¡ˆç›¸ä¿¡å¾ˆå¤šäººåœ¨ç”¨ã€‚</p>
</li>
<li><p>å¦‚æœä½ Googleè¿‡ç­”æ¡ˆï¼Œä¸€èˆ¬ä¼šæœ‰ä¸‹é¢è¿™å‡ ç§æ–¹æ³•ï¼š</p>
<ul>
<li><p>onWindowFocusChanged</p>
<p>  é‡å†™Activityçš„ <code>onWindowFocusChanged()</code> æ–¹æ³•ï¼Œå½“Activityçš„ç„¦ç‚¹çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•ï¼Œå‚æ•° <code>hasFocus</code> ä¸º <code>true</code> æ—¶è¡¨ç¤ºå·²ç»è·å–åˆ°ç„¦ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™Viewçš„ç»˜åˆ¶å·²ç»å®Œæˆï¼Œä¹Ÿå°±å¯ä»¥è·å–åˆ°Viewçš„å°ºå¯¸äº†ã€‚</p>
<pre><code>@Override
public void onWindowFocusChanged(boolean hasFocus) {
  super.onWindowFocusChanged(hasFocus);
  if (hasFocus) {
      System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;onWindowFocusChanged&quot; + tvLog.getWidth());
      System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;onWindowFocusChanged&quot; + tvLog.getHeight());
  }
}
</code></pre></li>
<li><p>ViewTreeObserver.addOnPreDrawListener or .addOnGlobalLayoutListener</p>
<p>  è¿™ä¸ªæ–¹æ³•çš„ç¼ºç‚¹æ˜¯ä¼šå¤šæ¬¡è°ƒç”¨ã€‚</p>
<pre><code>private void getViewSize(){
    tvLog.getViewTreeObserver().addOnPreDrawListener(new ViewTreeObserver.OnPreDrawListener() {
        @Override
        public boolean onPreDraw() {
            System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;addOnPreDrawListener&quot; + tvLog.getWidth());
            System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;addOnPreDrawListener&quot; + tvLog.getHeight());
            return true;
        }
    });
    tvLog.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {
        @Override
        public void onGlobalLayout() {
            System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;addOnGlobalLayoutListener&quot; + tvLog.getWidth());
            System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;addOnGlobalLayoutListener&quot; + tvLog.getHeight());
        }
    });
}
</code></pre></li>
<li><p>view.post()</p>
<p>  è¿™ä¸­æ–¹æ³•æ˜¯æˆ‘ä¸ªäººæ¨èçš„æ–¹æ³•ï¼Œæ¥ä¸‹æ¥çš„å†…å®¹ä¼šç€é‡åˆ†æã€‚</p>
<pre><code>private void getViewSize() {
    tvLog.post(new Runnable() {
        @Override
        public void run() {
            System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;post&quot; + tvLog.getWidth());
            System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;post&quot; + tvLog.getHeight());
        }
    });
}
</code></pre></li>
<li><p>å½“ç„¶ï¼Œè¿˜ä¼šæœ‰ä¸€äº›å…¶ä»–æ–¹æ³•ï¼Œæ¯”å¦‚æ‰‹åŠ¨measureï¼Œåœ¨Viewå†…éƒ¨è·å–ç­‰ç­‰</p>
</li>
</ul>
</li>
</ul>
<p><a href="https://stackoverflow.com/questions/3591784/getwidth-and-getheight-of-view-returns-0" target="_blank" rel="external">å¯ä»¥å‚è€ƒè¿™é‡Œ</a></p>
<p>ä»¥ä¸Šçš„å‡ ç§æ–¹æ³•éƒ½å¯ä»¥ï¼Œä¸‹é¢é’ˆå¯¹View.poståšä¸€ä¸ªåˆ†æã€‚</p>
<h2 id="0x01-Androidç³»ç»Ÿçš„æ¶ˆæ¯æœºåˆ¶"><a href="/2017/07/26/Android-ä»é€šè¿‡view-post-è·å–Viewå®½é«˜è°ˆAndroidæ¶ˆæ¯æœºåˆ¶/#0x01-Androidç³»ç»Ÿçš„æ¶ˆæ¯æœºåˆ¶" class="headerlink" title="0x01 Androidç³»ç»Ÿçš„æ¶ˆæ¯æœºåˆ¶"></a>0x01 Androidç³»ç»Ÿçš„æ¶ˆæ¯æœºåˆ¶</h2><p>Androidç³»ç»Ÿçš„æ¶ˆæ¯æœºåˆ¶ï¼Œæ˜¯æ¯ä¸ªåˆå­¦è€…éƒ½å¿…é¡»æŒæ¡çš„åŸºç¡€çŸ¥è¯†ã€‚ä»¥å‰å­¦ä¹ çš„æ—¶å€™æœ‰çœ‹è¿‡ï¼Œåˆé¢è¯•çš„æ—¶å€™ä¹Ÿå»çªå‡»è¿‡ï¼Œä½†æ˜¯éƒ½æ·±å…¥çš„å»ç†è§£å»æŒæ¡ï¼Œæƒ­æ„§å‘¢ã€‚</p>
<p>å¯¹äºä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿï¼Œå¤§å®¶å¯ä»¥ç±»æ¯”ä¸‹ç”Ÿæ´»ä¸­çš„å¿«é€’ç³»ç»Ÿï¼šæœ‰å‘ä»¶äººï¼Œæœ‰æ”¶ä»¶äººï¼Œæœ‰å¿«é€’å…¬å¸ï¼Œå½“ç„¶è¿˜æœ‰æœ€é‡è¦çš„ä¿¡ä»¶ã€‚é€šè¿‡è¿™ä¸ªç³»ç»Ÿæˆ‘ä»¬å¯ä»¥å°†ä¸åŒçš„ä¿¡ä»¶æŠ•é€åˆ°ä¸åŒçš„åœ°æ–¹ï¼Œæ¯”å¦‚ä»ä¸ªäººæŠ•é€åˆ°æ”¿åºœéƒ¨é—¨ï¼Œä»å›½å†…æŠ•é€åˆ°å›½å¤–ç­‰ã€‚ä¸‹é¢çš„è¡¨æ ¼çœ‹èµ·æ¥ä¼šæ›´ç›´è§‚ä¸€äº›ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">å¿«é€’ç³»ç»Ÿ</th>
<th style="text-align:center">Androidæ¶ˆæ¯ç³»ç»Ÿ</th>
<th style="text-align:center">èŒè´£</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">å‘ä»¶äºº</td>
<td style="text-align:center">Handler</td>
<td style="text-align:center">å‘é€æ¶ˆæ¯</td>
</tr>
<tr>
<td style="text-align:center">æ”¶ä»¶äºº</td>
<td style="text-align:center">Handler</td>
<td style="text-align:center">æ¥æ”¶å¤„ç†æ¶ˆæ¯</td>
</tr>
<tr>
<td style="text-align:center">å¿«ä»¶</td>
<td style="text-align:center">Message</td>
<td style="text-align:center">å‘é€çš„å†…å®¹</td>
</tr>
<tr>
<td style="text-align:center">å¿«é€’å…¬å¸</td>
<td style="text-align:center">Looper / MessageQueue</td>
<td style="text-align:center">æ¥æ”¶æ¶ˆæ¯ã€ä¼ é€’æ¶ˆæ¯ã€åˆ†å‘æ¶ˆæ¯</td>
</tr>
</tbody>
</table>
<p>ç›¸ä¿¡è¿™ä¸ªç®€å•çš„å¯¹æ¯”å¯¹ç†è§£æ¶ˆæ¯æœºåˆ¶ä¼šæœ‰å¾ˆå¤§å¸®åŠ©ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªç³»ç»Ÿæ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚</p>
<p>å…ˆçœ‹ä¸€ä¸‹æ¶ˆæ¯ç³»ç»Ÿçš„ç®€å•ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Handler mHandler = <span class="keyword">new</span> Handler() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.handleMessage(msg);</div><div class="line"></div><div class="line">            printMsg(<span class="string">"handleMessage:"</span> + msg.obj);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (view.getId()) &#123;</div><div class="line">            <span class="keyword">case</span> R.id.btSendMsg:</div><div class="line">                defaultSendMsg();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line"></div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">defaultSendMsg</span><span class="params">()</span> </span>&#123;</div><div class="line">        Message msg = <span class="keyword">new</span> Message();</div><div class="line">        msg.obj = <span class="string">"è¿™æ˜¯æœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•ï¼Œä½†æ— å®é™…æ„ä¹‰"</span>;</div><div class="line">        mHandler.sendMessage(msg);</div><div class="line">        printMsg(<span class="string">"Is MainLooper: "</span> + (mHandler.getLooper() == getMainLooper()));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printMsg</span><span class="params">(String msg)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;&gt;&gt;"</span> + msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">I/System.out: &gt;&gt;&gt;&gt;&gt;Is MainLooper: true</div><div class="line">I/System.out: &gt;&gt;&gt;&gt;&gt;handleMessage:è¿™æ˜¯æœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•ï¼Œä½†æ— å®é™…æ„ä¹‰</div></pre></td></tr></table></figure>
<p>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡ï¼Œç„¶åé€šè¿‡è¿™ä¸ªHandlerå‘é€æ¶ˆæ¯ï¼Œç„¶ååœ¨Handlerä¸­å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚å¦å¤–æˆ‘ä»¬è¿˜çœ‹åˆ°æˆ‘ä»¬çš„Looperå¯¹è±¡æ˜¯ä¸»çº¿ç¨‹çš„Looperï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨Activityè·‘çš„è¿™æ®µä»£ç ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è·Ÿä¸€ä¸‹ä»£ç ã€‚</p>
<p>ä»Handlerçš„æ„é€ æ–¹æ³•å¼€å§‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback, <span class="keyword">boolean</span> async)</span> </span>&#123;</div><div class="line">   ...</div><div class="line"></div><div class="line">   mLooper = Looper.myLooper();</div><div class="line">   <span class="keyword">if</span> (mLooper == <span class="keyword">null</span>) &#123;</div><div class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">           <span class="string">"Can't create handler inside thread that has not called Looper.prepare()"</span>);</div><div class="line">   &#125;</div><div class="line">   mQueue = mLooper.mQueue;</div><div class="line">   mCallback = callback; <span class="comment">// è¿™ä¸ªå¯¹è±¡æˆ‘ä»¬åœ¨åé¢çš„dispatchMessageæ—¶ä¼šç”¨åˆ°</span></div><div class="line">   mAsynchronous = async;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œé€šè¿‡ <code>Looper.myLooper()</code> è·å–åˆ°ä¸€ä¸ªLooperå¯¹è±¡ï¼Œç„¶åå†ä»è¿™ä¸ªLooperå¯¹è±¡ä¸­æ‹¿åˆ°ä¸€ä¸ªMessageQueueå¯¹è±¡ï¼ˆmQueueï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å¾ˆå®¹æ˜“å¾—åˆ°ç»“è®ºâ€”â€”æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä½äºLooperä¸­çš„ã€‚é‚£MessageQueueæ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼Œåˆæ˜¯æ€æ ·å¤„ç†æ¶ˆæ¯çš„ï¼Ÿå¸¦ç€è¿™äº›ç–‘é—®æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ <code>Handler.sendMessage(msg)</code> (<code>sendMessage()</code> æœ€ç»ˆä¼šè°ƒåˆ° <code>sendMessageAtTime()</code>)ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</div><div class="line">   MessageQueue queue = mQueue;</div><div class="line">   <span class="keyword">if</span> (queue == <span class="keyword">null</span>) &#123;</div><div class="line">       RuntimeException e = <span class="keyword">new</span> RuntimeException(</div><div class="line">               <span class="keyword">this</span> + <span class="string">" sendMessageAtTime() called with no mQueue"</span>);</div><div class="line">       Log.w(<span class="string">"Looper"</span>, e.getMessage(), e);</div><div class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(MessageQueue queue, Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</div><div class="line">   msg.target = <span class="keyword">this</span>;</div><div class="line">   <span class="keyword">if</span> (mAsynchronous) &#123;</div><div class="line">       msg.setAsynchronous(<span class="keyword">true</span>);</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>sendMessageAtTime()</code> ä¼šä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š<code>Message</code> å’Œ <code>uptimeMillis</code>ï¼Œ<code>uptimeMillis</code> çš„æ„æ€æ˜¯æ¶ˆæ¯å°†ä¼šåœ¨è¿™ä¸ªæ—¶åˆ»æ‰§è¡Œï¼ˆä¸æ˜¯éå¸¸ç²¾ç¡®ï¼‰ï¼Œè¿™ç§æƒ…å†µæ¯”å¦‚å¸¸è§çš„ <code>postDelay</code>ã€‚åœ¨ <code>enqueueMessage()</code> æ–¹æ³•ä¸­ï¼Œä¼šæ ¹æ®è¿™ä¸ªå€¼å°†æ¶ˆæ¯åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ”¾å…¥é˜Ÿåˆ—ä¹‹å‰Messageçš„ <code>target</code> è¢«è®¾ç½®ä¸ºå½“å‰çš„Handlerå¯¹è±¡â€”â€”é€éœ²ä¸‹è¿™ä¸ªæ˜¯ä¿è¯ä¹‹åæ¶ˆæ¯æŠ•é€’çš„æ—¶å€™ä»åˆ†å‘ç»™å½“å‰Handlerï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼</p>
<p>å†æ¥çœ‹ä¸‹ä¸Šé¢æåˆ°çš„ Looper å’Œ MessageQueueï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Looper</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="comment">// sThreadLocal.get() will return null unless you've called prepare().</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Looper&gt; sThreadLocal = <span class="keyword">new</span> ThreadLocal&lt;Looper&gt;();</div><div class="line">    ...</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (sThreadLocal.get() != <span class="keyword">null</span>) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Looper may be created per thread"</span>);</div><div class="line">       &#125;</div><div class="line">       sThreadLocal.set(<span class="keyword">new</span> Looper(quitAllowed));</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">    * Initialize the current thread as a looper, marking it as an</div><div class="line">    * application's main looper. The main looper for your application</div><div class="line">    * is created by the Android environment, so you should never need</div><div class="line">    * to call this function yourself.  See also: &#123;<span class="doctag">@link</span> #prepare()&#125;</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepareMainLooper</span><span class="params">()</span> </span>&#123;</div><div class="line">       prepare(<span class="keyword">false</span>);</div><div class="line">       <span class="keyword">synchronized</span> (Looper.class) &#123;</div><div class="line">           <span class="keyword">if</span> (sMainLooper != <span class="keyword">null</span>) &#123;</div><div class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"The main Looper has already been prepared."</span>);</div><div class="line">           &#125;</div><div class="line">           sMainLooper = myLooper();</div><div class="line">       &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">    * Returns the application's main looper, which lives in the main thread of the application.</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Looper <span class="title">getMainLooper</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">synchronized</span> (Looper.class) &#123;</div><div class="line">           <span class="keyword">return</span> sMainLooper;</div><div class="line">       &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">    * Run the message queue in this thread. Be sure to call</div><div class="line">    * &#123;<span class="doctag">@link</span> #quit()&#125; to end the loop.</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">final</span> Looper me = myLooper();</div><div class="line">       <span class="keyword">if</span> (me == <span class="keyword">null</span>) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"No Looper; Looper.prepare() wasn't called on this thread."</span>);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">final</span> MessageQueue queue = me.mQueue;</div><div class="line">       ...</div><div class="line">       <span class="keyword">for</span> (;;) &#123;</div><div class="line">           Message msg = queue.next(); <span class="comment">// might block</span></div><div class="line">           <span class="keyword">if</span> (msg == <span class="keyword">null</span>) &#123;</div><div class="line">               <span class="comment">// No message indicates that the message queue is quitting.</span></div><div class="line">               <span class="keyword">return</span>;</div><div class="line">           &#125;</div><div class="line">    </div><div class="line">           ...</div><div class="line">    </div><div class="line">           msg.target.dispatchMessage(msg);</div><div class="line">    </div><div class="line">           <span class="keyword">if</span> (logging != <span class="keyword">null</span>) &#123;</div><div class="line">               logging.println(<span class="string">"&lt;&lt;&lt;&lt;&lt; Finished to "</span> + msg.target + <span class="string">" "</span> + msg.callback);</div><div class="line">           &#125;</div><div class="line">    </div><div class="line">           ...</div><div class="line">    </div><div class="line">           msg.recycleUnchecked();</div><div class="line">       &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Looper</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</div><div class="line">        mQueue = <span class="keyword">new</span> MessageQueue(quitAllowed);</div><div class="line">        mThread = Thread.currentThread();</div><div class="line">    &#125;</div><div class="line">      </div><div class="line">    <span class="comment">/**</span></div><div class="line">    * Return the Looper object associated with the current thread.  Returns</div><div class="line">    * null if the calling thread is not associated with a Looper.</div><div class="line">    */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="meta">@Nullable</span> <span class="function">Looper <span class="title">myLooper</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> sThreadLocal.get();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">    * Return the &#123;<span class="doctag">@link</span> MessageQueue&#125; object associated with the current</div><div class="line">    * thread.  This must be called from a thread running a Looper, or a</div><div class="line">    * NullPointerException will be thrown.</div><div class="line">    */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="meta">@NonNull</span> <span class="function">MessageQueue <span class="title">myQueue</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> myLooper().mQueue;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Looper</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</div><div class="line">       mQueue = <span class="keyword">new</span> MessageQueue(quitAllowed);</div><div class="line">       mThread = Thread.currentThread();</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Looperçš„æ„é€ æ–¹æ³•ä¸­åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ª MessageQueue å¯¹è±¡ï¼ŒåŒæ—¶è¿™ä¸ªæ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤è¿™ä¸ªç±»æ— æ³•åœ¨å¤–éƒ¨é€šè¿‡newæ¥åˆ›å»ºï¼Œã€‚æˆ‘ä»¬çœ‹åˆ°å”¯ä¸€åˆ›å»ºçš„åœ°æ–¹å°±æ˜¯ <code>Looper.prepare()</code> æ–¹æ³•ä¸­ï¼Œåˆ›å»ºå¥½ä¹‹åç›´æ¥è¢«åŠ å…¥åˆ°ThreadLocalä¸­ã€‚å†æ¥çœ‹æˆ‘ä»¬åˆšæ‰ç”¨åˆ°çš„ <code>Looper.myLooper()</code> æ–¹æ³•ï¼Œè¿™å…¶ä¸­åªæœ‰ä¸€è¡Œå¾ˆå°´å°¬çš„ä»£ç ï¼Œ<code>sThreadLocal.get()</code> ï¼Œå®ƒå°±æ˜¯ä»ThreadLocalä¸­è·å– <code>å±äºå½“å‰çº¿ç¨‹çš„ Looper å¯¹è±¡</code>ã€‚å…³äº ThreadLocalï¼Œè¿™ä¸ªåœ¨æˆ‘çš„<a href="http://blog.csdn.net/ttdevs/article/details/71375416" target="_blank" rel="external">å¦ä¸€ç¯‡æ–‡ç« ä¸­æœ‰ä»‹ç»</a>â€”â€”æˆ‘ä»¬åœ¨çº¿ç¨‹ä¸­åˆ›å»ºçš„å˜é‡ï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å¹¶å¯¹å…¶ä¿®æ”¹ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡LocalThreadåˆ›å»ºçš„å˜é‡ï¼Œå°±åªæœ‰å½“å‰çº¿ç¨‹å¯ä»¥è®¿é—®äº†ã€‚</p>
<p>ä¹‹å‰æˆ‘ä»¬çŸ¥é“é€šè¿‡ Handler.sendMessage(msg) å°† Message å­˜å…¥ MessageQueue ä¸­ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒLooper.loop()ä¸­å¼€äº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå°†æ¶ˆæ¯ä» MessageQueue ä¸­å–å‡ºç„¶åè¿›è¡Œåˆ†å‘ã€‚çœ‹åˆ° MessageQueue åæˆ‘ç¬¬ä¸€ä¸ªæƒ³åˆ°å°±æ˜¯é˜»å¡é˜Ÿåˆ—ï¼Œç»“æœçœ‹äº†æºç ä¹‹åå¹¶ä¸æ˜¯è¿™ä¹ˆç®€å•ã€‚å¦‚æœæƒ³çœ‹è¿™ä¸ªç±»çš„åˆ†æï¼Œå¯ä»¥å‚è€ƒ<a href="http://blog.csdn.net/luoshengyang/article/details/6817933/" target="_blank" rel="external">è¿™é‡Œ</a>ï¼Œè¿™æ˜¯æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œæ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ï¼Œæˆ‘å°±ä¸å–å¼„äº†ã€‚ä½†æ˜¯è¿™ä¸å½±å“æˆ‘ä»¬å°† MessageQueue æŒ‰ç…§ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—æ¥ç†è§£ã€‚</p>
<p>å†çœ‹ä¸‹Looperæ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚æˆ‘ä»¬åœ¨Looperçš„ç±»æ³¨é‡Šä¸­å¯ä»¥çœ‹åˆ°è¿™æ®µä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  * Class used to run a message loop for a thread.  Threads by default do</div><div class="line">  * not have a message loop associated with them; to create one, call</div><div class="line">  * &#123;<span class="doctag">@link</span> #prepare&#125; in the thread that is to run the loop, and then</div><div class="line">  * &#123;<span class="doctag">@link</span> #loop&#125; to have it process messages until the loop is stopped.</div><div class="line">  *</div><div class="line">  * &lt;p&gt;Most interaction with a message loop is through the</div><div class="line">  * &#123;<span class="doctag">@link</span> Handler&#125; class.</div><div class="line">  *</div><div class="line">  * &lt;p&gt;This is a typical example of the implementation of a Looper thread,</div><div class="line">  * using the separation of &#123;<span class="doctag">@link</span> #prepare&#125; and &#123;<span class="doctag">@link</span> #loop&#125; to create an</div><div class="line">  * initial Handler to communicate with the Looper.</div><div class="line">  *</div><div class="line">  * &lt;pre&gt;</div><div class="line">  *  class LooperThread extends Thread &#123;</div><div class="line">  *      public Handler mHandler;</div><div class="line">  *</div><div class="line">  *      public void run() &#123;</div><div class="line">  *          Looper.prepare();</div><div class="line">  *</div><div class="line">  *          mHandler = new Handler() &#123;</div><div class="line">  *              public void handleMessage(Message msg) &#123;</div><div class="line">  *                  // process incoming messages here</div><div class="line">  *              &#125;</div><div class="line">  *          &#125;;</div><div class="line">  *</div><div class="line">  *          Looper.loop();</div><div class="line">  *      &#125;</div><div class="line">  *  &#125;&lt;/pre&gt;</div><div class="line">  */</div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Looper</span> </span>&#123;...&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨è‡ªå·±çš„çº¿ç¨‹ä¸­å®ç°æ¶ˆæ¯æœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰§è¡Œ <code>Looper.prepare();</code>ï¼› ç„¶ååˆ›å»º Handlerå¯¹è±¡ï¼›æœ€åå†æ‰§è¡Œ <code>Looper.loop()</code>ï¼›è¿™ä¸ªé¡ºåºä¸èƒ½é¢ å€’ï¼æœ€åæˆ‘ä»¬å†æ¥å°†è¿™ä¸ªæµç¨‹æ¢³ç†ä¸€ä¸‹ï¼š</p>
<ol>
<li><p>Looper.prepare()ï¼›</p>
<p> åˆå§‹åŒ–å±äºå½“å‰çº¿ç¨‹çš„ Looper å¯¹è±¡ï¼Œç„¶åæ”¾å…¥ ThreadLocal ä¸­ã€‚</p>
</li>
<li><p>new Handler()ï¼›</p>
<p> ä¸ºä»€ä¹ˆä¸€å®šè¦åœ¨ <code>Looper.prepare()</code> ä¹‹å <code>Looper.loop()</code> ä¹‹å‰åˆ›å»ºHandlerå¯¹è±¡å‘¢ï¼Ÿ </p>
<p> ç­”ï¼šåœ¨ <code>Looper.prepare()</code> ä¹‹åæ˜¯å› ä¸º Handler çš„æ„é€ å‡½æ•°ä¸­éœ€è¦æä¾›å½“å‰çº¿ç¨‹çš„ Looper å¯¹ è±¡ï¼Œè¿™ä¸ª Looper å¯¹è±¡åªèƒ½é€šè¿‡ <code>Looper.prepare()</code> æ¥åˆ›å»ºã€‚åœ¨ <code>Looper.loop()</code> ä¹‹å‰æ˜¯å› ä¸ºLooper.loop()æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œå†™åœ¨å…¶åä»£ç æ˜¯æ‰§è¡Œä¸åˆ°çš„ï¼ˆçœ‹çœ‹æœ€åç•™çš„é‚£ä¸ªé—®é¢˜ï½ï¼‰ã€‚</p>
</li>
<li><p>Looper.loop();</p>
<p> è¿™ä¸ªæ“ä½œå°±æ˜¯å¼€å§‹æ‰§è¡Œæ¶ˆæ¯å¾ªç¯ï¼Œå¤„ç†æ¶ˆæ¯ã€‚</p>
</li>
</ol>
<p>å°ç»“ï¼š</p>
<p>æ¶ˆæ¯æœºåˆ¶æ˜¯Androidç³»ç»Ÿä¸­çº¿ç¨‹é€šä¿¡éå¸¸é‡è¦çš„ä¸€ç§æ–¹æ³•ã€‚å¦‚æœå‘å¦ä¸€ä¸ªçº¿ç¨‹ä¼ é€’æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç›®æ ‡çº¿ç¨‹ä¸­å¯åŠ¨æ¶ˆæ¯æœºåˆ¶ï¼Œæ‹¿åˆ°è¿™ä¸ªçº¿ç¨‹Looperå¯¹è±¡åˆ›å»ºä¸€ä¸ªHandlerï¼Œé€šè¿‡è¿™ä¸ªHandlerå°±å¯ä»¥å‘ç›®æ ‡çº¿ç¨‹å‘é€æ¶ˆæ¯äº†ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<h2 id="0x03-HandlerThreadã€AsyncTask-å’Œ-UI-Thread"><a href="/2017/07/26/Android-ä»é€šè¿‡view-post-è·å–Viewå®½é«˜è°ˆAndroidæ¶ˆæ¯æœºåˆ¶/#0x03-HandlerThreadã€AsyncTask-å’Œ-UI-Thread" class="headerlink" title="0x03 HandlerThreadã€AsyncTask å’Œ UI Thread"></a>0x03 HandlerThreadã€AsyncTask å’Œ UI Thread</h2><ul>
<li><p>HandlerThread</p>
<p>  ä»æºç å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç±»æ˜¯å¯¹æˆ‘ä»¬Androidæ¶ˆæ¯æœºåˆ¶çš„ä¸€ä¸ªå°è£…ã€‚å½“æˆ‘ä»¬éœ€è¦è‡ªå·±å»å†™ä¸€ä¸ªåœ¨å­çº¿ç¨‹å·¥ä½œç„¶åå°†ç»“æœä¼ åˆ°ä¸»çº¿ç¨‹çš„åŠŸèƒ½æ—¶å¯ä»¥è€ƒè™‘ç”¨è¿™ä¸ªç±»ã€‚ä¸‹é¢æä¾›ä¸€ä¸ªç®€å•çš„Demoï¼š</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerThreadActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Handler mHandler = <span class="keyword">new</span> Handler()&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.handleMessage(msg);</div><div class="line"></div><div class="line">            String threadName = Thread.currentThread().getName();</div><div class="line">            tvLog.setText(String.format(<span class="string">"å½“å‰çº¿ç¨‹ï¼š%s Msgï¼š%s"</span>, threadName, msg.obj));</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> TextView tvLog;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_handler_thread);</div><div class="line">        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);</div><div class="line">        setSupportActionBar(toolbar);</div><div class="line"></div><div class="line">        tvLog = (TextView)findViewById(R.id.tvLog);</div><div class="line"></div><div class="line">        FloatingActionButton fab = (FloatingActionButton) findViewById(R.id.fab);</div><div class="line">        fab.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">                sendMessage();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        initData();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Handler mWorker;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</div><div class="line">        HandlerThread worker = <span class="keyword">new</span> HandlerThread(<span class="string">"worker"</span>);</div><div class="line">        worker.start();</div><div class="line">        mWorker = <span class="keyword">new</span> Handler(worker.getLooper());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">()</span> </span>&#123;</div><div class="line">        mWorker.post(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                print(<span class="string">"æˆ‘å·¥ä½œåœ¨çº¿ç¨‹ï¼š"</span> + Thread.currentThread().getName());</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    Thread.sleep(<span class="number">6</span> * <span class="number">1000</span>);</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">                sendMsgToUI();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMsgToUI</span><span class="params">()</span></span>&#123;</div><div class="line">                Message msg = <span class="keyword">new</span> Message();</div><div class="line">                msg.obj = Thread.currentThread().getName() + <span class="string">"å·¥ä½œå®Œæˆï¼Œè¿™æ˜¯ç»“æœ"</span>;</div><div class="line">                    mHandler.sendMessage(msg);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String msg)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;&gt;&gt;"</span> + msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºHandlerThreadå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªçº¿ç¨‹</li>
<li>å¯åŠ¨ç¬¬ä¸€æ­¥åˆ›å»ºçš„çº¿ç¨‹</li>
<li>åˆ›å»ºä¸€ä¸ªHandlerï¼Œå¹¶ä½¿ç”¨ç¬¬ä¸€æ­¥åˆ›å»ºçš„çº¿ç¨‹ä¸­çš„Looper</li>
<li>ç„¶ååœ¨ä¸»çº¿ç¨‹é€šè¿‡è¿™ä¸ªHandlerå‘å·¥ä½œçº¿ç¨‹å‘ä»»åŠ¡</li>
<li>ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œä½¿ç”¨åœ¨Activityï¼ˆä¸»çº¿ç¨‹ï¼‰ä¸­çš„Handlerå‘é€æ¶ˆæ¯ï¼Œå°†ç»“æœä»å·¥ä½œçº¿ç¨‹ä¼ å›ä¸»çº¿ç¨‹</li>
</ol>
<ul>
<li><p>AsyncTask</p>
<p>  è¿™æ˜¯ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ç±»ï¼Œç”¨åˆ°çš„çŸ¥è¯†ç‚¹ä¹Ÿéå¸¸å¤šï¼Œæ›¾ç»ç»Ÿæ²»è¿‡ç½‘ç»œåº“çš„ç¼–å†™ã€‚è¿™é‡Œåªè®²è·Ÿæˆ‘ä»¬æ¶ˆæ¯ç³»ç»Ÿç›¸å…³çš„çŸ¥è¯†ï¼Œå…ˆçœ‹ä¸€æ®µæºç ï¼š</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTask</span>&lt;<span class="title">Params</span>, <span class="title">Progress</span>, <span class="title">Result</span>&gt; </span>&#123;</div><div class="line">...</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> InternalHandler sHandler; </div><div class="line">...</div><div class="line">    <span class="comment">// è·å–åˆ°Handler</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Handler <span class="title">getHandler</span><span class="params">()</span> </span>&#123; </div><div class="line">        <span class="keyword">synchronized</span> (AsyncTask.class) &#123;</div><div class="line">            <span class="keyword">if</span> (sHandler == <span class="keyword">null</span>) &#123;</div><div class="line">                sHandler = <span class="keyword">new</span> InternalHandler();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> sHandler;</div><div class="line">        &#125;</div><div class="line">...</div><div class="line">    <span class="comment">// åœ¨å·¥ä½œçº¿ç¨‹å‘é€ç»“æœåˆ°ä¸»çº¿ç¨‹ï¼Œè¿™é‡Œè·å–åˆ°Message.targetéƒ½æ˜¯sHandlerå¯¹è±¡</span></div><div class="line">    <span class="function"><span class="keyword">private</span> Result <span class="title">postResult</span><span class="params">(Result result)</span> </span>&#123;</div><div class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">        Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT,</div><div class="line">                <span class="keyword">new</span> AsyncTaskResult&lt;Result&gt;(<span class="keyword">this</span>, result));</div><div class="line">        message.sendToTarget();</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">...</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * &lt;p&gt;Runs on the UI thread after &#123;<span class="doctag">@link</span> #doInBackground&#125;. The</div><div class="line">     * specified result is the value returned by &#123;<span class="doctag">@link</span> #doInBackground&#125;.&lt;/p&gt;</div><div class="line">     * </div><div class="line">     * &lt;p&gt;This method won't be invoked if the task was cancelled.&lt;/p&gt;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> result The result of the operation computed by &#123;<span class="doctag">@link</span> #doInBackground&#125;.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@see</span> #onPreExecute</div><div class="line">     * <span class="doctag">@see</span> #doInBackground</div><div class="line">     * <span class="doctag">@see</span> #onCancelled(Object) </div><div class="line">     */</div><div class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"UnusedDeclaration"</span>&#125;)</div><div class="line">    <span class="meta">@MainThread</span> <span class="comment">// è¿™ä¸ªæ–¹æ³•é‡Œçš„ä»£ç éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œäº†</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Result result)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Runs on the UI thread after &#123;<span class="doctag">@link</span> #publishProgress&#125; is invoked.</div><div class="line">     * The specified values are the values passed to &#123;<span class="doctag">@link</span> #publishProgress&#125;.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> values The values indicating progress.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@see</span> #publishProgress</div><div class="line">     * <span class="doctag">@see</span> #doInBackground</div><div class="line">     */</div><div class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"UnusedDeclaration"</span>&#125;)</div><div class="line">    <span class="meta">@MainThread</span> <span class="comment">// è¿™ä¸ªæ–¹æ³•é‡Œçš„ä»£ç éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œäº†</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(Progress... values)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">...</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * This method can be invoked from &#123;<span class="doctag">@link</span> #doInBackground&#125; to</div><div class="line">     * publish updates on the UI thread while the background computation is</div><div class="line">     * still running. Each call to this method will trigger the execution of</div><div class="line">     * &#123;<span class="doctag">@link</span> #onProgressUpdate&#125; on the UI thread.</div><div class="line">     *</div><div class="line">     * &#123;<span class="doctag">@link</span> #onProgressUpdate&#125; will not be called if the task has been</div><div class="line">     * canceled.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> values The progress values to update the UI with.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@see</span> #onProgressUpdate</div><div class="line">     * <span class="doctag">@see</span> #doInBackground</div><div class="line">     */</div><div class="line">    <span class="meta">@WorkerThread</span> <span class="comment">// ä»å·¥ä½œçº¿ç¨‹å‘æ¶ˆæ¯åˆ°ä¸»çº¿ç¨‹</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">publishProgress</span><span class="params">(Progress... values)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!isCancelled()) &#123;</div><div class="line">            getHandler().obtainMessage(MESSAGE_POST_PROGRESS,</div><div class="line">                    <span class="keyword">new</span> AsyncTaskResult&lt;Progress&gt;(<span class="keyword">this</span>, values)).sendToTarget();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">(Result result)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isCancelled()) &#123;</div><div class="line">            onCancelled(result);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            onPostExecute(result);</div><div class="line">        &#125;</div><div class="line">        mStatus = Status.FINISHED;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InternalHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InternalHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(Looper.getMainLooper()); <span class="comment">// åˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡ï¼Œä½¿ç”¨çš„Looperæ˜¯ä¸»çº¿ç¨‹çš„Looperï¼Œé‚£ä¹ˆå®ƒå¤„ç†çš„æ¶ˆæ¯éƒ½å°†åœ¨ä¸»çº¿ç¨‹ï¼Œè¿™ä¸ªå¾ˆå…³é”®</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"unchecked"</span>, <span class="string">"RawUseOfParameterizedType"</span>&#125;)</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">            AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj;</div><div class="line">            <span class="keyword">switch</span> (msg.what) &#123;</div><div class="line">                <span class="keyword">case</span> MESSAGE_POST_RESULT:</div><div class="line">                    <span class="comment">// There is only one result</span></div><div class="line">                    result.mTask.finish(result.mData[<span class="number">0</span>]);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> MESSAGE_POST_PROGRESS:</div><div class="line">                    result.mTask.onProgressUpdate(result.mData);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹äº†ä¸Šé¢çš„æºç å†å›æƒ³ä¸‹AsyncTaskç”¨æ³•æˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“è®ºï¼š</p>
<ol>
<li>ä¸»çº¿ç¨‹æ— éœ€åŠ¨æ€å‘å·¥ä½œçº¿ç¨‹å‘æ¶ˆæ¯ï¼Œåªæ˜¯åˆå§‹åŒ–çš„æ—¶å€™ä¼ é€’ä¸€äº›å‚æ•°</li>
<li>å·¥ä½œçº¿ç¨‹å®Œæˆåï¼Œé€šè¿‡è·å–ä¸»çº¿ç¨‹çš„Looperï¼Œæ„å»ºHandlerå°†ç»“æœå‘é€ç»™ä¸»çº¿ç¨‹</li>
</ol>
<ul>
<li><p>UI Thread</p>
<p>  çœ‹äº†ä¸Šé¢çš„ä¸¤ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬åœ¨æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨çš„ä¸»çº¿ç¨‹å¯ä»¥ç›´æ¥ä½¿ç”¨æ¶ˆæ¯ç³»ç»Ÿè€Œæ²¡æœ‰æ‰§è¡Œ<code>Looper.prepare()</code>ï¼Œ<code>Looper.loop()</code> ä¹‹ç±»çš„åˆå§‹åŒ–å·¥ä½œå‘¢ã€‚</p>
<p>  å…¶å®ç»“è®ºå¾ˆç®€å•ï¼Œä¸å¯èƒ½ä¸åˆå§‹åŒ–ï¼Œåªæ˜¯ç³»ç»Ÿæå‰å·²ç»å¸®æˆ‘ä»¬åˆå§‹åŒ–å¥½äº†ï¼Œè¿™éƒ¨åˆ†çš„æºç ä½äº <code>sdk/sources/android-xx/android/app/ActivityThread.java</code> ä¸­ï¼š</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ActivityThread</span> </span>&#123;</div><div class="line">...</div><div class="line">    <span class="keyword">final</span> H mH = <span class="keyword">new</span> H();</div><div class="line">...</div><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">H</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LAUNCH_ACTIVITY         = <span class="number">100</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAUSE_ACTIVITY          = <span class="number">101</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAUSE_ACTIVITY_FINISHING= <span class="number">102</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP_ACTIVITY_SHOW      = <span class="number">103</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP_ACTIVITY_HIDE      = <span class="number">104</span>;</div><div class="line">    ...</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">      ...</div><div class="line">      <span class="keyword">switch</span> (msg.what) &#123;</div><div class="line">          <span class="keyword">case</span> LAUNCH_ACTIVITY: &#123;</div><div class="line">              Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityStart"</span>);</div><div class="line">              <span class="keyword">final</span> ActivityClientRecord r = (ActivityClientRecord) msg.obj;</div><div class="line">              r.packageInfo = getPackageInfoNoCheck(</div><div class="line">                      r.activityInfo.applicationInfo, r.compatInfo);</div><div class="line">              handleLaunchActivity(r, <span class="keyword">null</span>, <span class="string">"LAUNCH_ACTIVITY"</span>);</div><div class="line">              Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">          &#125; <span class="keyword">break</span>;</div><div class="line">          <span class="keyword">case</span> RELAUNCH_ACTIVITY: &#123;</div><div class="line">              Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityRestart"</span>);</div><div class="line">              ActivityClientRecord r = (ActivityClientRecord)msg.obj;</div><div class="line">              handleRelaunchActivity(r);</div><div class="line">              Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">          &#125; <span class="keyword">break</span>;</div><div class="line">          <span class="keyword">case</span> PAUSE_ACTIVITY: &#123;</div><div class="line">              Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityPause"</span>);</div><div class="line">              SomeArgs args = (SomeArgs) msg.obj;</div><div class="line">              handlePauseActivity((IBinder) args.arg1, <span class="keyword">false</span>,</div><div class="line">                      (args.argi1 &amp; USER_LEAVING) != <span class="number">0</span>, args.argi2,</div><div class="line">                      (args.argi1 &amp; DONT_REPORT) != <span class="number">0</span>, args.argi3);</div><div class="line">              maybeSnapshot();</div><div class="line">              Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">          &#125; <span class="keyword">break</span>;</div><div class="line">          ...</div><div class="line">       &#125;</div><div class="line">       ...</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"ActivityThreadMain"</span>);</div><div class="line">        SamplingProfilerIntegration.start();</div><div class="line"></div><div class="line">        <span class="comment">// CloseGuard defaults to true and can be quite spammy.  We</span></div><div class="line">        <span class="comment">// disable it here, but selectively enable it later (via</span></div><div class="line">        <span class="comment">// StrictMode) on debug builds, but using DropBox, not logs.</span></div><div class="line">        CloseGuard.setEnabled(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">        Environment.initForCurrentUser();</div><div class="line"></div><div class="line">        <span class="comment">// Set the reporter for event logging in libcore</span></div><div class="line">        EventLogger.setReporter(<span class="keyword">new</span> EventLoggingReporter());</div><div class="line"></div><div class="line">        <span class="comment">// Make sure TrustedCertificateStore looks in the right place for CA certificates</span></div><div class="line">        <span class="keyword">final</span> File configDir = Environment.getUserConfigDirectory(UserHandle.myUserId());</div><div class="line">        TrustedCertificateStore.setDefaultUserDirectory(configDir);</div><div class="line"></div><div class="line">        Process.setArgV0(<span class="string">"&lt;pre-initialized&gt;"</span>);</div><div class="line"></div><div class="line">        Looper.prepareMainLooper(); <span class="comment">// å‡†å¤‡MainLooper</span></div><div class="line"></div><div class="line">        ActivityThread thread = <span class="keyword">new</span> ActivityThread();</div><div class="line">        thread.attach(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (sMainThreadHandler == <span class="keyword">null</span>) &#123;</div><div class="line">            sMainThreadHandler = thread.getHandler();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">false</span>) &#123;</div><div class="line">            Looper.myLooper().setMessageLogging(<span class="keyword">new</span></div><div class="line">                    LogPrinter(Log.DEBUG, <span class="string">"ActivityThread"</span>));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// End of event ActivityThreadMain.</span></div><div class="line">        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">        Looper.loop(); <span class="comment">// å¯åŠ¨è¿™ä¸ªæ¶ˆæ¯å¾ªç¯</span></div><div class="line"></div><div class="line">        <span class="comment">// å½“ä¸Šé¢çš„Looperæ‰§è¡Œquit()çš„æ—¶å€™æ‰§è¡Œåˆ°è¿™é‡Œï¼Œå½“ç„¶ï¼Œè¿™ä¸ªæ—¶å€™appå°±è¦é€€å‡ºäº†</span></div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Main thread loop unexpectedly exited"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å†å›åˆ°æˆ‘ä»¬æ–‡ç« å¼€å§‹çš„æ—¶å€™æåˆ°çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆé€šè¿‡ <code>view.post()</code> å¯ä»¥è·å–åˆ°Viewçš„å°ºå¯¸å‘¢ï¼Ÿ</p>
<p>ç­”ï¼šé¦–å…ˆå¤§å®¶éœ€è¦çŸ¥é“ï¼Œæˆ‘ä»¬Activityçš„å¯åŠ¨ï¼Œä¹Ÿæ˜¯é€šè¿‡ç³»ç»Ÿæ¶ˆæ¯çš„æ–¹å¼è§¦å‘çš„ã€‚ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå½“ <code>Looper.loop()</code> æ‰§è¡Œä¹‹åï¼Œå³å¯æ¥æ”¶ç³»ç»Ÿæ¶ˆæ¯äº†ï¼Œæ¯”å¦‚å¯åŠ¨Activityä¹‹ç±»çš„æ¶ˆæ¯ã€‚å½“ç³»ç»Ÿå‘å‡ºäº†ä¸€ä¸ªå¯åŠ¨Activityçš„æ¶ˆæ¯ï¼Œç„¶åæ‰§è¡Œè¿™ä¸ªæ¶ˆæ¯æ‰ä¼šå»å¯åŠ¨Actvityï¼Œå¯åŠ¨Activiyä¼šè°ƒç”¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œæ¯”å¦‚ <code>onCreate()</code> ç­‰ï¼Œåœ¨ <code>Activity.onCreate()</code> ä¸­ç”¨view.postå‘ä¸€ä¸ªä»»åŠ¡åˆ°ä¸»çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé‚£è¿™ä¸ªæ¶ˆæ¯è‚¯å®šè¦ç­‰ä¹‹å‰çš„æ¶ˆæ¯ä»»åŠ¡æ‰§è¡Œå®Œï¼Œä¹Ÿå°±æ˜¯å½“å‰åˆ›å»ºActivityçš„æ¶ˆæ¯æ‰§è¡Œå®Œæˆä¹‹åæ‰èƒ½æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°Viewçš„å°ºå¯¸äº†ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewPostActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> TextView tvInfo;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_view_post);</div><div class="line"></div><div class="line">        printMsg(<span class="string">"onCreate"</span>);</div><div class="line"></div><div class="line">        tvInfo = (TextView) findViewById(R.id.tvInfo);</div><div class="line">        tvInfo.post(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                printMsg(<span class="string">"Width:"</span> + tvInfo.getWidth());</div><div class="line">                printMsg(<span class="string">"Height:"</span> + tvInfo.getHeight());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onStart();</div><div class="line"></div><div class="line">        printMsg(<span class="string">"onStart"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onResume();</div><div class="line"></div><div class="line">        printMsg(<span class="string">"onResume"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printMsg</span><span class="params">(String msg)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;&gt;&gt;"</span> + msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºçš„Logï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="number">07</span>-<span class="number">27</span> <span class="number">13</span>:<span class="number">06</span>:<span class="number">36.373</span> <span class="number">17506</span>-<span class="number">17506</span>/com.ttdevs.message I/System.out: &gt;&gt;&gt;&gt;&gt;onCreate</div><div class="line"><span class="number">07</span>-<span class="number">27</span> <span class="number">13</span>:<span class="number">06</span>:<span class="number">36.378</span> <span class="number">17506</span>-<span class="number">17506</span>/com.ttdevs.message I/System.out: &gt;&gt;&gt;&gt;&gt;onStart</div><div class="line"><span class="number">07</span>-<span class="number">27</span> <span class="number">13</span>:<span class="number">06</span>:<span class="number">36.378</span> <span class="number">17506</span>-<span class="number">17506</span>/com.ttdevs.message I/System.out: &gt;&gt;&gt;&gt;&gt;onResume</div><div class="line"><span class="number">07</span>-<span class="number">27</span> <span class="number">13</span>:<span class="number">06</span>:<span class="number">36.433</span> <span class="number">17506</span>-<span class="number">17506</span>/com.ttdevs.message I/System.out: &gt;&gt;&gt;&gt;&gt;Width:<span class="number">248</span></div><div class="line"><span class="number">07</span>-<span class="number">27</span> <span class="number">13</span>:<span class="number">06</span>:<span class="number">36.433</span> <span class="number">17506</span>-<span class="number">17506</span>/com.ttdevs.message I/System.out: &gt;&gt;&gt;&gt;&gt;Height:<span class="number">76</span></div></pre></td></tr></table></figure>
<p>å’Œæ¨æµ‹çš„ä¸€è‡´ï¼ŒCooooolï½ï½</p>
<p>æœ€åï¼Œç•™ä¸ªå¥½ç©çš„é—®é¢˜ï¼Œæ‰§è¡Œ <code>getMainLooper().quit()</code> ä¼šæ€æ ·å‘¢ï¼Ÿ</p>
<p><a href="https://github.com/ttdevs/android/tree/master/apps/message" target="_blank" rel="external">æºç å‚è€ƒè¿™é‡Œ</a></p>
<hr>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-é€šè¿‡view-post-è·å–Viewå®½é«˜&quot;&gt;&lt;a href=&quot;/2017/07/26/Android-ä»é€šè¿‡view-post-è·å–Viewå®½é«˜è°ˆAndroidæ¶ˆæ¯æœºåˆ¶/#0x00-é€šè¿‡view-post-è·å–Viewå®½é«˜&quot; class=&quot;headerl
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://ttdevs.github.io/2017/06/20/2017-06-20/"/>
    <id>https://ttdevs.github.io/2017/06/20/2017-06-20/</id>
    <published>2017-06-20T13:30:43.000Z</published>
    <updated>2017-06-20T13:37:57.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è¥¿å®‰æ¸¸-â€”â€”-å¤§å”ç››ä¸–"><a href="/2017/06/20/2017-06-20/#è¥¿å®‰æ¸¸-â€”â€”-å¤§å”ç››ä¸–" class="headerlink" title="# è¥¿å®‰æ¸¸ â€”â€” å¤§å”ç››ä¸–"></a># è¥¿å®‰æ¸¸ â€”â€” å¤§å”ç››ä¸–</h1><p><img src="http://upload-images.jianshu.io/upload_images/1801981-ec7c4ff20dfd2d9e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¥¿å®‰"></p>
<p>ç»å†äº†æ¼«é•¿çš„çŠ¹è±«çº ç»“ä¹‹åå†³å®šè£¸è¾ã€‚ä¸€åœºè¯´èµ°å°±èµ°çš„æ—…ç¨‹å°±è¿™ä¹ˆå¼€å§‹äº†ã€‚</p>
<p>ç¦»èŒæ—¶æ— æ„ä¸­è·Ÿä¸€ä¸ªå°ä¼™ä¼´èŠå¤©ï¼Œå¾—çŸ¥å¥¹ä¹Ÿæ˜¯ç¦»èŒçŠ¶æ€ï¼Œé‚ç»“ä¼´ä¸€èµ·å»å¾€è¥¿å®‰ã€‚è™½ç„¶æ˜¯ä¸€ä¸ªæ¾æ•£ç»„åˆï¼Œä½†ä¹Ÿä¸ç”¨ä¸€ç›´ä¸€ä¸ªäººäº†ï½ï¼ˆå…¶å®å•èº«ç‹—æœ‰æ—¶å€™ä¹Ÿéœ€è¦æ‰¾åˆ«äººå¸®æ‹æ—…æ¸¸ç…§ï¼‰</p>
<p>å‡ºå‘ä¹‹å‰å¹¶æ²¡æœ‰åšè¯¦ç»†çš„æ”»ç•¥ï¼Œåªæœ‰ä¸€ä¸ªç›®çš„åœ°è¥¿å®‰ã€‚æƒ³åˆ°å“ªé‡Œå»å“ªé‡Œï¼Œæ¯”å¦‚è‘—åçš„ç§¦å§‹çš‡é™µå…µé©¬ä¿‘ï¼Œåå±±ï¼Œå¤åŸå¢™ï¼Œå¤§é›å¡”ï¼Œè¥¿å®‰å°åƒç­‰ç­‰ï¼Œå½“ç„¶è¿˜æœ‰äº›ä¹‹å‰ä¸çŸ¥é“çš„æ™¯ç‚¹ã€‚æœ€åçœ‹æ¥ï¼Œé™¤äº†åå±±å’Œå¤§é›å¡”æ²¡æœ‰å»æœ‰ç‚¹å°é—æ†¾ä¹‹å¤–ï¼Œå¤§éƒ¨åˆ†æœŸå¾…çš„éƒ½å»äº†ï¼Œè€Œä¸”å¤šæ•°éƒ½æ˜¯è¶…è¿‡ä¹‹å‰çš„æœŸå¾…ï½</p>
<h2 id="ç¬¬ä¸€å¤©-ä»å‡ºå‘åˆ°å›æ°‘è¡—"><a href="/2017/06/20/2017-06-20/#ç¬¬ä¸€å¤©-ä»å‡ºå‘åˆ°å›æ°‘è¡—" class="headerlink" title="ç¬¬ä¸€å¤© ä»å‡ºå‘åˆ°å›æ°‘è¡—"></a>ç¬¬ä¸€å¤© ä»å‡ºå‘åˆ°å›æ°‘è¡—</h2><p>æå‰ä¸¤å¤©ä¹°çš„æœºç¥¨ï¼Œå—èˆª<code>CZ6616</code>ä¸Šåˆ<code>11:25</code> ä¸Šæµ·é£è¥¿å®‰ã€‚ç¦»æœºåœºå¾ˆè¿‘ï¼Œæ‰€ä»¥ä¸ç”¨æ—©èµ·èµ¶ç°æœºï¼Œå‡†ç‚¹èµ·é£ï¼Œé¢„ç¤ºä¸€ä¸ªç¾å¥½çš„æ—…ç¨‹å³å°†å¼€å§‹ï½</p>
<p>å‡ºå‘ä¹‹å‰å°ä¼™ä¼´åœ¨ç½‘ä¸ŠæŠ¥äº†ä¸€ä¸ª<a href="http://www.mafengwo.cn/sales/2201895.html" target="_blank" rel="external">ä¸€å¤©çš„æ—…è¡Œå›¢</a>ï¼ŒåŒ…å«æ¥æœºçš„æœåŠ¡ï¼Œæ—…æ¸¸å·´å£«ï¼Œä»æœºåœºé€åˆ°ä½åœ°ã€‚æ‰€ä»¥æ•´ä¸ªåˆ°è¾¾è¿‡ç¨‹è¿˜æ˜¯ç›¸å½“é¡ºåˆ©æ»´ã€‚</p>
<p>åŒè¡Œå°ä¼™ä¼´è¦ä½é’æ—…ï¼Œè¯´å¯ä»¥ç©ç‹¼äººæ€ç­‰æ¸¸æˆã€‚ç”±äºæ²¡æœ‰ä½è¿‡é’æ—…ï¼Œæƒ³ä½“éªŒä¸‹ï¼Œæ‰€ä»¥ä¹Ÿè®¢äº†ä¸€ä¸ªåºŠé“ºï¼Œå››äººé—´ï¼Œ45å…ƒï¼æ™šã€‚åˆ°äº†é’æ—…åŠäº†å…¥ä½ï¼Œçœ‹äº†æˆ¿é—´ï¼Œç¬é—´ä¸æƒ³ä½äº†ï¼ˆé‡Œé¢å·²ä½ä¸¤äººï¼Œæœ‰ç‚¹ä¹±ï¼Œå¸¦äº†ä¸ªå¯ä»¥ç™»æœºçš„è¡Œæç®±æˆ¿é—´çš„æŸœå­ç«Ÿç„¶æ”¾ä¸ä¸‹ï¼Œä¹Ÿæ²¡å…¶ä»–åœ°æ–¹å¯æ”¾ï¼‰ï¼Œé‚é€€æˆ¿ï¼ˆåæ¥æƒ³äº†ä¸‹ï¼Œå¯èƒ½å·²ç»è¿‡äº†ä½é’æ—…çš„å¹´é¾„äº†å§ï¼‰ï¼Œå»æ‰¾äº†å®¶<a href="/2017/06/20/2017-06-20/ä¸ƒå¤©è¥¿å®‰é’Ÿæ¥¼åº—ï¼Œè¥¿ä¸€è·¯49å·">å¿«æ·é…’åº—</a>ï¼Œç¦»å›æ°‘è¡—å¾ˆè¿‘ï¼Œå¤§åºŠæˆ¿æ¯æ™šä¸åˆ°100ï¼Œä¹‹åå‡ å¤©ä¸€ç›´ä½è¿™é‡Œï¼ˆå“ˆå“ˆï¼Œæ·˜å®ä¹°äº†å‡ å¼ 20çš„ä¼˜æƒ åˆ¸ï¼Œè¿˜æ˜¯èƒ½çœä¸€ç‚¹æ˜¯ä¸€ç‚¹ï¼‰ã€‚</p>
<p>å®‰å®šå¥½ä¹‹åå¼€å§‹é€›å›æ°‘è¡—ã€é’Ÿæ¥¼å’Œé¼“æ¥¼ã€‚ä¸‹é¢å¼€å§‹ä¸Šå›¾ï½</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-d7cdca0b55cfc589.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›æ°‘è¡—"><br>äººè¶…å¤šæœ‰æ²¡æœ‰ï½ï½</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-39ac7b3a83e11b1a.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è‰²å½©ä¸°å¯Œçš„ç¾é£Ÿ"><br>è‰²å½©è¶…çº§ä¸°å¯Œå•Š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-c917909cde1b791d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¿å­é¥¼"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-fe79d6fdc93ed9f9.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="biangbiangé¢"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-b8d04e14cb572d26.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¦•"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-115ef2973ed7e09d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰‹è‰ºäºº"><br><img src="http://upload-images.jianshu.io/upload_images/1801981-b9d4cb4a8d81705a.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰‹è‰ºäºº"><br><img src="http://upload-images.jianshu.io/upload_images/1801981-468a2b6e70670696.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ‰‹è‰ºäºº"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-0c3d51681a1fc6db.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é’Ÿæ¥¼"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-4724bd384967678f.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é¼“æ¥¼"></p>
<h2 id="ç¬¬äºŒå¤©-ç§¦å§‹çš‡é™µå…µé©¬ä¿‘"><a href="/2017/06/20/2017-06-20/#ç¬¬äºŒå¤©-ç§¦å§‹çš‡é™µå…µé©¬ä¿‘" class="headerlink" title="ç¬¬äºŒå¤© ç§¦å§‹çš‡é™µå…µé©¬ä¿‘"></a>ç¬¬äºŒå¤© ç§¦å§‹çš‡é™µå…µé©¬ä¿‘</h2><h3 id="è¥¿å®‰ä¸€æ—¥æ¸¸"><a href="/2017/06/20/2017-06-20/#è¥¿å®‰ä¸€æ—¥æ¸¸" class="headerlink" title="è¥¿å®‰ä¸€æ—¥æ¸¸"></a>è¥¿å®‰ä¸€æ—¥æ¸¸</h3><p>å‰é¢æåˆ°æŠ¥äº†ä¸€ä¸ªæ—…æ¸¸å›¢ï¼š<a href="http://www.mafengwo.cn/sales/2201895.html" target="_blank" rel="external">å…µé©¬ä¿‘+åæ¸…å®«+éªŠå±±ç´¢é“ä¸€æ—¥æ¸¸ï¼ˆèµ æ¥æœº/é«˜é“/åŒè€³éº¦/èµ è‡ªåŠ©é¤ï¼‰ä»·æ ¼390ï¼Œä¸åç´¢é“330</a>ï¼Œé©¬èœ‚çªä¸Šæœ‰å”®ã€‚ç¾å¥³å¯¼æ¸¸ï¼Œå¤§å·´æ¥é€ï¼Œæ— è´­ç‰©ï¼Œè‡ªåŠ©é¤ç­‰ç­‰ï¼Œå»ä¹‹å‰è¿˜æ‹…å¿ƒè¢«å¸¦åˆ°å‡å…µé©¬ä¿‘ç­‰å„ç§å‘ï¼Œæœ€åæ€»ç»“ä¸‹æ¥å¾ˆæ»¡æ„çš„ä¸€æ¬¡è·Ÿå›¢ã€‚å…·ä½“çš„è¡Œç¨‹å¤§å®¶å¯ä»¥çœ‹ä»‹ç»ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-35507f861e6f142b.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…µé©¬ä¿‘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-e31046ae3c969d4c.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…µé©¬ä¿‘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-3cf285c2026feb2d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…µé©¬ä¿‘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-9e11adcfccd4ad48.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…µé©¬ä¿‘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-d7a0bd055a32f819.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…µé©¬ä¿‘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-5db4d6a737f9a5a7.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…µé©¬ä¿‘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-1b87890b254e2e6b.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…µé©¬ä¿‘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-25e411403ffbb5fe.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å…µé©¬ä¿‘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-a06df8b4385d3154.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åæ¸…å®«"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-a9fda7b212bc48fd.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åæ¸…å®«"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-2c63547ceca7f151.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åæ¸…å®«"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-d472ea14ec698863.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="éªŠå±±ä¿¯ç°"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-18d999e9295d0d43.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¾å¥³å¯¼æ¸¸"><br>æˆ‘ä»¬çš„ç¾å¥³å¯¼æ¸¸ï½</p>
<h3 id="è¥¿å®‰å¤åŸå¢™"><a href="/2017/06/20/2017-06-20/#è¥¿å®‰å¤åŸå¢™" class="headerlink" title="è¥¿å®‰å¤åŸå¢™"></a>è¥¿å®‰å¤åŸå¢™</h3><p>æ—…æ¸¸å›¢ç»“æŸä¹‹åé€å›é’Ÿæ¥¼ï¼Œè·¯ä¸Šå¯¼æ¸¸æ¨èäº†å‡ å®¶ï¼Œä½†æ˜¯éƒ½æ²¡è®°ä½ã€‚ä¸è¿‡è¿˜æ˜¯è¦å»æ‰¾åƒçš„ï¼Œå‡‰çš®è‚‰å¤¹é¦è‡ªç„¶æ˜¯é¦–é€‰ï¼ˆå›æ°‘è¡—å–çš„è‚‰å¤¹é¦éƒ½æ˜¯ç‰›ç¾Šè‚‰çš„ï¼Œæˆ‘è¿˜æ˜¯å–œæ¬¢çŒªè‚‰çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè‚‰å¤¹é¦ä¸æ˜¯å›æ°‘è¡—ä¹°çš„ï½ï¼‰ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-122a846d19df3695.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è‚‰å¤¹é¦"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-d9cd4f0c12c4c33f.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å‡‰çš®"></p>
<p>åƒé¥­åƒå®Œæ—¶é—´è¿˜æ—©ï¼Œé‚å†³å®šå»å¤åŸå¢™ã€‚å°±è¿™æ ·ä¸€ä¸ªäººéª‘ç€å°é»„è½¦å±é¢ å±é¢ çš„èµ¶åˆ°åŸå¢™ï¼Œä¹°ç¥¨è¿›å…¥ï¼Œé—¨ç¥¨54ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-a35904c1bcf2a45e.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤åŸå¢™"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-12bfc6a16b7633ea.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤åŸå¢™"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-e6d33f5bfbd1bb88.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤åŸå¢™"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-d74154a343104713.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤åŸå¢™"></p>
<p>ç”±äºå»çš„æ—¶å€™å¤©å·²ç»å¿«æ™šä¸Š8ç‚¹äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰ç‚¹æ™šçš„ã€‚åŠ ä¹‹å¤©æ°”ä¸å¥½é˜´çš„å¾ˆé‡ï¼Œä¸­é—´è¿˜æœ‰å°é›¨ï¼Œåˆä¸æƒ³éª‘è‡ªè¡Œè½¦ä¸€ä¸ªäººèµ°äº†å››åˆ†ä¹‹ä¸€å°±æ’¤äº†ï¼ˆä»å—é—¨èµ°åˆ°è¥¿é—¨ï¼‰ã€‚å¯èƒ½éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ™šä¸Šä¸æ˜¯æ¯ä¸ªé—¨éƒ½å¼€çš„ï¼Œæƒ³å‡ºæ¥ä¹Ÿå¾—èµ°åˆ°æŸä¸ªå¤§ä¸€ç‚¹çš„é—¨ã€‚</p>
<h2 id="ç¬¬ä¸‰å¤©-å¤§å”èŠ™è“‰å›­"><a href="/2017/06/20/2017-06-20/#ç¬¬ä¸‰å¤©-å¤§å”èŠ™è“‰å›­" class="headerlink" title="ç¬¬ä¸‰å¤© å¤§å”èŠ™è“‰å›­"></a>ç¬¬ä¸‰å¤© å¤§å”èŠ™è“‰å›­</h2><p>å‰ä¸€å¤©é€›çš„å¤ªæ™šï¼Œæ¯”è¾ƒç´¯ï¼Œæ‰€ä»¥ç¡äº†ä¸ªæ‡’è§‰ï¼Œèµ·åºŠå·²ç»ä¸‹åˆã€‚æ—¶é—´ä¸å¤ŸèŠ™è“‰å›­å’Œå¤§é›å¡”ä¸èƒ½åŒæ—¶å»äº†ï¼ˆå¤§é›å¡”éŸ³ä¹å–·æ³‰ä¹Ÿæ²¡å»æˆï¼‰ï¼Œå¤§é›å¡”ä¸æ˜¯ç‰¹åˆ«æœŸå¾…ï¼Œæœ€åé€‰æ‹©äº†èŠ™è“‰å›­ã€‚å»ä¹‹å‰ç®€å•äº†è§£äº†ä¸‹ï¼šæ–°å»ºçš„æ™¯ç‚¹ï¼Œä¸æ˜¯å†å²å¤è¿¹ï¼Œæ‰€ä»¥ä¹Ÿä¸æŠ±å¤ªå¤§å¸Œæœ›ã€‚ä¹°äº†å¸¦æ¼”å‡ºçš„198å—çš„é—¨ç¥¨ï¼Œå…¶ä¸­å¸¦äº†<code>å¤§å”ç››ä¸–</code>çš„æ¼”å‡ºã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-4a7a70f01f30a447.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§å”èŠ™è“‰å›­"></p>
<h3 id="å¤§å”ç››ä¸–"><a href="/2017/06/20/2017-06-20/#å¤§å”ç››ä¸–" class="headerlink" title="å¤§å”ç››ä¸–"></a>å¤§å”ç››ä¸–</h3><p>è¿™æ˜¯ä¸€ä¸ªå•†ä¸šæ¼”å‡ºï¼Œå¦‚æœä¸å–œæ¬¢å¯ä»¥ä¹°120çš„ç¥¨ï¼Œå°±æ²¡æœ‰è¿™ä¸€é¡¹äº†ã€‚æ‚„æ‚„çš„å‘Šè¯‰ä½ ä»¬ï¼Œæˆ‘æ˜¯ç¬¬ä¸€æ¬¡çœ‹æ¼”å‡ºï¼Œç¬¬ä¸€æ’ï¼Œè¿™ä¸ªä½ç½®æœ‰ç‚¹ä½ï¼Œå¾€åä¸¤æ’åº”è¯¥ä¼šæ›´å¥½ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ç¦»æ¼”å‘˜å¾ˆè¿‘ï¼Œå¯ä»¥çœ‹ç¾å¥³ï½ï½</p>
<p>å››ç‚¹åŠå°±å¯ä»¥å…¥åœºäº†ï¼Œæœ¬ä»¥ä¸ºçœ‹çš„äººä¼šå¾ˆå°‘ï¼Œä½†æ˜¯æœ€åå‘ç°å‡ ä¹åº§æ— è™šå¸­ï¼Œè¶…ä¹æˆ‘çš„æƒ³è±¡ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-54f46e83857f8c96.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§å”èŠ™è“‰å›­"><br>ï¼ˆä¸å¥½æ„æ€ï¼ŒåŸè°…æˆ‘å·æ‹ç…§äº†ï¼‰</p>
<p>å¯¹æˆ‘æ¥è¯´ç™½å¤©è¿™ä¸ªå›­å­å¯çœ‹çš„ä¸æ˜¯å¾ˆå¤šã€‚æœ‰ä¸€äº›é›•å¡‘ï¼Œçœ‹ä¸æ‡‚çš„æˆ‘ï¼ŒçœŸæ˜¯èœœæ±å°´å°¬ï¼Œæ¯”å¦‚ä¸‹é¢è¿™åº§ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-da441ed3975e44e6.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§å”èŠ™è“‰å›­"></p>
<p>å”¯ä¸€æœ‰å¥½ä¸€ç‚¹å°è±¡çš„æ˜¯ç´«äº‘æ¥¼ä¸­ä¼šæœ‰å®šæ—¶çš„è¡¨æ¼”ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-ce756ea59f975995.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§å”èŠ™è“‰å›­"></p>
<h3 id="ç¯å…‰è¡¨æ¼”"><a href="/2017/06/20/2017-06-20/#ç¯å…‰è¡¨æ¼”" class="headerlink" title="ç¯å…‰è¡¨æ¼”"></a>ç¯å…‰è¡¨æ¼”</h3><p>ä»ä¸¤ä¸ªæ ‡é¢˜å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºè¿™é‡Œçš„å»ºç­‘çœŸæ˜¯æœŸå¾…ä¸å¤§ï¼Œå¥½åœ¨æœ‰æ™šä¸Šçš„ç¯å…‰æ°´å¹•ç­‰è¡¨æ¼”ï¼Œå“ˆå“ˆï½ï½</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-22c5068ab3f6928e.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§å”èŠ™è“‰å›­"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-536510e747a4b55a.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§å”èŠ™è“‰å›­"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-aa4b70b446946d05.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§å”èŠ™è“‰å›­"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-ae20add28b0258b7.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§å”èŠ™è“‰å›­"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-c729164e0b1f6862.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§å”èŠ™è“‰å›­"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-35737d9af2e773ac.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¤§å”èŠ™è“‰å›­"></p>
<p>ä¸€ä¸ªäººåœ¨ä¸€ä¸ªååƒ»çš„è§’è½çœ‹å®Œæ•´ä¸ªè¡¨æ¼”ï¼ˆå…¶å®å°±æ˜¯ä¸ºäº†æ‹ç…§ï½ï½ï¼‰æ™šä¸Šçš„ç¯å…‰è¿˜æ˜¯å¾ˆæ¼‚äº®çš„ã€‚å¬è¯´æ˜¯å…¨å›½æœ€å¤§çš„æ°´å¹•ç”µå½±ã€‚</p>
<h2 id="ç¬¬å››å¤©-é™•è¥¿å†å²åšç‰©é¦†"><a href="/2017/06/20/2017-06-20/#ç¬¬å››å¤©-é™•è¥¿å†å²åšç‰©é¦†" class="headerlink" title="ç¬¬å››å¤© é™•è¥¿å†å²åšç‰©é¦†"></a>ç¬¬å››å¤© é™•è¥¿å†å²åšç‰©é¦†</h2><p>åƒè´§ä»¬å¯èƒ½å·²ç»å‘ç°ä¸€ä¸ªé—®é¢˜â€”â€”åŸºæœ¬ä¸Šæ²¡æœ‰ä»‹ç»åƒã€‚çœ‹æˆ‘çš„å°´å°¬è„¸ğŸ˜…</p>
<p>å› ä¸ºä»æ¥ç¬¬äºŒå¤©å°±å¼€å§‹æ‹‰è‚šå­ï¼Œæ¶å¿ƒæƒ³åï¼Œå•¥ä¹Ÿä¸æƒ³åƒã€‚æœ‹å‹è¯´è‚ èƒƒæ„Ÿå†’ï¼Œåƒç‚¹è¯å°±å¥½ã€‚ä½†æ˜¯ä»Šå¤©æ„Ÿè§‰å¿«è¦æ­»äº†ï¼ˆæ¥ä¸‹æ¥è¿˜æœ‰ä¸€å‘¨å¤šçš„è¡Œç¨‹ï¼Œé’±å·²äº¤ï¼‰ï¼Œé‚å»äº†åŒ»é™¢ã€‚ä¸€å¤§æ—©èµ¶åˆ°è¥¿å®‰äº¤é€šå¤§å­¦ç¬¬ä¸€é™„å±åŒ»é™¢çœ‹äº†ä¸ªæ¶ˆåŒ–å†…ç§‘ï¼ŒåŒ»ç”Ÿä¸åˆ†é’çº¢çš‚ç™½çš„ç»™å¼€äº†ä¸€å †è¯ï¼ˆè¿˜æœ‰è¿›å£çš„é…µæ¯èŒï¼Œå–è¯æ—¶æ‰å‘ç°ï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿå–è¿‡ï¼Œå‘å•Šï¼‰ï¼Œè¾“æ¶²ä¸¤ç“¶ï¼Œè¯è´¹480+ï¼Œç®€ç›´æ˜¯æŠ¢åŠ«å•Šï¼Œæœ‰æ²¡æœ‰ã€‚æœ€åéƒ½ä¸çŸ¥é“æ˜¯åƒäº†è¿™äº›è¯å¥½çš„è¿˜æ˜¯æˆ‘è‡ªå·±å»è¯åº—ä¹°çš„è—¿é¦™æ­£æ°”æ°´åƒå¥½çš„ã€‚ã€‚ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-5a1ace90943c66c3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¾“æ¶²"></p>
<p>è¾“å®Œæ¶²ï¼Œèµ¶åˆ°è¥¿å®‰å†å²åšç‰©é¦†ï¼Œå·²ç»ä¸‹åˆä¸¤ç‚¹å¤šã€‚åœ¨å¯¹é¢å–äº†ç‚¹ç²¥ï¼Œåƒäº†ç‚¹ä¸œè¥¿â€”â€”çƒ¤é¦â€”â€”ä¸€å—é’±ä¸€ä¸ªâ€”â€”è¶…çº§å¥½åƒï¼Œé‚£ä¸ªçŠ¶æ€æˆ‘ç«Ÿç„¶åƒäº†ä¿©ï½</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-0681f0ba38c8ce14.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="çƒ¤é¦"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-b55ab1477dfda13b.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="çƒ¤é¦"></p>
<p>è¯´æ­£é¢˜ï¼Œä¸ºä»€ä¹ˆæƒ³æ¥è¿™é‡Œå‘¢ï¼Ÿéš¾é“æˆ‘å¾ˆçˆ±å†å²å˜›ï½ å…¶å®ä¸æ˜¯ï¼Œå°±æ˜¯æƒ³å¤šäº†è§£ä¸€ä¸‹å†å²è€Œå·²ã€‚ä¹‹å‰å»è¿‡å—äº¬åšç‰©é™¢ï¼Œä¸€ä¸ªäººé€›äº†åŠå¤©ï¼Œè¿˜æ˜¯æŒºéœ‡æ’¼çš„ã€‚æ‰€ä»¥å¯¹äºè¥¿å®‰è¿™åº§å¤åŸï¼Œå¯¹ä»–çš„åšç‰©é¦†è¿˜æ˜¯æŒºæœŸå¾…çš„ã€‚</p>
<p>ç®€å•æé†’ä¸€ä¸‹ï¼Œè¿™é‡Œçš„ç¥¨å…è´¹ï¼Œå¯ä»¥å®˜ç½‘é¢„çº¦ï¼Œé¢„çº¦å¥½äº†é‚£å¤©å•¥æ—¶å€™å»éƒ½å¯ä»¥ï¼Œå¦åˆ™çš„è¯å°±åˆ°ç°åœºæ’é˜Ÿã€‚äººå¤šçš„æ—¶å€™é˜Ÿä¼å¯èƒ½ä¼šæ¯”è¾ƒé•¿ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-08fe18bce59d0359.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é™•è¥¿å†å²åšç‰©é¦†"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-aea8bc3f1721d33e.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é™•è¥¿å†å²åšç‰©é¦†"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-331cfb93c26d5e98.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é™•è¥¿å†å²åšç‰©é¦†"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-15b8b10151f199bc.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é™•è¥¿å†å²åšç‰©é¦†"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-7556f2292ba025ce.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é™•è¥¿å†å²åšç‰©é¦†"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-36e2cd79a7dfed95.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é™•è¥¿å†å²åšç‰©é¦†"></p>
<p>ç”±äºå®åœ¨éš¾å—ï¼Œä¹Ÿæ²¡é€›å¤šä¹…å°±æ—©æ—©çš„å›å»ä¼‘æ¯äº†ã€‚</p>
<h2 id="ç¬¬äº”å¤©-ä»è¥¿å®‰åˆ°è¥¿å®"><a href="/2017/06/20/2017-06-20/#ç¬¬äº”å¤©-ä»è¥¿å®‰åˆ°è¥¿å®" class="headerlink" title="ç¬¬äº”å¤© ä»è¥¿å®‰åˆ°è¥¿å®"></a>ç¬¬äº”å¤© ä»è¥¿å®‰åˆ°è¥¿å®</h2><p>æœ€åä¸€å¤©çš„è¡Œç¨‹ï¼Œè¥¿å®‰åˆ°è¥¿å®ã€‚æœ¬æ‰“ç®—åšæœºåœºå¤§å·´ï¼Œä½†æ˜¯æœ‰ä¸ªè¡Œæç®±æ¯”è¾ƒé‡ï¼ŒåŒè¡Œçš„å°ä¼™ä¼´å†³å®šä¸€èµ·æ‰“è½¦ã€‚å«äº†ä¸“è½¦ï¼Œä»è¥¿å®‰å¸‚åŒºé€åˆ°å’¸é˜³æœºåœºã€‚ä¼˜æƒ äº†50ï¼Œæ¯ä¸ªäºº50å¿«ï¼Œè¿˜æ˜¯æŒºåˆ’ç®—çš„ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-b7d9245cd8aed746.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¥¿å®‰åˆ°è¥¿å®"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-428f915f9fe1af9c.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¥¿å®‰åˆ°è¥¿å®"></p>
<p>æ„Ÿè§‰ä¸€è·¯ä¸Šç°æœºç»è¿‡äº†é™•ç”˜ä¸åŒçš„åœ°è²Œç¯å¢ƒï¼Œå·å·ç”¨æ‰‹æœºæ‹äº†å‡ ç«™ï¼Œè¶…çº§åæ‚”ç°æœºä¸Šæ²¡æœ‰æŠŠç›¸æœºæ‹¿å‡ºæ¥ã€‚ç»™å¤§å®¶åˆ†äº«å‡ å¼ ï¼Œè¥¿å®‰è¡Œç¨‹ç»“æŸï½</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-93732e0aae772f4c.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¥¿å®‰åˆ°è¥¿å®"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-3940547d7d552c56.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¥¿å®‰åˆ°è¥¿å®"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-895f96537f902aa3.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¥¿å®‰åˆ°è¥¿å®"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1801981-90b4c485dec7470d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è¥¿å®‰åˆ°è¥¿å®"></p>
<p>è¥¿å®‰ä¹‹è¡Œå°±è¿™ä¹ˆç»“æŸäº†ã€‚å¦‚æœæœ‰äººä¸€èµ·çš„è¯ï¼Œå¯èƒ½ä¼šå»çˆ¬åå±±ï¼Œä¸è¿‡ç•™ç€ä»¥åæœ‰æœºä¼šå»ä¹Ÿå¥½ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;è¥¿å®‰æ¸¸-â€”â€”-å¤§å”ç››ä¸–&quot;&gt;&lt;a href=&quot;/2017/06/20/2017-06-20/#è¥¿å®‰æ¸¸-â€”â€”-å¤§å”ç››ä¸–&quot; class=&quot;headerlink&quot; title=&quot;# è¥¿å®‰æ¸¸ â€”â€” å¤§å”ç››ä¸–&quot;&gt;&lt;/a&gt;# è¥¿å®‰æ¸¸ â€”â€” å¤§å”ç››ä¸–&lt;/h1&gt;&lt;p&gt;&lt;img sr
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://ttdevs.github.io/2017/06/02/2017-06-02/"/>
    <id>https://ttdevs.github.io/2017/06/02/2017-06-02/</id>
    <published>2017-06-02T05:55:45.000Z</published>
    <updated>2017-06-02T05:55:45.000Z</updated>
    
    <content type="html"><![CDATA[<p># </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;# &lt;/p&gt;

    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>[Android]å‡çº§Support Library</title>
    <link href="https://ttdevs.github.io/2017/05/26/Android-%E5%8D%87%E7%BA%A7SupportLibrary/"/>
    <id>https://ttdevs.github.io/2017/05/26/Android-å‡çº§SupportLibrary/</id>
    <published>2017-05-26T06:14:07.000Z</published>
    <updated>2017-05-26T06:14:07.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-Support-Library"><a href="/2017/05/26/Android-å‡çº§SupportLibrary/#0x00-Support-Library" class="headerlink" title="0x00 Support Library"></a>0x00 Support Library</h2><h2 id="0x01-æ³¨æ„äº‹é¡¹"><a href="/2017/05/26/Android-å‡çº§SupportLibrary/#0x01-æ³¨æ„äº‹é¡¹" class="headerlink" title="0x01 æ³¨æ„äº‹é¡¹"></a>0x01 æ³¨æ„äº‹é¡¹</h2><ul>
<li><p><code>compileSdkVersion</code>ä¸<code>buildToolsVersion</code>ç‰ˆæœ¬ä¸ä¸€è‡´</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">    /Users/ttdevs/Android/app/build/intermediates/res/merged/debug/values-v24/values-v24.xml</div><div class="line">Error:(<span class="number">3</span>) Error retrieving parent <span class="keyword">for</span> item: No resource found that matches the given name <span class="string">'android:TextAppearance.Material.Widget.Button.Borderless.Colored'</span>.</div><div class="line">Error:(<span class="number">4</span>) Error retrieving parent <span class="keyword">for</span> item: No resource found that matches the given name <span class="string">'android:TextAppearance.Material.Widget.Button.Colored'</span>.</div><div class="line">Error:(<span class="number">3</span>) Error retrieving parent <span class="keyword">for</span> item: No resource found that matches the given name <span class="string">'android:TextAppearance.Material.Widget.Button.Borderless.Colored'</span>.</div><div class="line">Error:(<span class="number">4</span>) Error retrieving parent <span class="keyword">for</span> item: No resource found that matches the given name <span class="string">'android:TextAppearance.Material.Widget.Button.Colored'</span>.</div><div class="line">Error:Execution failed <span class="keyword">for</span> task <span class="string">':app:processDebugResources'</span>.</div><div class="line">&gt; com.android.ide.common.process.ProcessException: Failed to execute aapt</div><div class="line">Information:BUILD FAILED</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="0xFF-å‚è€ƒ"><a href="/2017/05/26/Android-å‡çº§SupportLibrary/#0xFF-å‚è€ƒ" class="headerlink" title="0xFF å‚è€ƒ"></a>0xFF å‚è€ƒ</h2><ul>
<li><a href="https://developer.android.com/topic/libraries/support-library/index.html" target="_blank" rel="external">https://developer.android.com/topic/libraries/support-library/index.html</a></li>
<li><a href="https://developer.android.com/topic/libraries/support-library/revisions.html" target="_blank" rel="external">https://developer.android.com/topic/libraries/support-library/revisions.html</a></li>
<li><a href="https://stackoverflow.com/questions/41365401/how-to-fix-eror-app-build-intermediates-res-merged-debug-values-v24-values-v24-x" target="_blank" rel="external">https://stackoverflow.com/questions/41365401/how-to-fix-eror-app-build-intermediates-res-merged-debug-values-v24-values-v24-x</a></li>
</ul>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-Support-Library&quot;&gt;&lt;a href=&quot;/2017/05/26/Android-å‡çº§SupportLibrary/#0x00-Support-Library&quot; class=&quot;headerlink&quot; title=&quot;0x00 Support Li
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroid-Bluetoothã€0x02æ“ä½œ</title>
    <link href="https://ttdevs.github.io/2017/05/19/%5BAndroid-Bluetooth%5D0x02%E6%93%8D%E4%BD%9C/"/>
    <id>https://ttdevs.github.io/2017/05/19/[Android-Bluetooth]0x02æ“ä½œ/</id>
    <published>2017-05-18T16:00:00.000Z</published>
    <updated>2017-05-19T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-ä½åŠŸè€—è“ç‰™ï¼ˆBLEï¼‰"><a href="/2017/05/19/[Android-Bluetooth]0x02æ“ä½œ/#0x00-ä½åŠŸè€—è“ç‰™ï¼ˆBLEï¼‰" class="headerlink" title="0x00 ä½åŠŸè€—è“ç‰™ï¼ˆBLEï¼‰"></a>0x00 ä½åŠŸè€—è“ç‰™ï¼ˆBLEï¼‰</h2><p>ä¸Šä¸€ç¯‡ç®€å•ä»‹ç»äº†ä¼ ç»Ÿè“ç‰™è®¾å¤‡çš„ä½¿ç”¨ï¼Œå½“ä½ æ²¿ç€ä¸Šä¸€ç¯‡çš„æ€è·¯å»è¿æ¥æŸäº›è“ç‰™è®¾å¤‡çš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°æ€»æ˜¯ä¸æˆåŠŸã€‚æ²¡é”™ï¼Œæˆ‘ä»¬è¿˜æœ‰å¦å¤–ä¸€ç§è“ç‰™æ²¡æœ‰è®²ï¼šä½åŠŸè€—è“ç‰™(BLE: Bluetooth Low Energy)ã€‚</p>
<p>è¿™å¹¶ä¸æ˜¯ä¸€ç§æ–°çš„ä¸œè¥¿ï¼Œå®ƒåªæ˜¯è“ç‰™åè®®ä¸­çš„ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ã€‚ä¹‹å‰æåˆ°çš„å¤šæ˜¯è“ç‰™2.0/2.1ï¼Œè¿™é‡Œçš„ä½åŠŸè€—è“ç‰™ï¼ˆBLEï¼‰ä¸»è¦æ˜¯æŒ‡è“ç‰™4.0/4.1/4.2ã€‚åœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­è¿™ç§è“ç‰™è¶Šæ¥è¶Šå¸¸è§ï¼Œæ¯”å¦‚å„ç§æ‰‹ç¯ã€ä½“è„‚ç§¤ã€æ™ºèƒ½è®¾å¤‡ã€ä¾¿æºè“ç‰™è®¾å¤‡ç­‰ç­‰ã€‚</p>
<p>æ›´å¤šå…³äºè“ç‰™çš„ä»‹ç»å¯ä»¥å‚è€ƒ<a href="https://zh.wikipedia.org/wiki/è“ç‰™" target="_blank" rel="external">è¿™é‡Œ</a></p>
<h2 id="0x01-è“ç‰™åè®®æ ˆ"><a href="/2017/05/19/[Android-Bluetooth]0x02æ“ä½œ/#0x01-è“ç‰™åè®®æ ˆ" class="headerlink" title="0x01 è“ç‰™åè®®æ ˆ"></a>0x01 è“ç‰™åè®®æ ˆ</h2><p>å’Œå­¦ä¹  TCP/IP ä¸€æ ·ï¼Œå¦‚æœäº†è§£BLEçš„è®®æ ˆå¯¹æˆ‘ä»¬æŒæ¡è“ç‰™ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</p>
<p><img src="https://www.bluetooth.com/~/media/images/page-content/bluetooth%20stack.ashx?h=501&amp;w=388&amp;la=zh-cn&amp;hash=9756388D40595EB444E4B110F3587A323604714A" alt="è“ç‰™åè®®æ ˆ"></p>
<ul>
<li><p>ç‰©ç† (PHY) å±‚</p>
<p>  é€šè¿‡è“ç‰™é€šä¿¡ä¿¡é“æ§åˆ¶ 2.4Ghz å°„é¢‘çš„ä¼ è¾“/æ¥æ”¶ã€‚BR/EDR æä¾›çš„ä¿¡é“è¾ƒå¤šä½†å¸¦å®½è¾ƒçª„ï¼Œè€Œ LE ä½¿ç”¨çš„ä¿¡é“è¾ƒå°‘ä½†å¸¦å®½è¾ƒå®½ã€‚</p>
</li>
<li><p>é“¾è·¯å±‚</p>
<p>  å®šä¹‰æ•°æ®åŒ…ç»“æ„/ä¿¡é“ã€å‘ç°/è¿æ¥ç¨‹åºä»¥åŠå‘é€/æ¥æ”¶æ•°æ®ã€‚</p>
</li>
<li><p>ç›´æ¥æµ‹è¯•æ¨¡å¼</p>
<p>  å…è®¸æµ‹è¯•äººå‘˜å‘ PHY å±‚å‘å‡ºæŒ‡ä»¤ä»¥ä¼ è¾“æˆ–æ¥æ”¶ç»™å®šæ•°æ®åŒ…åºåˆ—ï¼Œé€šè¿‡ HCI æˆ– 2 çº¿ UART æ¥å£æäº¤å‘½ä»¤ã€‚</p>
</li>
<li><p>ä¸»æœºæ§åˆ¶å™¨æ¥å£ (HCI)</p>
<p>  è“ç‰™æ§åˆ¶å™¨å­ç³»ç»Ÿï¼ˆåº•éƒ¨ä¸‰å±‚ï¼‰å’Œè“ç‰™ä¸»æœºä¹‹é—´çš„å¯é€‰æ ‡å‡†æ¥å£ã€‚</p>
</li>
<li><p>é€»è¾‘é“¾è·¯æ§åˆ¶å’Œé€‚é…åè®® (L2CAP) å±‚</p>
<p>  åŸºäºæ•°æ®åŒ…çš„åè®®ï¼Œå¯å°†æ•°æ®åŒ…ä¼ è¾“è‡³ HCI æˆ–ç›´æ¥ä¼ è¾“åˆ°æ— ä¸»æœºç³»ç»Ÿä¸­çš„é“¾è·¯ç®¡ç†å™¨ã€‚æ”¯æŒæ›´é«˜çº§åˆ«çš„åè®®å¤šè·¯å¤ç”¨ã€æ•°æ®åŒ…åˆ†å‰²å’Œé‡ç»„ï¼Œä»¥åŠå°†æœåŠ¡è´¨é‡ä¿¡æ¯ä¼ è¾“åˆ°æ›´é«˜å±‚ã€‚</p>
</li>
<li><p>å±æ€§åè®® (ATT)</p>
<p>  åœ¨å»ºç«‹è¿æ¥ä¹‹åå®šä¹‰æ•°æ®äº¤æ¢å®¢æˆ·ç«¯/æœåŠ¡å™¨åè®®ã€‚ä½¿ç”¨é€šç”¨å±æ€§é…ç½®æ–‡ä»¶ (GATT) å°†å±æ€§åˆ†ç±»ä¸ºæœ‰æ„ä¹‰çš„æœåŠ¡ã€‚ATT ä¸»è¦ç”¨äº LE éƒ¨ç½²ï¼Œå¶å°”ä¹Ÿä¼šç”¨äº BR/EDR éƒ¨ç½²ã€‚</p>
</li>
<li><p>å®‰å…¨ç®¡ç†å™¨</p>
<p>  å®šä¹‰ç®¡ç†è“ç‰™è®¾å¤‡ä¹‹é—´é…å¯¹å®Œæ•´æ€§ã€èº«ä»½éªŒè¯ä»¥åŠåŠ å¯†çš„åè®®å’Œæ“ä½œï¼Œæä¾›å®‰å…¨åŠŸèƒ½å·¥å…·ç®±ï¼Œå…¶ä»–ç»„ä»¶å¯åˆ©ç”¨è¯¥å·¥å…·ç®±æ”¯æŒä¸åŒåº”ç”¨æ‰€éœ€çš„å„ç§å®‰å…¨çº§åˆ«ã€‚</p>
</li>
<li><p>é€šç”¨å±æ€§é…ç½®æ–‡ä»¶ (GATT)</p>
<p>  ä½¿ç”¨å±æ€§åè®®ï¼ŒGATT å¯¹å°è£…è®¾å¤‡ç»„ä»¶æ€§èƒ½çš„æœåŠ¡è¿›è¡Œåˆ†ç»„ï¼Œå¹¶æè¿°åŸºäº GATT åŠŸèƒ½çš„ç”¨ä¾‹ã€è§’è‰²å’Œä¸€èˆ¬æ€§èƒ½ã€‚å…¶æœåŠ¡æ¡†æ¶å®šä¹‰æœåŠ¡è§„ç¨‹å’Œæ ¼å¼åŠå…¶ç‰¹æ€§ï¼Œå…¶ä¸­åŒ…æ‹¬å‘ç°ã€è¯»å–ã€å†™å…¥ã€é€šçŸ¥ä»¥åŠæŒ‡ç¤ºç‰¹æ€§ä»¥åŠé…ç½®ç‰¹æ€§å¹¿æ’­ã€‚GATT ä»…ç”¨äºè“ç‰™ LE éƒ¨ç½²ã€‚ è¯¦ç»†äº†è§£ <a href="https://www.bluetooth.com/zh-cn/specifications/generic-attributes-overview" target="_blank" rel="external">GATT</a> ä¿¡æ¯ã€‚ </p>
</li>
<li><p>é€šç”¨è®¿é—®é…ç½®æ–‡ä»¶(GAP)</p>
</li>
</ul>
<p>å¯ä¸è“ç‰™ LE éƒ¨ç½²ä¸­çš„ GATT é…åˆä½¿ç”¨ï¼Œä»¥å®šä¹‰ä¸å‘ç°è“ç‰™è®¾å¤‡å’Œå…±äº«ä¿¡æ¯ç›¸å…³çš„è§„ç¨‹å’Œè§’è‰²ï¼Œä»¥åŠè¿æ¥è“ç‰™è®¾å¤‡çš„é“¾è·¯ç®¡ç†å†…å®¹ã€‚ </p>
<p><a href="https://www.bluetooth.com/zh-cn/specifications/bluetooth-core-specification" target="_blank" rel="external">ä»¥ä¸Šä¿¡æ¯æ¥è‡ªè¿™é‡Œ</a></p>
<h2 id="0x02-Androidç³»ç»Ÿä¸­çš„BLE"><a href="/2017/05/19/[Android-Bluetooth]0x02æ“ä½œ/#0x02-Androidç³»ç»Ÿä¸­çš„BLE" class="headerlink" title="0x02 Androidç³»ç»Ÿä¸­çš„BLE"></a>0x02 Androidç³»ç»Ÿä¸­çš„BLE</h2><p>Androidç³»ç»Ÿä¸­å¯¹äºä½åŠŸè€—è“ç‰™æˆ‘ä»¬éœ€è¦å…³å¿ƒä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>Android 4.3ï¼ˆ18ï¼‰å¼€å§‹æ”¯æŒBLE</li>
<li>Android 5.0ï¼ˆ21ï¼‰ä¹‹å‰æ‰‹æœºåªå¯ä»¥ä½œä¸ºä¸­å¿ƒè®¾å¤‡ï¼ˆCentral modeï¼‰ä½¿ç”¨ï¼Œ5.0ä¹‹åå¯ä»¥ä½œä¸ºå¤–è®¾ï¼ˆPeripheral modeï¼‰ä½¿ç”¨</li>
</ul>
<p>é™¤äº†ä»¥ä¸Šä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨å¯¹åè®®ä¸­çš„å‡ ä¸ªæ¦‚å¿µåšä¸ªä»‹ç»ï¼Œè¿™æ¶‰åŠåˆ°ä¹‹åçš„å¼€å‘ï¼š</p>
<ul>
<li><p>Attribute Protocol (ATT)</p>
<p>  å±æ€§åè®®ï¼Œå¯¹åº” <code>BluetoothGattService</code></p>
</li>
<li><p>Generic Attribute Profile (GATT)</p>
<p>  é€šç”¨å±æ€§é…ç½®æ–‡ä»¶ï¼Œå¯¹åº”Androidä¸­çš„ <code>BluetoothGatt</code></p>
</li>
<li><p>Characteristic</p>
<p>  <code>BluetoothGattCharacteristic</code></p>
</li>
<li><p>Descriptor</p>
<p>  <code>BluetoothGattDescriptor</code></p>
</li>
<li><p>Service</p>
<p>  <code>BluetoothGattService</code></p>
</li>
</ul>
<p><img src="https://www.bluetooth.com/~/media/images/page-content/gatt%20profile%20hierarchy.ashx?la=zh-cn&amp;hash=9323C669A731EA445651072296730FB343BA6BB5" alt=""></p>
<h2 id="0x03-Androidç³»ç»Ÿä¸­çš„BLEæ“ä½œæµç¨‹"><a href="/2017/05/19/[Android-Bluetooth]0x02æ“ä½œ/#0x03-Androidç³»ç»Ÿä¸­çš„BLEæ“ä½œæµç¨‹" class="headerlink" title="0x03 Androidç³»ç»Ÿä¸­çš„BLEæ“ä½œæµç¨‹"></a>0x03 Androidç³»ç»Ÿä¸­çš„BLEæ“ä½œæµç¨‹</h2><p>å’Œä¹‹å‰çš„æ™®é€šè“ç‰™ç›¸åŒï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ£€æµ‹è®¾å¤‡çš„è“ç‰™æ˜¯å¦å¯ç”¨ï¼Œç„¶åæ‰«æå‘¨å›´çš„è“ç‰™è®¾å¤‡ï¼Œç„¶åè¿æ¥ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒBLEçš„æ“ä½œå¹¶ä¸éœ€è¦é…å¯¹ã€‚å¦‚éœ€è¦åœ¨è®¾å¤‡å¿…é¡»æ”¯æŒä½åŠŸè€—è“ç‰™ï¼Œåˆ™è¿˜éœ€è¦åŠ ä¸Šè¿™å¥ï¼š</p>
<p><code>&lt;uses-feature android:name=&quot;android.hardware.bluetooth_le&quot; android:required=&quot;true&quot;/&gt;</code></p>
<ul>
<li><p>è“ç‰™æ‰«æ</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> mScanning;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scanLeDevice</span><span class="params">(<span class="keyword">final</span> <span class="keyword">boolean</span> enable)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (enable) &#123;</div><div class="line">        mHandler.postDelayed(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                mScanning = <span class="keyword">false</span>;</div><div class="line">                mBluetoothAdapter.stopLeScan(mLeScanCallback);</div><div class="line">            &#125;</div><div class="line">        &#125;, SCAN_PERIOD);</div><div class="line"></div><div class="line">        mScanning = <span class="keyword">true</span>;</div><div class="line">        mBluetoothAdapter.startLeScan(mLeScanCallback);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        mScanning = <span class="keyword">false</span>;</div><div class="line">        mBluetoothAdapter.stopLeScan(mLeScanCallback);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Device scan callback.</span></div><div class="line"><span class="keyword">private</span> BluetoothAdapter.LeScanCallback mLeScanCallback = <span class="keyword">new</span> BluetoothAdapter.LeScanCallback() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLeScan</span><span class="params">(<span class="keyword">final</span> BluetoothDevice device, <span class="keyword">int</span> rssi, <span class="keyword">byte</span>[] scanRecord)</span> </span>&#123;</div><div class="line">        String format = <span class="string">"Name:%s, Mac:%s, Type:%s"</span>;</div><div class="line">        String msg = String.format(format, device.getName(), device.getAddress(), device.getType());</div><div class="line">        print(msg);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>æ‰«æå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä¼šæ‹¿åˆ°è“ç‰™çš„è®¾å¤‡ä¿¡æ¯ï¼Œç„¶åå°±å¯ä»¥è¿›è¡Œè¿æ¥äº†ã€‚ 
</code></pre><ul>
<li><p>è¿æ¥è“ç‰™</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != intent) &#123;</div><div class="line">        mMAC = intent.getStringExtra(KEY_MAC);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (TextUtils.isEmpty(mMAC)) &#123;</div><div class="line">        mMAC = MAC_BIKE;</div><div class="line">    &#125;</div><div class="line">    mBluetoothManager = (BluetoothManager) getSystemService(Context.BLUETOOTH_SERVICE);</div><div class="line">    mBluetoothAdapter = mBluetoothManager.getAdapter();</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == mBluetoothAdapter) &#123;</div><div class="line">        stopSelf();</div><div class="line">        <span class="keyword">return</span> START_NOT_STICKY;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    BluetoothDevice device = mBluetoothAdapter.getRemoteDevice(mMAC);</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == device) &#123;</div><div class="line">        stopSelf();</div><div class="line">        <span class="keyword">return</span> START_NOT_STICKY;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    closeConnect();</div><div class="line"></div><div class="line">    mBluetoothGatt = device.connectGatt(<span class="keyword">this</span>, <span class="keyword">false</span>, mCallBack);</div><div class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123; <span class="comment">//5.0è®¾ç½®çš„ä¼ è¾“æœ€å¤§ç©ºé—´</span></div><div class="line">        mBluetoothGatt.requestConnectionPriority(BluetoothGatt.CONNECTION_PRIORITY_HIGH);</div><div class="line">        mBluetoothGatt.requestMtu(<span class="number">84</span>);</div><div class="line">    &#125;</div><div class="line">    print(<span class="string">"Gatt connect"</span>);</div><div class="line">    <span class="keyword">return</span> START_STICKY;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>è¿æ¥è“ç‰™</p>
<p>  åœ¨è¿æ¥çš„CallBackä¸­å¦‚æœæˆ‘ä»¬æ£€æµ‹åˆ°è¿æ¥æˆåŠŸï¼Œæ‰å¯ä»¥è¯·æ±‚è“ç‰™æä¾›çš„æœåŠ¡ï¼Œè¿™é‡Œå…ˆæ£€æµ‹è¿æ¥çš„çŠ¶æ€ï¼š</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothGattCallback mCallBack = <span class="keyword">new</span> BluetoothGattCallback() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConnectionStateChange</span><span class="params">(BluetoothGatt gatt, <span class="keyword">int</span> status, <span class="keyword">int</span> newState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onConnectionStateChange(gatt, status, newState);</div><div class="line"></div><div class="line">        print(String.format(<span class="string">"status:%d, newState:%d"</span>, status, newState));</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (status != BluetoothGatt.GATT_SUCCESS) &#123;</div><div class="line">            closeConnect();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">switch</span> (newState) &#123;</div><div class="line">            <span class="keyword">case</span> BluetoothProfile.STATE_CONNECTED:</div><div class="line">                print(<span class="string">"è¿æ¥GATTæœåŠ¡æˆåŠŸï¼Œå¼€å§‹å‘ç°æœåŠ¡..."</span>);</div><div class="line">                gatt.discoverServices();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> BluetoothProfile.STATE_DISCONNECTED:</div><div class="line">                print(<span class="string">"æ–­å¼€GATTæœåŠ¡ï¼ŒBye"</span>);</div><div class="line">                closeConnect();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line"></div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>å‘ç°æœåŠ¡</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> BluetoothGattCallback mCallBack = <span class="keyword">new</span> BluetoothGattCallback() &#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServicesDiscovered</span><span class="params">(BluetoothGatt gatt, <span class="keyword">int</span> status)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onServicesDiscovered(gatt, status);</div><div class="line"></div><div class="line">        print(<span class="string">"å‘ç°æœåŠ¡ï¼š"</span> + status);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (BluetoothGatt.GATT_SUCCESS == status) &#123;</div><div class="line">            List&lt;BluetoothGattService&gt; gattServices = gatt.getServices();</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == gattServices || gattServices.size() == <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">for</span> (BluetoothGattService gattService : gattServices) &#123;</div><div class="line">                String serviceUUID = gattService.getUuid().toString();</div><div class="line">                print(<span class="string">"UUID GATT:"</span> + serviceUUID);</div><div class="line">                List&lt;BluetoothGattCharacteristic&gt; characteristics = gattService.getCharacteristics();</div><div class="line">                <span class="keyword">for</span> (BluetoothGattCharacteristic characteristic : characteristics) &#123;</div><div class="line">                    String uuid = characteristic.getUuid().toString();</div><div class="line">                    print(<span class="string">"UUID     Cha:"</span> + uuid);</div><div class="line">                    print(<span class="string">"UUID     Status:"</span> + getProperties(characteristic));</div><div class="line">                    <span class="keyword">if</span> (UUID_RECEIVE.toString().equalsIgnoreCase(uuid)) &#123;</div><div class="line">                        mBluetoothGatt.setCharacteristicNotification(characteristic, <span class="keyword">true</span>);</div><div class="line">                        print(<span class="string">"å¼€å§‹ç›‘å¬ï¼š"</span> + uuid);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>ä½¿ç”¨æœåŠ¡</p>
<p>  â€¦</p>
</li>
</ul>
<h2 id="0x04-è¿˜éœ€è¦äº†è§£çš„ä¸€äº›ç»†èŠ‚"><a href="/2017/05/19/[Android-Bluetooth]0x02æ“ä½œ/#0x04-è¿˜éœ€è¦äº†è§£çš„ä¸€äº›ç»†èŠ‚" class="headerlink" title="0x04 è¿˜éœ€è¦äº†è§£çš„ä¸€äº›ç»†èŠ‚"></a>0x04 è¿˜éœ€è¦äº†è§£çš„ä¸€äº›ç»†èŠ‚</h2><ul>
<li>UUID</li>
</ul>
<ul>
<li>åˆ¤æ–­æœåŠ¡çš„å±æ€§</li>
</ul>
<h2 id="0x05-å¯èƒ½ä¼šé‡åˆ°çš„å‘"><a href="/2017/05/19/[Android-Bluetooth]0x02æ“ä½œ/#0x05-å¯èƒ½ä¼šé‡åˆ°çš„å‘" class="headerlink" title="0x05 å¯èƒ½ä¼šé‡åˆ°çš„å‘"></a>0x05 å¯èƒ½ä¼šé‡åˆ°çš„å‘</h2><p>æ‰‹ä¸Šçš„ä¸¤å°é­…æ—è®¾å¤‡ï¼Œè¿æ¥ä¸€ä¸ªå®¢æˆ·æä¾›çš„è“ç‰™æ¨¡å—ï¼Œæ­»æ´»è¿ä¸ä¸Šï¼Œå…¶ä»–æ‰‹æœºè¿æ¥æ­£å¸¸ã€‚è¿™ä¸¤éƒ¨è®¾å¤‡è¿æ¥æ·˜å®ä¸Šä¹°çš„ä¸€ä¸ªè“ç‰™æ¨¡å—æ­£å¸¸ã€‚</p>
<h2 id="0xFF-å‚è€ƒ"><a href="/2017/05/19/[Android-Bluetooth]0x02æ“ä½œ/#0xFF-å‚è€ƒ" class="headerlink" title="0xFF å‚è€ƒ"></a>0xFF å‚è€ƒ</h2><ul>
<li><a href="https://developer.android.com/guide/topics/connectivity/bluetooth-le.html" target="_blank" rel="external">https://developer.android.com/guide/topics/connectivity/bluetooth-le.html</a></li>
<li><a href="https://www.bluetooth.com/zh-cn/specifications/bluetooth-core-specification" target="_blank" rel="external">https://www.bluetooth.com/zh-cn/specifications/bluetooth-core-specification</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E8%97%8D%E7%89%99#.E8.97.8D.E7.89.994.0" target="_blank" rel="external">https://zh.wikipedia.org/wiki/%E8%97%8D%E7%89%99#.E8.97.8D.E7.89.994.0</a></li>
<li><a href="https://race604.com/android-ble-in-action/" target="_blank" rel="external">https://race604.com/android-ble-in-action/</a></li>
<li><a href="http://blog.csdn.net/qinxiandiqi/article/details/40741269" target="_blank" rel="external">http://blog.csdn.net/qinxiandiqi/article/details/40741269</a></li>
<li><a href="http://www.jianshu.com/p/8690dbafe849" target="_blank" rel="external">http://www.jianshu.com/p/8690dbafe849</a></li>
<li><a href="https://www.bluetooth.com/zh-cn/specifications/adopted-specifications" target="_blank" rel="external">https://www.bluetooth.com/zh-cn/specifications/adopted-specifications</a></li>
<li><a href="https://www.bluetooth.org/DocMan/handlers/DownloadDoc.ashx?doc_id=286439" target="_blank" rel="external">https://www.bluetooth.org/DocMan/handlers/DownloadDoc.ashx?doc_id=286439</a></li>
</ul>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-ä½åŠŸè€—è“ç‰™ï¼ˆBLEï¼‰&quot;&gt;&lt;a href=&quot;/2017/05/19/[Android-Bluetooth]0x02æ“ä½œ/#0x00-ä½åŠŸè€—è“ç‰™ï¼ˆBLEï¼‰&quot; class=&quot;headerlink&quot; title=&quot;0x00 ä½åŠŸè€—è“ç‰™ï¼ˆBLEï¼‰&quot;&gt;&lt;/a&gt;0x0
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
      <category term="Bluetooth" scheme="https://ttdevs.github.io/tags/Bluetooth/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroid-Bluetoothã€0x01æ“ä½œ</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid-Bluetooth%5D0x01%E6%93%8D%E4%BD%9C/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android-Bluetooth]0x01æ“ä½œ/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-è“ç‰™ï¼ˆBluetoothï¼‰"><a href="/1970/01/01/[Android-Bluetooth]0x01æ“ä½œ/#0x00-è“ç‰™ï¼ˆBluetoothï¼‰" class="headerlink" title="0x00 è“ç‰™ï¼ˆBluetoothï¼‰"></a>0x00 è“ç‰™ï¼ˆBluetoothï¼‰</h2><p>è¿™ä¸ªå°ç¡¬ä»¶å·²ç»æ˜¯Androidæœºå™¨çš„æ ‡é…äº†ï¼Œç”±äºå¹³æ—¶ä¸æ€ä¹ˆç”¨ï¼Œå› æ­¤åˆ°ç°åœ¨éƒ½æ²¡æœ‰å»ç ”ç©¶è¿‡ã€‚ç°åœ¨æœ‰ä¸€ä¸ªç®€å•çš„å°éœ€æ±‚ï¼šé€šè¿‡è“ç‰™è¿æ¥ä¸€ä¸ªä¸²å£è®¾å¤‡è¯»å–å…¶ä¸Šé¢çš„æ•°æ®ï¼Œå³ä»å·²é…å¯¹çš„è®¾å¤‡åˆ—è¡¨ä¸­é€‰æ‹©æˆ‘ä»¬çš„ä¸²å£è“ç‰™è®¾å¤‡ï¼ˆä»ï¼‰ï¼Œè¿æ¥ï¼Œç„¶åè¯»å–æ•°æ®ã€‚é‚å†™æ­¤æ–‡ã€‚</p>
<h2 id="0x01-ç®€å•ä½¿ç”¨"><a href="/1970/01/01/[Android-Bluetooth]0x01æ“ä½œ/#0x01-ç®€å•ä½¿ç”¨" class="headerlink" title="0x01 ç®€å•ä½¿ç”¨"></a>0x01 ç®€å•ä½¿ç”¨</h2><p>è“ç‰™è®¾å¤‡çš„è¯¦ç»†ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ<a href="https://developer.android.google.cn/guide/topics/connectivity/bluetooth.html" target="_blank" rel="external">Androidå…³äºè“ç‰™çš„å®˜æ–¹æ–‡æ¡£</a>ã€‚å¦‚æœä½ å’Œæˆ‘ä¸€æ ·ï¼Œä¹‹å‰æ²¡æœ‰ç ”ç©¶è¿‡è“ç‰™ï¼Œä¼°è®¡çœ‹çœ‹å®Œåä¹Ÿä¼šæœ‰ä¸€å †é—®é¢˜å­˜åœ¨ï¼šä»€ä¹ˆä¸»è®¾å¤‡ã€ä»è®¾å¤‡ã€UUIDæ˜¯å¹²å˜›çš„ï¼Œå¦‚ä½•å…å¯†é’¥é…å¯¹ç­‰ç­‰ã€‚ä¸ç€æ€¥ï¼Œæˆ‘ä»¬æ…¢æ…¢æ¥ã€‚</p>
<p>ä¸Šé¢å·²ç»è¯´åˆ°ï¼Œæˆ‘ä»¬çš„è®¾å¤‡å·²ç»æå‰é…å¯¹å®Œæˆï¼ˆæ€ä¹ˆé…å¯¹ï¼šç½‘ç»œè®¾ç½®ä¸­ä¸­æ‰¾åˆ°è“ç‰™ï¼Œç„¶åæœç´¢ï¼Œæ‰¾åˆ°ä½ çš„è®¾å¤‡ï¼Œç„¶åé…å¯¹ã€‚è¿™ä¸ªæ—¶å€™å¯èƒ½ä¼šæç¤ºè¾“å…¥å¯†ç ï¼Œé»˜è®¤å¯†ç æ¯”0000ï¼Œ1234ç­‰ï¼‰ã€‚æˆ‘ä»¬åªéœ€è¦è¿æ¥å³å¯ã€‚ä¸‹é¢ç®€è¿°æ“ä½œæ­¥éª¤ï¼š</p>
<ol>
<li><p>æ·»åŠ è“ç‰™æƒé™</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BLUETOOTH"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BLUETOOTH_ADMIN"</span> /&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>åˆ¤æ–­æ˜¯å¦æ”¯æŒè“ç‰™</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initBluetooth</span><span class="params">()</span> </span>&#123;</div><div class="line">    mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == mBluetoothAdapter) &#123;</div><div class="line">        tvContent.setText(<span class="string">"BluetoothAdapter is null"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (!mBluetoothAdapter.isEnabled()) &#123;</div><div class="line">        tvContent.setText(<span class="string">"BluetoothAdapter is disable, please open it"</span>);</div><div class="line"></div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);</div><div class="line">        startActivityForResult(intent, REQUEST_ENABLE_BT);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    tvContent.setText(<span class="string">"Bluetooth init success"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>é¦–å…ˆæ˜¯åˆ¤æ–­æ˜¯å¦æœ‰è“ç‰™é€‚é…å™¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œ`BluetoothAdapter.getDefaultAdapter()` è¿”å› `null`ã€‚ç„¶ååˆ¤æ–­è“ç‰™è®¾å¤‡æ˜¯å¦å¯ç”¨ `mBluetoothAdapter.isEnabled()` ï¼Œå¦‚æœæœªå¯ç”¨ï¼Œåˆ™å‘é€ä¸€ä¸ª `Intent` æ¥è®©ç”¨æˆ·å¯ç”¨è“ç‰™ï¼Œè¿™ä¸ª `Intent` æ˜¯ç³»ç»Ÿçš„ï¼Œæˆ‘ä»¬åœ¨ `onActivityResult` ä¸­å¤„ç†ç”¨æˆ·æ“ä½œç»“æœï¼Œå¦‚æœç”¨æˆ·é¡ºåˆ©å¼€å¯è“ç‰™ï¼Œåˆ™ä¼šè¿”å› `RESULT_OK`ã€‚
</code></pre><ol>
<li><p>è·å–è®¾å¤‡åˆ—è¡¨</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Set&lt;BluetoothDevice&gt; pairedDevices = mBluetoothAdapter.getBondedDevices();</div><div class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != pairedDevices &amp;&amp; pairedDevices.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">  <span class="keyword">for</span> (BluetoothDevice device : pairedDevices) &#123;</div><div class="line">      ......</div><div class="line">      String msg = String.format(<span class="string">"%s %s\n"</span>, device.getName(), device.getAddress());</div><div class="line">      ......</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æ‹¿åˆ° `BluetoothDevice` ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­ä¿å­˜äº†å·²é…å¯¹è“ç‰™è®¾å¤‡çš„ä¿¡æ¯ï¼Œæ¯”å¦‚åç§°ï¼ŒMACåœ°å€ï¼ŒçŠ¶æ€ï¼ŒUUIDç­‰ä¿¡æ¯ï¼ˆä½†è¿™äº›ä¿¡æ¯ä¸ä¸€å®šéƒ½éƒ½ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜ä¸‹æ¥ï¼Œåœ¨æ¥ä¸‹æ¥è¿æ¥çš„æ—¶å€™ä¼šä½¿ç”¨ã€‚
</code></pre><ol>
<li><p>è¿æ¥è®¾å¤‡</p>
<p> æœ‰äº† <code>BluetoothDevice</code> ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿æ¥è¿™ä¸ªå·²ç»é…å¯¹çš„è“ç‰™è®¾å¤‡äº†ã€‚</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> UUID DEFAULT_UUID = UUID.fromString(<span class="string">"00001101-0000-1000-8000-00805f9b34fb"</span>);</div><div class="line"></div><div class="line"> <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> == mSocket)&#123;</div><div class="line">        mSocket = mDevice.createRfcommSocketToServiceRecord(DEFAULT_UUID);</div><div class="line">    &#125;</div><div class="line">    mSocket.connect(); <span class="comment">// é˜»å¡çš„</span></div><div class="line"></div><div class="line">    mIn = mSocket.getInputStream();</div><div class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>è¿æ¥æˆåŠŸåï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª `BluetoothSocket` å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶é˜»å¡çš„ `connect()` æ–¹æ³•ï¼Œç­‰å¾…ä¸¤å°è®¾å¤‡è¿æ¥æˆåŠŸï¼ˆæ‰€ä»¥è¿™ä¸ªæ—¶å€™å¿…é¡»åœ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­è¿›è¡Œï¼‰ã€‚å½“ä¸¤å°è®¾å¤‡è¿æ¥æˆåŠŸä¹‹åä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚
</code></pre><ol>
<li><p>è¯»å–æ•°æ®</p>
<p> è¿æ¥æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>mSocket.getInputStream()</code> è·å¾—ä¸€ä¸ªè¾“å…¥æµï¼Œç»“ä¸‹æ¥çš„æ“ä½œå°±æ˜¯æµçš„æ“ä½œäº†ï¼Œè¿™ä¸ªå’Œæ™®é€š <code>socket</code> ä¸­è¾“å…¥è¾“å‡ºæµçš„æ“ä½œä¸€æ ·äº†ã€‚</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">try</span> &#123;</div><div class="line">    mBytes = mIn.read(readBuffer);</div><div class="line">    System.arraycopy(readBuffer, <span class="number">0</span>, tempBuffer, mCount, mBytes);</div><div class="line">    mCount += mBytes;</div><div class="line">    <span class="keyword">if</span> (mCount &gt;= SIZE) &#123;</div><div class="line">        parseData(tempBuffer);</div><div class="line">        mCount = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="0x02-æ€»ç»“"><a href="/1970/01/01/[Android-Bluetooth]0x01æ“ä½œ/#0x02-æ€»ç»“" class="headerlink" title="0x02 æ€»ç»“"></a>0x02 æ€»ç»“</h2><p>Androidè“ç‰™ï¼ˆä¸»ä»ï¼‰çš„æ“ä½œï¼š</p>
<ul>
<li>æ£€æŸ¥æ˜¯å¦æ”¯æŒï¼Œæ˜¯å¦å¯ç”¨ï¼ˆåŒ…æ‹¬æ˜¯å¦å¯è§ç­‰ï¼‰</li>
<li>æ‰«æè®¾å¤‡</li>
<li>é…å¯¹</li>
<li>è¿æ¥</li>
<li>æ•°æ®äº¤æ¢</li>
<li>ç­‰ç­‰</li>
</ul>
<p>è¿™é‡Œåªè®²äº†æ£€æŸ¥éƒ¨åˆ†æ“ä½œï¼Œæ¶‰åŠçš„æ‰«æä¸é…å¯¹å¯èƒ½æ˜¯æ›´å¤æ‚ä¸€äº›çš„ï¼Œåœ¨æ¥ä¸‹æ¥è®²è¿°ã€‚</p>
<p>æœ€åï¼Œé¡¹ç›®ä»£ç å¯å‚è€ƒè¿™é‡Œ<a href="https://github.com/ttdevs/android/tree/master/apps/air" target="_blank" rel="external">github/ttdevs/air</a>ã€‚</p>
<h2 id="0x03-Javaçº¿ç¨‹çš„å°è£…"><a href="/1970/01/01/[Android-Bluetooth]0x01æ“ä½œ/#0x03-Javaçº¿ç¨‹çš„å°è£…" class="headerlink" title="0x03 Javaçº¿ç¨‹çš„å°è£…"></a>0x03 Javaçº¿ç¨‹çš„å°è£…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by ttdevs</div><div class="line"> * 2017-01-22 (android)</div><div class="line"> * https://github.com/ttdevs</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseWorkerThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isRunning = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.run();</div><div class="line">        isRunning = workerBefore();</div><div class="line"></div><div class="line">        <span class="keyword">while</span> (isRunning) &#123;</div><div class="line">            workerCycle();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        workerAfter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * æå‰æ‰§è¡Œ true: ç»§ç»­ false: ç»“æŸ</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">workerBefore</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å·¥ä½œæ–¹æ³•ï¼Œè¢«å¾ªç¯è°ƒç”¨</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> true: ç»§ç»­ false: ç»“æŸ</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">workerCycle</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ç»“æŸæ‰§è¡Œ</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">workerAfter</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å¼€å§‹çº¿ç¨‹</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startThread</span><span class="params">()</span> </span>&#123;</div><div class="line">        isRunning = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            start();</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">            isRunning = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ç»“æŸçº¿ç¨‹</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopThread</span><span class="params">()</span> </span>&#123;</div><div class="line">        isRunning = <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="0x04-å‚è€ƒ"><a href="/1970/01/01/[Android-Bluetooth]0x01æ“ä½œ/#0x04-å‚è€ƒ" class="headerlink" title="0x04 å‚è€ƒ"></a>0x04 å‚è€ƒ</h2><ul>
<li><a href="https://developer.android.google.cn/guide/topics/connectivity/bluetooth.html" target="_blank" rel="external">https://developer.android.google.cn/guide/topics/connectivity/bluetooth.html</a></li>
</ul>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-è“ç‰™ï¼ˆBluetoothï¼‰&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android-Bluetooth]0x01æ“ä½œ/#0x00-è“ç‰™ï¼ˆBluetoothï¼‰&quot; class=&quot;headerlink&quot; title=&quot;0x00 è“ç‰™ï¼ˆBluetoothï¼‰
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
      <category term="Bluetooth" scheme="https://ttdevs.github.io/tags/Bluetooth/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroid-SQLiteã€0x02ä»åŠ è½½æœ¬åœ°æ•°æ®åº“å¼€å§‹</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid-SQLite%5D0x02%E4%BB%8E%E5%8A%A0%E8%BD%BD%E6%9C%AC%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%80%E5%A7%8B/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android-SQLite]0x02ä»åŠ è½½æœ¬åœ°æ•°æ®åº“å¼€å§‹/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å¼•è¨€"><a href="/1970/01/01/[Android-SQLite]0x02ä»åŠ è½½æœ¬åœ°æ•°æ®åº“å¼€å§‹/#0x00-å¼•è¨€" class="headerlink" title="0x00 å¼•è¨€"></a>0x00 å¼•è¨€</h2><blockquote>
<p>å¥½ä¹…ä»¥å‰å°±å†™äº†ï¼Œä½†æ˜¯ä¸€ç›´æ‹–æ‹–æ‹‰æ‹‰çš„ï¼Œåœ¨è‰ç¨¿ç®±é‡Œæ”¾äº†ä¸¤ä¸ªæ˜ŸæœŸè¿˜æ²¡å†™å®Œï¼Œæƒ³æƒ³è¿™æ ·æ‰˜ä¸‹å»åˆè¦åºŸæ‰äº†ï¼Œè¿˜æ˜¯åˆ†å¼€æ¥å§ï¼Œå†™å¤šå°‘æ˜¯å¤šå°‘ã€‚</p>
</blockquote>
<p>Androidçš„SQLiteæ•°æ®åº“ç®€å•ä½¿ç”¨ä¸€æ®µæ—¶é—´äº†ï¼Œç°åœ¨æƒ³æŠ½äº›æ—¶é—´æ€»ç»“ä¸‹ï¼Œä¸ç„¶æ€»æ„Ÿè§‰å¾ˆä¹±ã€‚</p>
<h2 id="0x01-SQLiteExpert"><a href="/1970/01/01/[Android-SQLite]0x02ä»åŠ è½½æœ¬åœ°æ•°æ®åº“å¼€å§‹/#0x01-SQLiteExpert" class="headerlink" title="0x01 SQLiteExpert"></a>0x01 SQLiteExpert</h2><p>å…ˆè¯´ä¸€ä¸ªå·¥å…·ï¼Œ<code>SQLite Expert</code>ï¼Œä¸€æ¬¾SQLiteæ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œä¸‹è½½åœ°å€ï¼š <a href="http://www.sqliteexpert.com/" target="_blank" rel="external">http://www.sqliteexpert.com/</a>ï¼ŒPersonal Editionæ˜¯å…è´¹çš„ï¼Œæ—¥å¸¸ä½¿ç”¨åŸºæœ¬è¶³å¤Ÿï¼Œéœ€è¦ä¸“ä¸šç‰ˆçš„å¯ä»¥è‡ªè¡Œç½‘ä¸Šæ‰¾å¯»ã€‚å½“ç„¶ï¼Œå…¶ä»–å…è´¹çš„å·¥å…·è¿˜æœ‰å¾ˆå¤šï¼Œå¦‚ï¼š<code>SQLite Database Browser</code>ã€ <code>SQLiteManager</code> ç­‰ã€‚<br><img src="http://img.blog.csdn.net/20130916222611000?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHRkZXZz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<h2 id="0x02-åŠ è½½æœ¬åœ°æ•°æ®åº“"><a href="/1970/01/01/[Android-SQLite]0x02ä»åŠ è½½æœ¬åœ°æ•°æ®åº“å¼€å§‹/#0x02-åŠ è½½æœ¬åœ°æ•°æ®åº“" class="headerlink" title="0x02 åŠ è½½æœ¬åœ°æ•°æ®åº“"></a>0x02 åŠ è½½æœ¬åœ°æ•°æ®åº“</h2><p>å‡è®¾æˆ‘ä»¬SDCardçš„æ ¹ç›®å½•ä¸Šå·²ç»å­˜åœ¨ä¸€ä¸ªæ•°æ®åº“ï¼Œåç§°ä¸ºï¼šChinaCity.dbã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readDataBaseFromSDCard</span><span class="params">()</span> </span>&#123;</div><div class="line">    String dbPath = Environment.getExternalStorageDirectory() + <span class="string">"/ChinaCity.db"</span>;</div><div class="line"></div><div class="line">    File dbFile = <span class="keyword">new</span> File(dbPath);</div><div class="line">    <span class="keyword">if</span> (!dbFile.exists()) &#123;</div><div class="line">        Toast.makeText(getApplicationContext(), <span class="string">"è¯·å…ˆç‚¹å‡»æ‹·è´åˆ°SDCard"</span>, Toast.LENGTH_LONG).show();</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    openOrCreateDatabase(dbPath, SQLiteDatabase.CREATE_IF_NECESSARY, <span class="keyword">null</span>);</div><div class="line"></div><div class="line">    SQLiteDatabase db = SQLiteDatabase.openDatabase(dbPath, <span class="keyword">null</span>, SQLiteDatabase.OPEN_READWRITE);</div><div class="line">    <span class="comment">// db = openOrCreateDatabase(dbPath, SQLiteDatabase.OPEN_READWRITE, null);</span></div><div class="line"></div><div class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</div><div class="line">    Cursor cursor = db.rawQuery(<span class="string">"select * from china_provinces_code"</span>, <span class="keyword">null</span>);</div><div class="line">    <span class="keyword">while</span> (cursor.moveToNext()) &#123;</div><div class="line">        <span class="keyword">int</span> id = cursor.getInt(cursor.getColumnIndex(<span class="string">"_id"</span>));</div><div class="line">        String name = cursor.getString(cursor.getColumnIndex(<span class="string">"name"</span>));</div><div class="line">        sb.append(id + <span class="string">":"</span> + name + <span class="string">" \n"</span>);</div><div class="line">    &#125;</div><div class="line">    System.out.println(sb.toString());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…ˆç”¨SQLiteDatabaseçš„ä¸€ä¸ªé™æ€æ–¹æ³•openDatabaseæ‰“å¼€ä¸€ä¸ªæ•°æ®åº“ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸€èˆ¬ä¸ºnullï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºæ‰“å¼€æ•°æ®åº“çš„æ–¹å¼ï¼Œç”±äºåªéœ€è¦è¯»å–æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹© <code>SQLiteDatabase.OPEN_READONLY</code>ï¼Œæ­¤ç§æ–¹å¼çš„å¥½å¤„æ˜¯æ•°æ®åº“å­˜åœ¨çš„è¯å°±ä¸ä¼šå‡ºé”™ï¼›å¦å¤–ä¸€ç§ä¸º <code>SQLiteDatabase.OPEN_READWRITE</code>ï¼Œä»¥è¯»å†™çš„æ–¹å¼æ‰“å¼€ã€‚æ‰§è¡Œä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬ä¼šçœ‹ä¸ä¸Šå›¾ä¿¡æ¯ç›¸åŒçš„ï¼š</p>
<p><img src="http://img.blog.csdn.net/20130916225300890?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHRkZXZz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="">  </p>
<p>å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦ä¸€äº›åˆå§‹åŒ–æ•°æ®ï¼Œæ¯”å¦‚åŸå¸‚ä»£ç ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥äº‹å…ˆåˆ›å»ºå¥½ä¸€ä¸ªæ•°æ®åº“ï¼Œå†™å…¥åˆå§‹æ•°æ®ï¼Œå°†å…¶æ”¾å…¥è‡ªå·±çš„apkä¸­ä¸€èµ·åˆ†å‘ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä»èµ„æºæ–‡ä»¶ä¸­è¯»å–è¿™ä¸ªæ•°æ®åº“æ–‡ä»¶å†™å…¥åˆ°åº”ç”¨çš„æ•°æ®åº“ç›®å½•æˆ–è€…SDCardä¸­ï¼Œç„¶åå°±å¯ä»¥å¯¹å…¶æ“ä½œï¼Œæ‹·è´å¯ä»¥è¿™æ ·æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * æ‹·è´èµ„æºä¸­æ•°æ®åº“</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> where 1SDCARD,2LOCAL</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">copyDataBase</span><span class="params">(<span class="keyword">int</span> where)</span> </span>&#123;</div><div class="line">    <span class="comment">// æ¯ä¸ªåº”ç”¨éƒ½æœ‰ä¸€ä¸ªæ•°æ®åº“ç›®å½•ï¼Œä»–ä½äº /data/data/packagename/databases/ç›®å½•ä¸‹</span></div><div class="line">    String packageName = <span class="string">"com.ttdevs.citydata"</span>; <span class="comment">// xmlä¸­é…ç½®çš„</span></div><div class="line">    String dbName = <span class="string">"ChinaCity.db"</span>;</div><div class="line">    String dbPath = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">if</span> (where == <span class="number">1</span>) &#123; <span class="comment">// sdcard</span></div><div class="line">        dbPath = Environment.getExternalStorageDirectory() + File.separator + dbName;</div><div class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// local, TODO Environment.getDataDirectory()</span></div><div class="line">        dbPath = <span class="string">"/data/data/"</span> + packageName + <span class="string">"/databases/"</span> + dbName;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (where == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">new</span> File(<span class="string">"/data/data/"</span> + packageName + <span class="string">"/databases/"</span>).mkdirs();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (where == <span class="number">1</span> &amp;&amp; !Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState())) &#123;</div><div class="line">        <span class="keyword">return</span>; <span class="comment">// æœªæŒ‚è½½å¤–éƒ¨å­˜å‚¨ï¼Œæ‹·è´åˆ°å†…éƒ¨ä¸ç”¨åˆ¤æ–­</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    File dbFile = <span class="keyword">new</span> File(dbPath);</div><div class="line">    <span class="keyword">if</span> (dbFile.exists()) &#123;</div><div class="line">        dbFile.delete();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        dbFile.createNewFile();</div><div class="line">    &#125; <span class="keyword">catch</span> (IOException e1) &#123;</div><div class="line">        e1.printStackTrace();</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        InputStream is = getResources().getAssets().open(dbName);</div><div class="line">        OutputStream os = <span class="keyword">new</span> FileOutputStream(dbPath);</div><div class="line"></div><div class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">        <span class="keyword">int</span> length = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> ((length = is.read(buffer)) &gt; <span class="number">0</span>) &#123;</div><div class="line">            os.write(buffer, <span class="number">0</span>, length);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        os.flush();</div><div class="line">        os.close();</div><div class="line">        is.close();</div><div class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    Toast.makeText(getApplicationContext(), <span class="string">"æ‹·è´æˆåŠŸ"</span>, Toast.LENGTH_LONG).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»£ç ä¸æ˜¯å¾ˆä¸¥è°¨ï¼Œå‡‘æ´»ç€çœ‹å“ˆã€‚ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä½¿ç”¨æ•°æ®åº“ï¼Œæ•°æ®åº“çš„å¸¸ç”¨æ“ä½œï¼Œåœ¨æ¥ä¸‹æ¥çš„ä»‹ç»ä¸­ç»§ç»­ã€‚</p>
<h2 id="0x03-ä¸‹è½½"><a href="/1970/01/01/[Android-SQLite]0x02ä»åŠ è½½æœ¬åœ°æ•°æ®åº“å¼€å§‹/#0x03-ä¸‹è½½" class="headerlink" title="0x03 ä¸‹è½½"></a>0x03 ä¸‹è½½</h2><p>ChinaCity.dbæ•°æ®åº“ï¼š <a href="http://download.csdn.net/detail/ttdevs/6332431" target="_blank" rel="external">ä¸‹è½½</a></p>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-å¼•è¨€&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android-SQLite]0x02ä»åŠ è½½æœ¬åœ°æ•°æ®åº“å¼€å§‹/#0x00-å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å¼•è¨€&quot;&gt;&lt;/a&gt;0x00 å¼•è¨€&lt;/h2&gt;&lt;blockquot
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
      <category term="SQLite" scheme="https://ttdevs.github.io/tags/SQLite/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroid-SQLiteã€0x01åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid-SQLite%5D0x01%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android-SQLite]0x01åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“"><a href="/1970/01/01/[Android-SQLite]0x01åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“/#0x01-åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“" class="headerlink" title="0x01 åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“"></a>0x01 åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“</h2><p>å¤§å¤šæ•°æƒ…å†µï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦è‡ªå·±å»ç»´æŠ¤ä¸€ä¸ªæ•°æ®åº“ï¼Œå¸¸è§çš„åŒ…æ‹¬æ•°æ®åº“çš„åˆ›å»ºï¼Œå‡çº§ï¼Œé”€æ¯ç­‰æ“ä½œã€‚ androidæä¾›äº†SQLiteOpenHelperæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬åˆ›å»ºSQLiteOpenHelperçš„å®ç°ç±»ï¼Œé‡å†™ä»–çš„onCreate(), onUpgrade() æˆ–è€… onOpen()æ–¹æ³•ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œç®¡ç†ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataBaseOpenHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DATABASE_NAME = <span class="string">"ChinaCity.db"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DATABASE_VERSION = <span class="number">1</span>; <span class="comment">// Version must be &gt;= 1</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataBaseOpenHelper</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, DATABASE_NAME, <span class="keyword">null</span>, DATABASE_VERSION);</div><div class="line">        System.out.println(<span class="string">"DataBaseOpenHelper"</span>);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataBaseOpenHelper</span><span class="params">(Context context, <span class="keyword">int</span> version)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, DATABASE_NAME, <span class="keyword">null</span>, version);</div><div class="line">        System.out.println(<span class="string">"DataBaseOpenHelper version"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!db.isReadOnly()) &#123;</div><div class="line">            db.execSQL(<span class="string">"PRAGMA foreign_keys = ON;"</span>); <span class="comment">// Enable foreign key constraints </span></div><div class="line">        &#125;</div><div class="line">        <span class="comment">// create table test(id integer references students(id),score integer check (score&lt;=100 and score&lt;=0),primary key(id,score))</span></div><div class="line">        <span class="keyword">super</span>.onOpen(db);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</div><div class="line">        CityData.createTable(db);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</div><div class="line">        CityData.dropTable(db);</div><div class="line">        CityData.createTable(db);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CityData</span> <span class="keyword">implements</span> <span class="title">BaseColumns</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE_TEXT = <span class="string">" text "</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE_INTEGER = <span class="string">" integer "</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String COMMA_SEP = <span class="string">","</span>;</div><div class="line"></div><div class="line">        <span class="comment">// *******************************china_city_code***********************************</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TABLE_NAME_CITY = <span class="string">"china_city_code"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String COLUMN_NAME_PROVINCE = <span class="string">"province"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String COLUMN_NAME_CITY = <span class="string">"city"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String COLUMN_NAME_COUNTY = <span class="string">"county"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String COLUMN_NAME_CODE = <span class="string">"code"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SQL_CREATE_CITY = <span class="string">"CREATE TABLE IF NOT EXISTS "</span> + TABLE_NAME_CITY + <span class="string">" ("</span> +</div><div class="line">                _ID + TYPE_INTEGER + <span class="string">" PRIMARY KEY AUTOINCREMENT, "</span> +</div><div class="line">                COLUMN_NAME_PROVINCE + TYPE_TEXT + COMMA_SEP +</div><div class="line">                COLUMN_NAME_CITY + TYPE_TEXT + COMMA_SEP +</div><div class="line">                COLUMN_NAME_COUNTY + TYPE_TEXT + COMMA_SEP +</div><div class="line">                COLUMN_NAME_CODE + TYPE_INTEGER</div><div class="line">                + <span class="string">" )"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SQL_CREATE_CITY_INDEX = <span class="string">"CREATE UNIQUE INDEX IF NOT EXISTS "</span> + COLUMN_NAME_CODE + <span class="string">" ON "</span> + TABLE_NAME_CITY + <span class="string">"("</span> + COLUMN_NAME_CODE + <span class="string">")"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SQL_DELETE_CITY = <span class="string">"DROP TABLE IF EXISTS "</span> + TABLE_NAME_CITY;</div><div class="line"></div><div class="line">        <span class="comment">// *******************************china_provinces_code*******************************</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TABLE_NAME_PROVINCE = <span class="string">"china_provinces_code"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String COLUMN_NAME_ID = <span class="string">"id"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String COLUMN_NAME_NAME = <span class="string">"name"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SQL_CREATE_PROVINCE = <span class="string">"CREATE TABLE IF NOT EXISTS "</span> + TABLE_NAME_PROVINCE + <span class="string">" ("</span> +</div><div class="line">                _ID + TYPE_INTEGER + <span class="string">" PRIMARY KEY AUTOINCREMENT, "</span> +</div><div class="line">                COLUMN_NAME_ID + TYPE_INTEGER + COMMA_SEP +</div><div class="line">                COLUMN_NAME_NAME + TYPE_TEXT</div><div class="line">                + <span class="string">" )"</span>;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SQL_DELETE_PROVINCE = <span class="string">"DROP TABLE IF EXISTS "</span> + TABLE_NAME_PROVINCE;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createTable</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</div><div class="line">            db.execSQL(SQL_CREATE_PROVINCE);</div><div class="line">            db.execSQL(SQL_CREATE_CITY);</div><div class="line">            db.execSQL(SQL_CREATE_CITY_INDEX);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dropTable</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</div><div class="line">            db.execSQL(SQL_DELETE_PROVINCE);</div><div class="line">            db.execSQL(SQL_DELETE_CITY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ„é€ å‡½æ•°ä¸­æˆ‘ä»¬éœ€è¦ä¼ å…¥å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸Šä¸‹æ–‡ï¼Œç¬¬äºŒä¸ªä¸ºæ•°æ®åº“åç§°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸€èˆ¬ä¸ºnullï¼Œç¬¬å››ä¸ªä¸ºæ•°æ®åº“çš„ç‰ˆæœ¬ã€‚onCreate()æ–¹æ³•ä¸­ä¸»è¦æ‰§è¡Œæ•°æ®åº“çš„åˆ›å»ºæ“ä½œã€‚onUpgrade()æ–¹æ³•ä¸»è¦åœ¨æ•°æ®åº“å‡çº§æ—¶è°ƒç”¨ï¼Œæºç  <code>android.database.sqlite.SQLiteOpenHelper.getDatabaseLocked(boolean writable)</code> ä¸­è¿™æ ·æè¿°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> SQLiteDatabase <span class="title">getDatabaseLocked</span><span class="params">(<span class="keyword">boolean</span> writable)</span> </span>&#123;</div><div class="line">   <span class="keyword">if</span> (mDatabase != <span class="keyword">null</span>) &#123;</div><div class="line">       <span class="keyword">if</span> (!mDatabase.isOpen()) &#123;</div><div class="line">           <span class="comment">// Darn!  The user closed the database by calling mDatabase.close().</span></div><div class="line">           mDatabase = <span class="keyword">null</span>;</div><div class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!writable || !mDatabase.isReadOnly()) &#123;</div><div class="line">           <span class="comment">// The database is already open for business.</span></div><div class="line">           <span class="keyword">return</span> mDatabase;</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="keyword">if</span> (mIsInitializing) &#123;</div><div class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"getDatabase called recursively"</span>);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   SQLiteDatabase db = mDatabase;</div><div class="line">   <span class="keyword">try</span> &#123;</div><div class="line">       mIsInitializing = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">       <span class="keyword">if</span> (db != <span class="keyword">null</span>) &#123;</div><div class="line">           <span class="keyword">if</span> (writable &amp;&amp; db.isReadOnly()) &#123;</div><div class="line">               db.reopenReadWrite();</div><div class="line">           &#125;</div><div class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mName == <span class="keyword">null</span>) &#123;</div><div class="line">           db = SQLiteDatabase.create(<span class="keyword">null</span>);</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           <span class="keyword">try</span> &#123;</div><div class="line">               <span class="keyword">if</span> (DEBUG_STRICT_READONLY &amp;&amp; !writable) &#123;</div><div class="line">                   <span class="keyword">final</span> String path = mContext.getDatabasePath(mName).getPath();</div><div class="line">                   db = SQLiteDatabase.openDatabase(path, mFactory,</div><div class="line">                           SQLiteDatabase.OPEN_READONLY, mErrorHandler);</div><div class="line">               &#125; <span class="keyword">else</span> &#123;</div><div class="line">                   db = mContext.openOrCreateDatabase(mName, mEnableWriteAheadLogging ?</div><div class="line">                           Context.MODE_ENABLE_WRITE_AHEAD_LOGGING : <span class="number">0</span>,</div><div class="line">                           mFactory, mErrorHandler);</div><div class="line">               &#125;</div><div class="line">           &#125; <span class="keyword">catch</span> (SQLiteException ex) &#123;</div><div class="line">               <span class="keyword">if</span> (writable) &#123;</div><div class="line">                   <span class="keyword">throw</span> ex;</div><div class="line">               &#125;</div><div class="line">               Log.e(TAG, <span class="string">"Couldn't open "</span> + mName</div><div class="line">                       + <span class="string">" for writing (will try read-only):"</span>, ex);</div><div class="line">               <span class="keyword">final</span> String path = mContext.getDatabasePath(mName).getPath();</div><div class="line">               db = SQLiteDatabase.openDatabase(path, mFactory,</div><div class="line">                       SQLiteDatabase.OPEN_READONLY, mErrorHandler);</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       onConfigure(db);</div><div class="line"></div><div class="line">       <span class="keyword">final</span> <span class="keyword">int</span> version = db.getVersion();</div><div class="line">       <span class="keyword">if</span> (version != mNewVersion) &#123;</div><div class="line">           <span class="keyword">if</span> (db.isReadOnly()) &#123;</div><div class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> SQLiteException(<span class="string">"Can't upgrade read-only database from version "</span> +</div><div class="line">                       db.getVersion() + <span class="string">" to "</span> + mNewVersion + <span class="string">": "</span> + mName);</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           db.beginTransaction();</div><div class="line">           <span class="keyword">try</span> &#123;</div><div class="line">               <span class="keyword">if</span> (version == <span class="number">0</span>) &#123;</div><div class="line">                   onCreate(db);</div><div class="line">               &#125; <span class="keyword">else</span> &#123;</div><div class="line">                   <span class="keyword">if</span> (version &gt; mNewVersion) &#123;</div><div class="line">                       onDowngrade(db, version, mNewVersion);</div><div class="line">                   &#125; <span class="keyword">else</span> &#123;</div><div class="line">                       onUpgrade(db, version, mNewVersion);</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">               db.setVersion(mNewVersion);</div><div class="line">               db.setTransactionSuccessful();</div><div class="line">           &#125; <span class="keyword">finally</span> &#123;</div><div class="line">               db.endTransaction();</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       onOpen(db);</div><div class="line"></div><div class="line">       <span class="keyword">if</span> (db.isReadOnly()) &#123;</div><div class="line">           Log.w(TAG, <span class="string">"Opened "</span> + mName + <span class="string">" in read-only mode"</span>);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       mDatabase = db;</div><div class="line">       <span class="keyword">return</span> db;</div><div class="line">   &#125; <span class="keyword">finally</span> &#123;</div><div class="line">       mIsInitializing = <span class="keyword">false</span>;</div><div class="line">       <span class="keyword">if</span> (db != <span class="keyword">null</span> &amp;&amp; db != mDatabase) &#123;</div><div class="line">           db.close();</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å½“å½“å‰ç‰ˆæœ¬å°äºæ–°ç‰ˆæœ¬æ—¶ï¼Œä¼šè°ƒç”¨onUpgrade()æ–¹æ³•ã€‚æ‰€ä»¥ä¸Šé¢SQLiteOpenHelperçš„å®ç°æ€è·¯ä¸ºï¼šæ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–ä¸€ä¸‹æ•°æ®åº“çš„å¿…è¦å‚æ•°ï¼Œå¦‚æ•°æ®åº“ç‰ˆæœ¬ï¼Œæ•°æ®åº“åç­‰ï¼›åœ¨onCreate()æ–¹æ³•ä¸­åˆ›å»ºæ•°æ®åº“çš„è¡¨ï¼›å½“æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œå‡çº§çš„æ—¶å€™ï¼Œä¿®æ”¹æ•°æ®åº“çš„ç‰ˆæœ¬å·ï¼Œè¿™æ ·å°±å¯ä»¥è§¦å‘onUpgrade()æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬åšæœ€ç®€å•çš„å¤„ç†ï¼šdropæ‰æ‰€æœ‰è¡¨ç„¶åé‡æ–°åˆ›å»ºã€‚å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥åœ¨onOpen()æ–¹æ³•ä¸­åšä¸€ä¸‹æ•°æ®åº“çš„è®¾ç½®æ“ä½œï¼Œå¦‚è®¾ç½®å¤–é”®ç”Ÿæ•ˆã€‚è¿™æ ·æˆ‘ä»¬çš„æ•°æ®åº“ç®¡ç†ç±»å°±å®ç°äº†ã€‚</p>
<h2 id="0x02-æ‹¿åˆ°æ•°æ®åº“å¯¹è±¡"><a href="/1970/01/01/[Android-SQLite]0x01åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“/#0x02-æ‹¿åˆ°æ•°æ®åº“å¯¹è±¡" class="headerlink" title="0x02 æ‹¿åˆ°æ•°æ®åº“å¯¹è±¡"></a>0x02 æ‹¿åˆ°æ•°æ®åº“å¯¹è±¡</h2><p>æœ‰äº†æ•°æ®åº“ç®¡ç†ç±»ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œæˆ‘ä»¬æœ€å¥½å°è£…ä¸€ä¸ªæ“ä½œç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­å¯¹æ•°æ®åº“ä¸­çš„è¡¨è¿›è¡Œæ“ä½œã€‚ä¸‹é¢çš„ä»£ç ä¹Ÿæ˜¯ç½‘ä¸Šæ¯”è¾ƒå¸¸è§çš„ï¼ˆå¯¹äºæ•°æ®åº“å¯¹è±¡ï¼Œä¹Ÿæœ‰å¤„ç†æˆå•ä¾‹ï¼‰ã€‚å…ˆçœ‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataBaseManager</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> DataBaseOpenHelper dbHelper;</div><div class="line">    <span class="keyword">private</span> SQLiteDatabase db;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataBaseManager</span><span class="params">(Context context)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        <span class="keyword">this</span>.dbHelper = <span class="keyword">new</span> DataBaseOpenHelper(context);</div><div class="line">        <span class="keyword">this</span>.db = dbHelper.getWritableDatabase();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CopyOfDataBaseManager</span><span class="params">(Context context, <span class="keyword">int</span> version)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        <span class="keyword">this</span>.dbHelper = <span class="keyword">new</span> DataBaseOpenHelper(context, version);</div><div class="line">        <span class="keyword">this</span>.db = dbHelper.getWritableDatabase();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeDataBase</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (db != <span class="keyword">null</span> &amp;&amp; db.isOpen()) &#123;</div><div class="line">            db.close();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isInitData</span><span class="params">(String tableName)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">        String sql = <span class="string">"select count(*) from "</span> + tableName;</div><div class="line">        Cursor cursor = db.rawQuery(sql, <span class="keyword">null</span>);</div><div class="line">        <span class="keyword">if</span> (cursor.moveToFirst()) &#123;</div><div class="line">            count = cursor.getInt(<span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> count &gt; <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearTable</span><span class="params">(String tableName)</span> </span>&#123;</div><div class="line">        String sql = <span class="string">"delete from "</span> + tableName + <span class="string">";"</span>;</div><div class="line">        sql += <span class="string">"update sqlite_sequence set seq = 0 where name = "</span> + tableName + <span class="string">";"</span>;</div><div class="line">        db.execSQL(sql);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertProvinceData</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</div><div class="line">        String sql = <span class="string">"insert into "</span> + CityData.TABLE_NAME_PROVINCE + <span class="string">" ("</span> + CityData.COLUMN_NAME_ID + <span class="string">","</span></div><div class="line">                + CityData.COLUMN_NAME_NAME + <span class="string">") VALUES("</span> + id + <span class="string">",'"</span> + name + <span class="string">"');"</span>;</div><div class="line">        db.execSQL(sql);</div><div class="line">        System.out.println(sql);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// TODOå…¶ä»–ä¸€ä¸‹å¯¹è¡¨è¿›è¡Œçš„æ“ä½œ</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªDataBaseOpenHelperçš„å®ä¾‹ï¼Œç„¶åé€šè¿‡å®ƒæ‹¿åˆ°SQLiteDatabaseå¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œäº†ã€‚DataBaseOpenHelperæœ‰ä¸¤ç§getæ–¹æ³•ï¼š<code>getWritableDatabase()</code> å’Œ <code>getReadableDatabase()</code>ï¼Œå¤§å®¶éƒ½åº”è¯¥çŸ¥é“ç€ä¸¤ç§æ–¹æ³•çš„å«ä¹‰ï¼Œ<code>getReadableDatabase()</code> æ‹¿åˆ°çš„æ•°æ®åº“å¯¹è±¡ä¸å¯ä»¥è¿›è¡Œæ’å…¥ä¿®æ”¹ç­‰å†™æ“ä½œã€‚åœ¨è¿™ä¸¤ç§æ–¹æ³•çš„è¯´æ˜åœ¨æˆ‘ä»¬å¯èƒ½éœ€è¦æ³¨æ„å‡ ç‚¹ï¼š</p>
<ul>
<li>å½“æˆ‘ä»¬æ²¡æœ‰ç”³è¯·æ•°æ®åº“æ“ä½œçš„æƒé™æˆ–è€…ç£ç›˜å·²æ»¡ï¼Œä¼šæŠ¥é”™</li>
<li>æ•°æ®åº“çš„æ›´æ–°å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨</li>
<li>å½“æˆ‘ä»¬ä¸å†å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œæ—¶ï¼Œåˆ«å¿˜è®°å…³é—­æ•°æ®åº“</li>
</ul>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ•°æ®åº“çš„å¸¸ç”¨æ“ä½œäº†</p>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x01-åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android-SQLite]0x01åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“/#0x01-åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“&quot; class=&quot;headerlink&quot; title=&quot;0x01 åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“&quot;&gt;&lt;/a&gt;0x01 åˆ›
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
      <category term="SQLite" scheme="https://ttdevs.github.io/tags/SQLite/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€0x01æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•SQLCipher</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5D0x01%E6%9C%AC%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E5%B0%9D%E8%AF%95SQLCipher/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]0x01æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•SQLCipher/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00"><a href="/1970/01/01/[Android]0x01æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•SQLCipher/#0x00" class="headerlink" title="0x00"></a>0x00</h2><p>å…ˆçºªå¿µä¸‹ï¼Œä»ä»Šå¤©å¼€å§‹ï¼Œåˆå¼€å§‹å†™åšå®¢å•¦å•¦å•¦å•¦ã€‚è¯è¯´åŸºæœ¬ä¸Šä¸€å¹´å¤šæ²¡å¥½å¥½å†™åšå®¢äº†ã€‚å›æƒ³èµ·æ¥ï¼Œå’Œä¹‹å‰å†™åšå®¢æ—¶ç›¸æ¯”ï¼Œè¿˜æ˜¯å·®è·å¥½å¤§ã€‚å¥½å§ï¼ŒåºŸè¯ä¸è¯´äº†ï¼Œè¿›å…¥æ­£é¢˜ã€‚</p>
<p>é¦–å…ˆï¼Œå¼€ç¯‡æ‰“ç®—è·Ÿå¤§å®¶åˆ†äº«ä¸‹ä½ é‡åˆ°çš„æˆ–è€…å°†æ¥å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼šæœ¬åœ°æ•°æ®çš„å®‰å…¨é—®é¢˜ã€‚å¤šæ•°æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½æ²¡æœ‰å»è€ƒè™‘appçš„æœ¬åœ°æ•°æ®å®‰å…¨é—®é¢˜ï¼Œä¸€æ¥å…¬å¸æ²¡è¿™æ ·çš„è¦æ±‚ï¼ŒäºŒæ¥æˆ‘ä»¬å¯èƒ½ä¹Ÿæ²¡æœ‰éå¸¸éœ€è¦ä¿å¯†çš„æ•°æ®ã€‚é‚£ç°åœ¨æ€è€ƒä¸€ä¸‹ä¸ºå°†æ¥åšå‚¨å¤‡ã€‚</p>
<p>é¢è¯•çš„æ—¶å€™ï¼Œå¯èƒ½å¸¸å¸¸ä¼šè¢«é—®åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šAndroidçš„æ•°æ®å­˜å‚¨æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œ<a href="http://developer.android.com/guide/topics/data/data-storage.html" target="_blank" rel="external">Androidçš„å®˜æ–¹æ–‡æ¡£</a> æœ‰å›ç­”ï¼š</p>
<ul>
<li>Shared Preferences</li>
<li>Internal Storage</li>
<li>External Storage</li>
<li>SQLite Databases</li>
<li>Network Connection</li>
</ul>
<p>è¿™å‡ ç§æ–¹å¼å°±ä¸ç”¨å¤šè¯´äº†ã€‚ç¬¬ä¸€ç§ä»¥key-valueçš„æ–¹å¼å­˜å‚¨åœ¨æˆ‘ä»¬çš„è®¾å¤‡å†…éƒ¨ï¼›ç¬¬äºŒç§ç¬¬ä¸‰ç§ç®€å•ç†è§£ä¸ºæ–‡ä»¶å­˜å‚¨ï¼›ç¬¬å››ç§æœ¬åœ°æ•°æ®åº“å­˜å‚¨ï¼ˆè¿™å››ç§éƒ½å±æœ¬åœ°å­˜å‚¨ï¼‰ã€‚æœ€åä¸€ç§æ–¹å¼ï¼ˆæš‚ä¸”ç®—æ˜¯ä¸€ç§æ–¹å¼å§ï¼‰ä¸åœ¨æˆ‘ä»¬è€ƒè™‘èŒƒå›´ä¹‹å†…ã€‚ç°åœ¨å‡è®¾ä¸€ä¸ªæœ€åçš„ç¯å¢ƒï¼šè®¾å¤‡å·²ç»rootï¼Œä»»ä½•æœ¬åœ°æ•°æ®éƒ½å¯ä»¥è¢«ç›´æ¥æˆ–è€…é—´æ¥æ‹¿åˆ°ã€‚è¿™æ—¶å€™æˆ‘ä»¬è‡ªç„¶æƒ³åˆ°çš„å°±æ˜¯å¯¹æˆ‘ä»¬çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚</p>
<h2 id="0x01"><a href="/1970/01/01/[Android]0x01æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•SQLCipher/#0x01" class="headerlink" title="0x01"></a>0x01</h2><p>ä»¥ä¸Šæ˜¯å¼€åœºï¼Œä¸‹é¢è¿›å…¥ç¬¬ä¸€éƒ¨åˆ†ï¼šæœ¬åœ°æ•°æ®åº“åŠ å¯†ã€‚<br>å…ˆå›é¡¾ä¸‹æœ¬åœ°æ•°æ®åº“ï¼Œrootä»¥åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸‹é¢çš„ä½ç½®æ‰¾åˆ°å®ƒï¼š<code>/data/data/you.package/databases</code>ï¼Œä¾‹å¦‚æˆ‘ä»¬demoçš„æ•°æ®åº“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">root@t03g:/data/data/com.ttdevs.demo/databases # ls</div><div class="line">normal_user.db</div><div class="line">normal_user.db-journal</div><div class="line">user.db</div><div class="line">root@t03g:/data/data/com.ttdevs.demo/databases #</div><div class="line">``` </div><div class="line"></div><div class="line">çŸ¥é“äº†å®ƒçš„ä½ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°†è¿™äº›æ•°æ®åº“æ–‡ä»¶æ‹·è´å‡ºæ¥ï¼Œç„¶åä½¿ç”¨SQLiteæµè§ˆå™¨æµè§ˆã€‚</div><div class="line">æˆ‘ä»¬é€‰ç”¨ç½‘ä¸Šä¸€ä¸ªå¼€æºçš„æ–¹æ¡ˆï¼š[SQLCipher][2]ï¼ˆ[GitHubåœ°å€][3]ï¼‰ã€‚SQLCipheræ˜¯åœ¨SQLiteçš„åŸºç¡€ä¸Šå°è£…äº†åŠ å¯†åŠŸèƒ½ï¼Œä½¿ç”¨ä¸Šå’Œç›´æ¥ä½¿ç”¨SQLiteåŸºæœ¬ç›¸åŒã€‚</div><div class="line"></div><div class="line"></div><div class="line">## 0x02</div><div class="line"></div><div class="line">é¦–å…ˆï¼ŒæŒ‰ç…§è¯´æ˜ï¼Œæˆ‘ä»¬å¼•å…¥SQLCipherï¼š</div><div class="line"></div><div class="line">``` gradle</div><div class="line">compile &apos;net.zetetic:android-database-sqlcipher:3.3.1-2@aar&apos;</div></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±æ˜¯ç¼–å†™æˆ‘ä»¬çš„æ•°æ®åº“ä»£ç äº†ã€‚å…ˆåˆ›å»ºä¸€ä¸ªDatabaseHelperï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> net.sqlcipher.database.SQLiteDatabase;</div><div class="line"><span class="keyword">import</span> net.sqlcipher.database.SQLiteOpenHelper;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseOpenHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DATABASE_NAME = <span class="string">"user.db"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DATABASE_VERSION = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TABLE = <span class="string">"user_info"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME = <span class="string">"name"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String AGE = <span class="string">"age"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ICON = <span class="string">"icon"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOKEN = <span class="string">"token"</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DatabaseOpenHelper</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, DATABASE_NAME, <span class="keyword">null</span>, DATABASE_VERSION);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</div><div class="line">        String sql = <span class="string">"create table "</span> + TABLE +</div><div class="line">                <span class="string">" (_id integer primary key autoincrement, "</span> +</div><div class="line">                NAME + <span class="string">" text, "</span> +</div><div class="line">                AGE + <span class="string">" integer, "</span> +</div><div class="line">                ICON + <span class="string">" blob, "</span> +</div><div class="line">                TOKEN + <span class="string">" text not null);"</span>;</div><div class="line">        Log.d(<span class="string">"EventsData"</span>, <span class="string">"onCreate: "</span> + sql);</div><div class="line">        db.execSQL(sql);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (oldVersion &lt; newVersion) &#123;</div><div class="line">            <span class="comment">// TODO</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>æ³¨æ„ï¼Œæ­¤å¤„çš„SQLiteOpenHelperå’ŒSQLiteDatabaseéƒ½æ¥è‡ªnet.sqlcipher.databaseåŒ…ã€‚</code></p>
<p>ä¸ºäº†ä¾¿äºå¯¹æ¯”ï¼Œæˆ‘åˆå†™äº†ä¸€ä¸ªç›¸åŒé€»è¾‘ä½¿ç”¨<code>android.database.sqlite.SQLiteOpenHelper</code>çš„Helperä½œå¯¹æ¯”ã€‚æ¥ä¸‹æ¥ä½¿ç”¨ç¼–å†™æ•°æ®åº“æ“ä½œé€»è¾‘ã€‚ä½¿ç”¨ä¸­SQLiteCipheråŒºåˆ«æ˜¯æ‰“å¼€æ•°æ®åº“çš„æ—¶å€™éœ€è¦ä¼ å…¥ç”¨äºåŠ å¯†çš„KEYã€‚ä¸‹é¢æ˜¯æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlcipherActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"&gt;&gt;&gt;&gt;&gt;"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CIPHER_KEY = <span class="string">"123abc_!@#$%^&amp;*"</span>;</div><div class="line">    <span class="keyword">private</span> DatabaseOpenHelper mOpenHelper;</div><div class="line">    <span class="keyword">private</span> NormalDatabaseOpenHelper mNormalHelper;</div><div class="line">...</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeData</span><span class="params">(<span class="keyword">boolean</span> isCipher)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isCipher) &#123;</div><div class="line">            log(<span class="string">"Cipher:101:"</span> + System.currentTimeMillis());</div><div class="line">            SQLiteDatabase db = mOpenHelper.getWritableDatabase(PASSWORD_KEY);</div><div class="line">            log(<span class="string">"Cipher:102:"</span> + System.currentTimeMillis());</div><div class="line">            String name = <span class="string">"Cipher"</span> + (++mIndex);</div><div class="line">            ContentValues values = <span class="keyword">new</span> ContentValues();</div><div class="line">            values.put(DatabaseOpenHelper.NAME, name);</div><div class="line">            values.put(DatabaseOpenHelper.AGE, mIndex);</div><div class="line">            values.put(DatabaseOpenHelper.TOKEN, PASSWORD_KEY);</div><div class="line">            values.put(DatabaseOpenHelper.ICON, name.getBytes());</div><div class="line">            log(<span class="string">"Cipher:11:"</span> + System.currentTimeMillis());</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                db.beginTransaction();</div><div class="line">                db.insert(DatabaseOpenHelper.TABLE, <span class="keyword">null</span>, values);</div><div class="line">                db.setTransactionSuccessful();</div><div class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125; <span class="keyword">finally</span> &#123;</div><div class="line">                db.endTransaction();</div><div class="line">            &#125;</div><div class="line">            log(<span class="string">"Cipher:12:"</span> + System.currentTimeMillis());</div><div class="line">            db.close();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            ...</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readData</span><span class="params">(<span class="keyword">boolean</span> isCipher)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isCipher) &#123;</div><div class="line">            SQLiteDatabase db = mOpenHelper.getReadableDatabase(PASSWORD_KEY);</div><div class="line">            Cursor cursor = db.query(DatabaseOpenHelper.TABLE, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">            <span class="keyword">while</span> (cursor.moveToNext()) &#123;</div><div class="line">                String name = cursor.getString(cursor.getColumnIndex(DatabaseOpenHelper.NAME));</div><div class="line">                <span class="keyword">int</span> age = cursor.getInt(cursor.getColumnIndex(DatabaseOpenHelper.AGE));</div><div class="line">                String token = cursor.getString(cursor.getColumnIndex(DatabaseOpenHelper.TOKEN));</div><div class="line">                String result = String.format(<span class="string">"Cipher&gt;&gt;&gt;&gt; name:%s, age:%d, token:%s"</span>, name, age, token);</div><div class="line">                log(result);</div><div class="line">            &#125;</div><div class="line">            db.close();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            android.database.sqlite.SQLiteDatabase ndb = mNormalHelper.getReadableDatabase();</div><div class="line">            android.database.Cursor cursor = ndb.query(NormalDatabaseOpenHelper.TABLE, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">            <span class="keyword">while</span> (cursor.moveToNext()) &#123;</div><div class="line">                String name = cursor.getString(cursor.getColumnIndex(DatabaseOpenHelper.NAME));</div><div class="line">                <span class="keyword">int</span> age = cursor.getInt(cursor.getColumnIndex(DatabaseOpenHelper.AGE));</div><div class="line">                String token = cursor.getString(cursor.getColumnIndex(DatabaseOpenHelper.TOKEN));</div><div class="line">                String result = String.format(<span class="string">"Normal&gt;&gt;&gt;&gt; name:%s, age:%d, token:%s"</span>, name, age, token);</div><div class="line">                log(result);</div><div class="line">            &#125;</div><div class="line">            ndb.close();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œè·‘ä¸€ä¸‹æˆ‘ä»¬çš„æµ‹è¯•ä»£ç ï¼Œå¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">02-19 13:49:41.596 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: &gt;&gt;&gt;&gt;&gt; Cipher &gt;&gt;&gt;&gt;&gt;</div><div class="line">02-19 13:49:41.596 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: Cipher:101:1455860981597</div><div class="line">02-19 13:49:41.971 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: Cipher:102:1455860981974</div><div class="line">02-19 13:49:41.971 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: Cipher:11:1455860981974</div><div class="line">02-19 13:49:41.981 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: Cipher:12:1455860981983</div><div class="line">02-19 13:49:42.201 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: Cipher&gt;&gt;&gt;&gt; name:Cipher1, age:1, token:123abc_!@#$%^&amp;*</div><div class="line">02-19 13:49:42.201 24884-24884/com.ttdevs.demo I/Choreographer: Skipped 35 frames!  The application may be doing too much work on its main thread.</div><div class="line">02-19 13:49:49.471 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: &gt;&gt;&gt;&gt;&gt; Noremal &gt;&gt;&gt;&gt;&gt;</div><div class="line">02-19 13:49:49.476 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: Normal:101:1455860989477</div><div class="line">02-19 13:49:49.521 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: Normal:102:1455860989525</div><div class="line">02-19 13:49:49.521 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: Normal:11:1455860989525</div><div class="line">02-19 13:49:49.531 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: Normal:12:1455860989535</div><div class="line">02-19 13:49:49.541 24884-24884/com.ttdevs.demo E/&gt;&gt;&gt;&gt;&gt;: Normal&gt;&gt;&gt;&gt; name:Normal2, age:2, token:123abc_!@#$%^&amp;*</div></pre></td></tr></table></figure>
<p>é€šè¿‡ç®€å•çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬å‘ç°ï¼ŒSQLCipheråœ¨æ‰“å¼€å†™æ•°æ®åº“çš„æ—¶å€™èŠ±è´¹äº†375msï¼Œæ—¶é—´å¤§æ¦‚æ˜¯SQLite 45msçš„8~9å€ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨logä¸­çœ‹åˆ°ä¸¢å¸§çš„æç¤ºã€‚è¿™å°±æç¤ºæˆ‘ä»¬ï¼Œç®€å•çš„æ•°æ®åº“æ“ä½œï¼Œä½¿ç”¨SQLiteæˆ‘ä»¬ä¹Ÿå¯èƒ½éœ€è¦è€ƒè™‘å°†å…¶æ”¾åœ¨æ–°çš„çº¿ç¨‹ä¸­ã€‚å½“ç„¶ï¼Œè¿™ä¸ªæµ‹è¯•å¯¹æ¯”ä¸å¤Ÿå®Œå–„ï¼Œæ¯”å¦‚å¤§æ–‡ä»¶å†™å…¥ï¼Œå¤§é‡æ•°æ®æ’å…¥ï¼Œäº‹åŠ¡ç­‰ç­‰ï¼Œå› æ­¤è¿˜éœ€è¦æ›´å¤šã€æ›´è¯¦ç»†çš„æµ‹è¯•æ¥æ£€æµ‹SQLCipherçš„æ€§èƒ½ç­‰ï¼Œè¿™é‡Œå°±æš‚ä¸è®¨è®ºäº†ã€‚</p>
<p>è·‘å®Œä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬æœ¬åœ°æ•°æ®åº“ä¸­éƒ½åˆ›å»ºäº†å“ªäº›ä¸œè¥¿ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">root@t03g:/data/data/com.ttdevs.demo/databases # ls</div><div class="line">normal_user.db</div><div class="line">normal_user.db-journal</div><div class="line">user.db</div><div class="line">root@t03g:/data/data/com.ttdevs.demo/databases #</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªdbæ–‡ä»¶æ‹·è´åˆ°æˆ‘ä»¬çš„ç”µè„‘ï¼Œçœ‹çœ‹é‡Œé¢æœ‰å“ªäº›ä¸œè¥¿ã€‚è¿™é‡Œæ¨èä¸€ä¸ªå·¥å…·ï¼š<a href="http://sqlitebrowser.org/" target="_blank" rel="external">sqlitebrowser</a>ã€‚æ‰“å¼€ä»–ä»¬çš„ç½‘ç«™ä½ ä¼šå‘ç°å®ƒæœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„ï¼šStandardå’ŒSQLCipherçš„ã€‚æ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™ï¼Œå°±æ˜¯é’ˆå¯¹SQLCipherçš„ã€‚å¦‚æœä½ ä½¿ç”¨Standardç‰ˆæœ¬ï¼Œä½ ä¼šå‘ç°æ— æ³•æ‰“å¼€æˆ‘ä»¬åŠ å¯†åçš„user.dbï¼ˆå½“ç„¶ä½ ä¹Ÿå¯æ˜¯è¯•è¯•å…¶ä»–æ–¹æ³•ï¼‰ã€‚ä½¿ç”¨SQLCipherç‰ˆçš„ï¼Œæ‰“å¼€ä¹‹å‰ä¼šè¦æ±‚è¾“å…¥æˆ‘ä»¬åŠ å¯†çš„KEYï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢çš„<code>123abc_!@#$%^&amp;*</code>ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°åŸå§‹çš„æ•°æ®äº†ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://img.blog.csdn.net/20160219151008300" alt="Browser SQLCipher Data"></p>
<h2 id="0x03"><a href="/1970/01/01/[Android]0x01æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•SQLCipher/#0x03" class="headerlink" title="0x03"></a>0x03</h2><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå·²ç»è§åˆ°äº†SQLCipherçš„ä½¿ç”¨ã€‚è¿˜æ²¡æœ‰ç»“æŸï¼Œå†æ¥çœ‹ä¸€ä¸ªé—®é¢˜ï¼šåœ¨åˆ›å»ºé¡¹ç›®å¼€å§‹ï¼Œæˆ‘å°è¯•è·‘äº†ä¸‹é¡¹ç›®ï¼Œapkçš„å¤§å°æ˜¯1.4MBï¼Œåœ¨Gradleä¸­å¼•å…¥SQLCipherä¹‹åï¼Œä½“ç§¯ä¸€ä¸‹å­é£™åˆ°äº†8.7MBã€‚å‘µå‘µå‘µ~~ è¿™ä¸ªä½“ç§¯çš„å¢åŠ è¿˜æ˜¯å€¼å¾—æˆ‘ä»¬æ…é‡çš„æ€è€ƒä¸€ä¸‹ä¸‹çš„ã€‚</p>
<h2 id="0x04"><a href="/1970/01/01/[Android]0x01æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•SQLCipher/#0x04" class="headerlink" title="0x04"></a>0x04</h2><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™æ ·ä¸€ä¸ªç»“è®ºï¼Œä½¿ç”¨SQLiteCipherå¯ä»¥å¯¹æˆ‘ä»¬å®¢æˆ·ç«¯çš„æœ¬åœ°æ•°æ®åº“è¿›è¡ŒåŠ å¯†ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è‡ªå·±å­˜ä¸€ä¸ªåŠ å¯†KEYï¼Œå¦‚æœæˆ‘ä»¬èƒ½ä¿å­˜å¥½è¿™ä¸ªKEYï¼Œé‚£æˆ‘ä»¬çš„æ•°æ®åŸºæœ¬æ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯åŒæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è€ƒè™‘æ•°æ®åº“åŠ å¯†è¿‡ç¨‹ä¸­å¼•å…¥çš„æ–°çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šapkä½“ç§¯çš„æš´å¢ï¼ŒåŠ å¯†å¯¹æ€§èƒ½çš„å½±å“ï¼ŒåŠ å¯†KEYçš„ä¿å­˜ç­‰ç­‰ã€‚è¿™äº›é—®é¢˜è€ƒè™‘å¥½ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å†³å®šæ˜¯å¦å¼•å…¥SQLCipherã€‚</p>
<p>å¦‚æœä½ å¯¹å¼•å…¥SQLiteCiperå¼•èµ·çš„æ–°é—®é¢˜å¿ƒå­˜èŠ¥è’‚ï¼Œé‚£æ¥ä¸‹æ¥ç»™å¤§å®¶æ¨èä¸‹ä¸€ç§æ–¹æ³•ã€‚æ•¬è¯·æœŸå¾…ï¼š<a href="http://blog.csdn.net/ttdevs/" target="_blank" rel="external">Androidæœ¬åœ°æ•°æ®å®‰å…¨å°è¯•(ä¸­)</a></p>
<p>PSï¼š<a href="https://github.com/ttdevs/Demo" target="_blank" rel="external">Github Demo</a></p>
<hr>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android]0x01æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•SQLCipher/#0x00&quot; class=&quot;headerlink&quot; title=&quot;0x00&quot;&gt;&lt;/a&gt;0x00&lt;/h2&gt;&lt;p&gt;å…ˆçºªå¿µä¸‹ï¼Œä»ä»Šå¤©å¼€å§‹ï¼Œåˆå¼€å§‹å†™åšå®¢å•¦å•¦
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5D0x02%E6%9C%AC%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E5%B0%9D%E8%AF%95Conceal/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00"><a href="/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/#0x00" class="headerlink" title="0x00"></a>0x00</h2><p>ä¸Šä¸€ç¯‡æˆ‘ä»¬æåˆ°ä½¿ç”¨SQLCipherå¯¹æœ¬åœ°çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚åœ¨ä¿è¯æ•°æ®å®‰å…¨çš„åŒæ—¶ï¼Œæˆ‘ä»¬åˆå¼•å…¥äº†ä¸€äº›æ–°çš„é—®é¢˜ï¼Œæ¯”å¦‚å®‰è£…åŒ…ä½“ç§¯çš„å¢åŠ ï¼Œæ•°æ®å­˜å‚¨è¿‡ç¨‹ä¸­è€—æ—¶å¢åŠ ï¼Œæ•°æ®åŠ å¯†çš„ç²’åº¦ä¸å¯æ§ç­‰ç­‰ã€‚å¦‚æœä½ æ¥å—ä¸äº†è¿™äº›é—®é¢˜ï¼Œé‚£æˆ‘ä»¬è¿˜éœ€å¯»æ‰¾å…¶ä»–çš„åŠ å¯†æ–¹æ³•ã€‚è¿™é‡Œç»™å¤§å®¶æ¨è<a href="https://github.com/facebook/conceal" target="_blank" rel="external">Conceal</a></p>
<h2 id="0x01"><a href="/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/#0x01" class="headerlink" title="0x01"></a>0x01</h2><p><a href="https://github.com/facebook/conceal" target="_blank" rel="external">Conceal</a>æ˜¯Facebookçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒå¯ä»¥é«˜æ•ˆçš„å¯¹å¤§æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼ˆå½“ç„¶å¯¹å°æ•°æ®åŠ å¯†ä¹Ÿä¸æ˜¯é—®é¢˜ï¼‰ï¼ŒåŒæ—¶å¯¹è®¾å¤‡çš„æ€§èƒ½å’Œç³»ç»Ÿç‰ˆæœ¬è¦æ±‚æ¯”è¾ƒä½ã€‚æ›´å…·ä½“çš„ä¿¡æ¯å¯å‚è€ƒ<a href="https://facebook.github.io/conceal/" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
<blockquote>
<p>Conceal doesnâ€™t implement any crypto, but instead, it uses specific cryptographics algorithms from OpenSSL. Conceal attempts to manage memory efficiently between the native and Java heap. Conceal also uses fast modes like AES-GCM and HMAC-SHA1 by default.<br>OpenSSL is a very large library, and would increase the size of apps. Conceal ships with only a select number of encryption algorithms from OpenSSL which make it much smaller (85KB). </p>
</blockquote>
<h2 id="0x02"><a href="/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/#0x02" class="headerlink" title="0x02"></a>0x02</h2><h3 id="å¼•ç”¨"><a href="/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><p><code>compile &#39;com.facebook.conceal:conceal:1.0.1@aar&#39;</code></p>
<h3 id="å…³é”®ä»£ç "><a href="/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/#å…³é”®ä»£ç " class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><p>æˆ‘ä»¬å¯ä»¥ç”¨å…¶åŠ å¯†å¸¸è§çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ï¼Œå›¾ç‰‡ç­‰ã€‚</p>
<ul>
<li>å­—ç¬¦ä¸²</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åŠ å¯†</span></div><div class="line"><span class="keyword">byte</span>[] cipherText = mCrypto.encrypt(plainText, mEntity);</div><div class="line"><span class="comment">// è§£å¯†</span></div><div class="line"><span class="keyword">byte</span>[] plainText = mCrypto.decrypt(cipherText, mEntity);</div></pre></td></tr></table></figure>
<ul>
<li>å¤§æ–‡ä»¶</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">OutputStream out = mCrypto.getCipherOutputStream(fileOS, mEntity);</div><div class="line"><span class="keyword">int</span> read = <span class="number">0</span>;</div><div class="line"><span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line"><span class="keyword">while</span> ((read = sourceFile.read(buffer)) != -<span class="number">1</span>) &#123;</div><div class="line">    out.write(buffer, <span class="number">0</span>, read);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åˆå§‹åŒ–</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ENTITY = <span class="string">"ttdevs"</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == mCrypto) &#123;</div><div class="line">        mCrypto = <span class="keyword">new</span> Crypto(<span class="keyword">new</span> SharedPrefsBackedKeyChain(context), <span class="keyword">new</span> SystemNativeCryptoLibrary());</div><div class="line">        mEntity = <span class="keyword">new</span> Entity(ENTITY);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä¸‰éƒ¨åˆ†æ˜¯æˆ‘ä»¬ä½¿ç”¨Concealçš„å…³é”®ä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªCryptoå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯KeyChainï¼Œç¬¬äºŒä¸ªæ˜¯NativeCryptoLibraryã€‚NativeCryptoLibraryæˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„ã€‚KeyChainé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æˆ‘ä»¬çš„åŠ å¯†keyã€‚ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨äº†SharedPrefsBackedKeyChainï¼Œé€šè¿‡æŸ¥çœ‹æºç ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå®ƒæ˜¯å°†åŠ å¯†çš„keyä¿å­˜åˆ°SharedPreferencesä¸­çš„ä¸€ä¸ªKeyChainçš„å®ç°ã€‚</p>
<h3 id="æµ‹è¯•"><a href="/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹Concealçš„è¡¨ç°å¦‚ä½•ã€‚æˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„æµ‹è¯•ä»£ç ï¼Œç”±äºæ¯”è¾ƒé•¿ï¼Œå°±ä¸è´´äº†ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://github.com/ttdevs/Demo" target="_blank" rel="external">è¿™é‡Œ</a>ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>æµ‹è¯•å­—ç¬¦ä¸²åŠ è§£å¯†</li>
<li>æµ‹è¯•åŠ å¯†æ•°æ®çš„æ•°æ®åº“è¯»å†™</li>
<li>æµ‹è¯•æœ¬åœ°æ–‡ä»¶åŠ è§£å¯†</li>
</ul>
<p>ç•Œé¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ttdevs/Demo/master/app/image-conceal-string.png" alt="æµ‹è¯•ç•Œé¢"></p>
<ul>
<li>å­—ç¬¦ä¸²åŠ è§£å¯†</li>
</ul>
<p>å­—ç¬¦ä¸²çš„è¯»å†™å¦‚ä¸Šå›¾ï¼ŒåŠ è§£å¯†å­—ç¬¦ä¸²<code>Hello world!</code>è€—æ—¶éƒ½åœ¨3mså·¦å³ï¼Œè¿™ä¸ªæ—¶é—´åº”è¯¥æ˜¯æˆ‘ä»¬å¯ä»¥æ¥å—çš„ã€‚</p>
<p><code>PS:å¼ºåŠ¿æ’å…¥ä¸€ä¸ª2Bé—®é¢˜</code></p>
<blockquote>
<p>ç»†å¿ƒçš„ä½ å¯èƒ½ä¼šæƒ³å¦‚æœæˆ‘ä»¬ä¸ç”¨æ•°æ®åº“ï¼Œåªæ˜¯åŠ å¯†å‡ ä¸ªç®€å•çš„æ•°æ®ï¼Œèƒ½ä¸èƒ½å°†å¯†æ–‡ç›´æ¥å†™å…¥SharedPreferencesä¸­å‘¢ï¼Ÿå‘Šè¯‰ä½ æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œè€Œä¸”å»æµ‹è¯•äº†ï¼Œä½†æ˜¯æ­»æ´»ä¸æˆåŠŸï¼Œä¸æˆåŠŸï¼Œä¸æˆåŠŸâ€¦â€¦<br>æˆ‘çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼šç”±äºåŠ å¯†ã€åŠ å¯†ç»“æœã€è§£å¯† ä¸‰ä¸ªæ“ä½œå‚æ•°éƒ½æ˜¯byteï¼Œè€ŒSharedPreferencesæ¥å—çš„å‚æ•°æ˜¯Stringç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¿›è¡Œè½¬æ¢ï¼Œ<code>new String(bytes, &quot;utf-8&quot;)</code> å’Œ <code>string.getBytes(&quot;utf-8&quot;)</code> ï¼Œ å½“ä½ è¿™ä¹ˆåšçš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°è§£å¯†æ­»æ´»ä¸æˆåŠŸã€‚ç»å†è¿‡æ— æ•°ä¸ªä¸çœ ä¹‹å¤œåï¼Œç»ˆäºæç„¶å¤§æ‚Ÿï¼ŒåŸæ¥è¿™ä¹ˆè½¬æ¢æ˜¯é”™è¯¯çš„ï¼åŸå› å¾ˆç®€å•ï¼Œä¸€ä¸ªutf-8ç¼–ç æ±‰å­—æ˜¯2bytesï¼Œå¦‚æœæˆ‘ä»¬çš„åŠ å¯†ç»“æœä¸è¶³2byteï¼Œæˆ‘ä»¬å¼ºè½¬æ—¶ä¸è¶³éƒ¨åˆ†å°±ä¼šè¢«è¡¥é½ï¼Œå½“å†è½¬æ¢å›æ¥çš„æ—¶å€™å°±å’ŒåŸæ¥çš„ä¸ä¸€ä¸€æ ·äº†ã€‚æœ€åæ€ä¹ˆè§£å†³å‘¢ï¼Ÿä¹Ÿå¾ˆç®€å•ï¼Œç”¨Base64å¯¹byteæ•°ç»„è¿›è¡Œç¼–ç ï¼Œå…·ä½“æ€ä¹ˆåšå¯ä»¥å‚è€ƒConcealæºç ä¸­çš„SharedPrefsBackedKeyChainã€‚</p>
</blockquote>
<ul>
<li>æ•°æ®åº“è¯»å†™</li>
</ul>
<p>è¿™ä¸ªæ—¶é—´å°±ä¸åšè¿‡å¤šè§£è¯»ï¼Œæ•°æ®åº“æ“ä½œæ—¶é—´åŠ åŠ è§£å¯†æ—¶é—´ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">1456500607857: Begin transaction </div><div class="line">1456500607861: Insert: Hello world! </div><div class="line">1456500607865: Read: name:Hello world! token:Hello world! </div><div class="line">1456500607868: Read: name:Hello world! token:Hello world! </div><div class="line">1456500607871: Read: name:Hello world! token:Hello world! </div><div class="line">1456500607885: End transaction</div></pre></td></tr></table></figure>
<ul>
<li>æ–‡ä»¶åŠ è§£å¯†</li>
</ul>
<p>è¿™ä¸ªæ¯”è¾ƒé‡è¦ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤§æ–‡ä»¶åŠ å¯†çš„éœ€æ±‚ï¼ˆæ¯”å¦‚å‰æ®µæ—¶é—´å¾®ä¿¡çš„çº¢åŒ…å›¾ç‰‡ï¼‰ï¼Œå¯¹æ€§èƒ½å’Œæ•ˆç‡è¦æ±‚å°±æ¯”è¾ƒé«˜äº†ã€‚</p>
<p>æŸä¸€æ¬¡åŠ å¯†æ•°æ®ï¼š</p>
<p><img src="https://raw.githubusercontent.com/ttdevs/Demo/master/app/image-conceal-file.png" alt="æµ‹è¯•ç•Œé¢"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Encrpyt 1.png 1014KB 163ms</div><div class="line">Encrpyt 2.jpg 2078KB 336ms</div><div class="line">Encrpyt 3.jpg 3043KB 477ms</div><div class="line">Encrpyt 4.JPG 3811KB 560ms</div><div class="line">Encrpyt 5.JPG 4772KB 699ms</div><div class="line">Encrpyt 10.apk 10268KB 1281ms</div><div class="line">Encrpyt 10.gif 10421KB 671ms</div><div class="line">Encrpyt 21.apk 20962KB 1323ms</div></pre></td></tr></table></figure>
<p>æŸä¸€æ¬¡è§£å¯†æ•°æ®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Decrpyt encrypt_1.png 1014KB 108ms</div><div class="line">Decrpyt encrypt_2.jpg 2078KB 177ms</div><div class="line">Decrpyt encrypt_3.jpg 3043KB 221ms</div><div class="line">Decrpyt encrypt_4.JPG 3811KB 270ms</div><div class="line">Decrpyt encrypt_5.JPG 4772KB 340ms</div><div class="line">Decrpyt encrypt_10.apk 10268KB 732ms</div><div class="line">Decrpyt encrypt_10.gif 10421KB 764ms</div><div class="line">Decrpyt encrypt_21.apk 20962KB 1468ms</div></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„æ•°æ®æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŠ å¯†å¤šå¼ å¤§å›¾å¹¶æ²¡æœ‰å¯¼è‡´å†…å­˜çš„å¢åŠ ï¼Œåªæ˜¯CPUä½¿ç”¨ç‡æœ‰æ‰€å˜åŒ–ã€‚åŠ å¯†1MBå›¾ç‰‡è€—æ—¶160msï¼ŒåŠ å¯†20MBæ–‡ä»¶è€—æ—¶1300mså¤šã€‚è§£å¯†æ•°æ®çš„æ€§èƒ½æ¶ˆè€—ç±»ä¼¼ã€‚</p>
<h2 id="0x03"><a href="/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/#0x03" class="headerlink" title="0x03"></a>0x03</h2><h3 id="åˆ†æ"><a href="/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>äº†è§£äº†Concealçš„åŸºæœ¬æƒ…å†µï¼Œæˆ‘ä»¬æ¥å¯¹æ¯”ä¸‹ä¸Šé¢æåˆ°çš„ä½¿ç”¨SQLCipheré‡åˆ°çš„é—®é¢˜ã€‚é¦–å…ˆï¼ŒConcealåªæœ‰85KBï¼Œè¿™ä¸ªå¤§å°æ˜¯æˆ‘ä»¬å®Œå…¨å¯ä»¥æ¥å—çš„ï¼Œç„¶åå°±æ˜¯åŠ å¯†ç²’åº¦ï¼Œæ— è®ºæ˜¯æ•°æ®åº“è¿˜æ˜¯æ–‡ä»¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åªçœŸå¯¹éœ€è¦çš„é‚£éƒ¨åˆ†åŠ å¯†ï¼Œæœ€åå³ä½¿ä½ é€‰æ‹©å°†æ–‡ä»¶å­˜å…¥æ•°æ®åº“ï¼Œå®ƒçš„æ—¶é—´ä¹Ÿåªæœ‰æ­£å¸¸æ•°æ®åº“æ“ä½œæ—¶é—´åŠ Concealçš„åŠ è§£å¯†æ—¶é—´ã€‚ç»¼ä¸Šæ‰€è¿°ï¼ŒConcealåº”è¯¥æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<h3 id="æ€»ç»“"><a href="/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æˆ‘ä»¬å†æ¥æƒ³æƒ³è¿™ä¸¤ç¯‡æ–‡ç« ä¸­æåˆ°çš„åŠ å¯†æ–¹æ³•ï¼šæ— è®ºä½ é€‰æ‹©å“ªä¸€ç§ï¼Œç”±äºä»–ä»¬éƒ½é‡‡ç”¨äº†å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œè™½ç„¶æ•°æ®éƒ¨åˆ†åŠ å¯†äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å´éœ€è¦ç»´æŠ¤ä¸€ä¸ªç§˜é’¥ï¼Œè¿™ä¸ªç§˜é’¥æ”¾åœ¨é‚£é‡Œï¼ŸSharedPreferencesï¼Ÿæ•°æ®åº“ï¼Ÿæœ¬åœ°æ–‡ä»¶ï¼Ÿè²Œä¼¼è¿›å…¥äº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œé—®é¢˜åˆå›åˆ°äº†èµ·ç‚¹ã€‚åˆ†æäº†è¿™ä¹ˆå¤šï¼Œå¦‚æœæ²¡æœ‰åŠæ³•è§£å†³ç§˜é’¥çš„é—®é¢˜ï¼Œä¹Ÿéƒ½æ˜¯ç™½æ­ã€‚æ€ä¹ˆåŠï¼Ÿä¸‹ä¸€ç¯‡åœ¨è¿›ä¸€æ­¥åˆ†æã€‚æ•¬è¯·æœŸå¾…ã€‚</p>
<p><code>PS: æ‰€æœ‰æµ‹è¯•æœºå™¨ é­…æ— MX4PRO æ€§èƒ½å‡è¡¡æ¨¡å¼</code></p>
<hr>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android]0x02æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•Conceal/#0x00&quot; class=&quot;headerlink&quot; title=&quot;0x00&quot;&gt;&lt;/a&gt;0x00&lt;/h2&gt;&lt;p&gt;ä¸Šä¸€ç¯‡æˆ‘ä»¬æåˆ°ä½¿ç”¨SQLCipherå¯¹æœ¬åœ°
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€0x03æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•JNI</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5D0x03%E6%9C%AC%E5%9C%B0%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E5%B0%9D%E8%AF%95JNI/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]0x03æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•JNI/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‰ä¸¤ç¯‡ï¼Œæˆ‘ä»¬è°ˆåˆ°äº†ä½¿ç”¨SQLCipherå’ŒConcealå¯¹æœ¬åœ°æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚ç”±äºéƒ½ä¸¤ç§æ–¹æ³•éƒ½é‡‡ç”¨äº†å¯¹ç§°åŠ å¯†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå·±ç®¡ç†åŠ å¯†çš„ç§˜é’¥ã€‚è¿™æ—¶ä½ ä¼šå‘ç°ï¼Œè™½ç„¶å¯¹æˆ‘ä»¬çš„æ•°æ®è¿›è¡Œäº†åŠ å¯†ï¼Œä½†æ˜¯æˆ‘ä»¬å´å¼•å…¥äº†æ–°çš„é—®é¢˜ã€‚æˆ‘ä»¬çš„åŠ å¯†æ–¹æ³•å¾ˆå®¹æ˜“é€šè¿‡åç¼–è¯‘apkè·å–åˆ°ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦å®‰å…¨çš„ç»´æŠ¤è¿™ä¸ªç§˜é’¥äº†ã€‚ä½†é—æ†¾çš„æ˜¯ï¼Œæœ¬åœ°æ•°æ®å­˜å‚¨æ–¹å¼æˆ‘ä»¬éƒ½å·²ç»è®²è¿°ï¼Œå¹¶æ²¡æœ‰ä¸€ç§ä¸€åŠ³æ°¸é€¸çš„å®‰å…¨ä¿å­˜æ–¹æ³•ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬çš„ç§˜é’¥å­˜åœ¨å“ªé‡Œåˆé€‚å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™ä½ å¯èƒ½ä¼šæƒ³åˆ°æœ¬åœ°ä¸è¡Œé‚£æˆ‘ä»¬å­˜åˆ°æœåŠ¡å™¨ä¸Šå§ï¼Œé€šè¿‡httpsè¿›è¡Œä¼ è¾“ã€‚è¿™æ ·å½“ç„¶å¯ä»¥ï¼Œé€šè¿‡ä¸€å®šçš„ç®—æ³•ä¸ºæ¯ä¸ªäººé…ç½®ä¸€ä¸ªç§˜é’¥ï¼Œéœ€è¦çš„æ—¶å€™è¯·æ±‚ç½‘ç»œè·å–ï¼Œç„¶åå¯¹æœ¬åœ°æ•°æ®è¿›è¡Œè§£å¯†ã€‚ä½†æ˜¯è¿™æ ·ä¹Ÿå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šæœ¬åœ°ä¿å­˜çš„æ•°æ®å¦‚æœä¸è”ç½‘å°±æ— æ³•æ‰“å¼€ã€‚é‚£ä¹ˆï¼Œè¿˜æœ‰æ›´å¥½çš„æ–¹æ¡ˆå—ï¼Ÿä»Šå¤©ç»™å¤§å®¶ä»‹ç»JNIã€‚</p>
<h2 id="0x01"><a href="/1970/01/01/[Android]0x03æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•JNI/#0x01" class="headerlink" title="0x01"></a>0x01</h2><p>NDKï¼ŒJNIå¯¹äºåˆšæ¥è§¦androidå¼€å‘çš„æ”»åŸç‹®æ¥è¯´æ˜¯æœ‰è¾ƒå¤§çš„é—¨æ§›çš„ï¼Œä½†æ˜¯ä¸ºäº†å®ç°æˆ‘ä»¬æ›´å®‰å…¨çš„ä¿å­˜æ•°æ®ï¼Œä»–å¯èƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚åç¼–è¯‘è¿‡åˆ«äººå®¶appçš„ä½ å¯èƒ½éƒ½é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µï¼šä¸€ä¸ªä¸ªæ²¡æ— æ³•æŸ¥çœ‹ä»£ç é€»è¾‘çš„soæ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨javaä»£ç è°ƒç”¨ï¼Œå®ç°ä¸€äº›æˆ‘ä»¬ä¸çŸ¥é“å†…éƒ¨é€»è¾‘ä½†æ˜¯ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªç»“æœåŠŸèƒ½ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æŠŠå¯†ç æ”¾åˆ°è¿™äº›soä¸­å°±å¯ä»¥æ›´è¿›ä¸€æ­¥æé«˜æˆ‘ä»¬æœ¬åœ°æ•°æ®çš„å®‰å…¨çº§åˆ«ã€‚</p>
<p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªåŠ å•çš„demoæ¥çœ‹çœ‹JNIçš„å®ç°ã€‚</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªå·¥å…·ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CipherUtil</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        System.loadLibrary(<span class="string">"Cipher"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">getCipherKey</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªç±»æ–‡ä»¶ä¸Šç‚¹å‡»å³é”®ï¼Œä½¿ç”¨æˆ‘ä»¬ä¹‹å‰é…ç½®çš„javahå·¥å…·ç”Ÿæˆå¤´æ–‡ä»¶ã€‚ä¹‹åæˆ‘ä»¬ä¼šåœ¨å’Œjavaç›®å½•åŒçº§çš„jniæ–‡ä»¶ä¸‹çœ‹åˆ°ä¸€ä¸ª.hæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="comment">/* Header for class com_ttdevs_ndk_CipherUtil */</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _Included_com_ttdevs_ndk_CipherUtil</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _Included_com_ttdevs_ndk_CipherUtil</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Class:     com_ttdevs_ndk_CipherUtil</div><div class="line"> * Method:    getCipherKey</div><div class="line"> * Signature: ()Ljava/lang/String;</div><div class="line"> */</div><div class="line"><span class="function">JNIEXPORT jstring JNICALL <span class="title">Java_com_ttdevs_ndk_CipherUtil_getCipherKey</span></span></div><div class="line">  <span class="params">(JNIEnv *, jclass)</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨hæ–‡ä»¶çš„åŒçº§æ–°å»ºä¸€ä¸ªC++æ–‡ä»¶ï¼ˆå³é”®&gt;New&gt;C/C++ Source fileï¼‰,å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"QiniuConfig.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOG_TAG <span class="meta-string">"System.out"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGD(...) __android_log_print(ANDROID_LOG_DEBUG, LOG_TAG, __VA_ARGS__)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGI(...) __android_log_print(ANDROID_LOG_INFO, LOG_TAG, __VA_ARGS__)</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"com_ttdevs_ndk_CipherUtil.h"</span></span></div><div class="line"></div><div class="line"><span class="function">JNIEXPORT jstring JNICALL <span class="title">Java_com_ttdevs_ndk_CipherUtil_getCipherKey</span><span class="params">(JNIEnv *env, jclass)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> (*env).NewStringUTF(<span class="string">"Hello World! getCipherKey"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªå«Android.mkï¼Œå¦ä¸€ä¸ªå«Application.mkï¼Œä»–ä»¬éƒ½åœ¨jniç›®å½•ä¸‹ã€‚</p>
<ul>
<li>Android.mk:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># http://developer.android.com/intl/zh-tw/ndk/guides/android_mk.html</div><div class="line"></div><div class="line">LOCAL_PATH := $(call my-dir)</div><div class="line"></div><div class="line">include $(CLEAR_VARS)</div><div class="line"></div><div class="line">LOCAL_MODULE := Cipher</div><div class="line">LOCAL_SRC_FILES := Cipher.cpp</div><div class="line">LOCAL_LDLIBS += -llog</div><div class="line"></div><div class="line">include $(BUILD_SHARED_LIBRARY)</div></pre></td></tr></table></figure>
<ul>
<li>Application.mk</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># http://developer.android.com/intl/zh-tw/ndk/guides/application_mk.html</div><div class="line"></div><div class="line"># APP_STL := stlport_static</div><div class="line">APP_STL := gnustl_static</div><div class="line">APP_CPPFLAGS := -frtti -std=c++11</div><div class="line">APP_CFLAGS += -Wno-error=format-security</div><div class="line"></div><div class="line">APP_ABI := all</div></pre></td></tr></table></figure>
<p>è¿˜æ²¡æœ‰å®Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹å½“å‰Projectæˆ–è€…Moduleçš„gradle.buildæ–‡ä»¶:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    compileSdkVersion 23</div><div class="line">    buildToolsVersion &quot;23.0.2&quot;</div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        minSdkVersion 16</div><div class="line">        targetSdkVersion 23</div><div class="line">        versionCode 1</div><div class="line">        versionName &quot;1.0&quot;</div><div class="line"></div><div class="line">        ndk &#123;</div><div class="line">            moduleName &quot;ndkutil&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    sourceSets.main &#123;</div><div class="line">        jni.srcDirs = []</div><div class="line">        jniLibs.srcDir &quot;libs&quot;</div><div class="line">    &#125;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å®Œæˆè¿™äº›ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œç¼–è¯‘äº†ã€‚åœ¨å½“å‰Projectï¼ˆModuleï¼‰ä¸Šç‚¹å‡»å³é”®ï¼Œä½¿ç”¨ä¹‹å‰é…ç½®çš„ndk-buildå·¥å…·è¿›è¡Œç¼–è¯‘ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šåœ¨libsç›®å½•ä¸‹çœ‹åˆ°ç”Ÿäº§çš„soæ–‡ä»¶ã€‚å¥½äº†ï¼Œæœ€åæˆ‘ä»¬å¯ä»¥ç¼–å†™æµ‹è¯•ä»£ç äº†ï¼šåœ¨javaç›´æ¥è°ƒç”¨åˆšæ‰åˆ›å»ºçš„CipherUtilå³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Log.d(<span class="string">"&gt;&gt;&gt;&gt;&gt;"</span>, CipherUtil.getCipherKey());</div></pre></td></tr></table></figure>
<p>è¿è¡Œä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨logä¸­çœ‹åˆ°è¾“å‡ºçš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hello World! getCipherKey</div></pre></td></tr></table></figure>
<h2 id="0x02"><a href="/1970/01/01/[Android]0x03æœ¬åœ°æ•°æ®å®‰å…¨å°è¯•JNI/#0x02" class="headerlink" title="0x02"></a>0x02</h2><p>ä¸Šè¿°demoä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•çš„è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¦å®ç°æ›´å®‰å…¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤æ–¹æ³•å†™çš„æ›´å¤æ‚ï¼Œæ¯”å¦‚è·å–appçš„ç­¾åï¼Œè·å–è®¾å¤‡çš„ç¡¬ä»¶ä¿¡æ¯è¿›è¡Œå¤æ‚çš„ç»„åˆï¼Œä»¥ä¿éšœæœ€ç»ˆç”Ÿæˆçš„ç§˜é’¥çš„å”¯ä¸€æ€§å’Œå®‰å…¨æ€§ï¼ˆæ›´éš¾ä¼ªé€ ï¼‰ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª<a href="https://github.com/MasonLiuChn/AndroidUltimateEncrypt" target="_blank" rel="external">demo</a>å¯ä»¥å‚è€ƒã€‚</p>
<p>å†™åˆ°è¿™é‡Œï¼Œå¯èƒ½åˆæœ‰äººä¼šé—®åˆ°ï¼šå…¶å®soæ–‡ä»¶ä¹Ÿä¸æ˜¯å¾ˆå…¨ï¼Œå¯ä»¥é€šè¿‡å¯¹æ±‡ç¼–çš„åˆ†æå¾—åˆ°é‡Œé¢çš„ä»£ç é€»è¾‘ã€‚å½“ç„¶ï¼Œé«˜æ‰‹æ˜¯å¯ä»¥åšåˆ°å¯¹soæ–‡ä»¶è¿›è¡Œåˆ†æçš„ï¼Œä½†æ˜¯soè¿˜æ˜¯å¯ä»¥é˜»éš”å¤§éƒ¨åˆ†çš„åç¼–è¯‘äººå‘˜ã€‚å¦‚æœæˆ‘ä»¬èƒ½æŠŠgetCipherKeyå®ç°çš„æ›´å¥½ï¼Œä¹Ÿä¼šå¢åŠ ç ´è§£çš„æˆæœ¬ã€‚å¦å¤–ï¼Œsoè¿˜æœ‰ä¸€ä¸ªè¢«ç›—ç”¨çš„é—®é¢˜ï¼Œå°±æ˜¯åˆ«äººç›´æ¥è°ƒç”¨æˆ‘ä»¬çš„soï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥é€šè¿‡ä¸€å®šçš„ä»£ç é€»è¾‘æ¥é¿å…ã€‚ä¹‹åä¼šç»§ç»­è®²è§£ã€‚</p>
<p>æœ€åå†è¯´ä¸€ç‚¹ï¼Œå¯¹äºç§˜é’¥ï¼Œæˆ‘ä»¬æœ€ç»ˆè¿˜ä¼šè¢«è½½å…¥æˆ‘ä»¬çš„å†…å­˜ï¼Œå¦‚æœç›´æ¥dumpæˆ‘ä»¬çš„å†…å­˜ï¼Œä¼šæ˜¯ä¸€ä¸ªäººä»€ä¹ˆæ ·çš„ç»“æœå‘¢ï¼Ÿ</p>
<hr>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰ä¸¤ç¯‡ï¼Œæˆ‘ä»¬è°ˆåˆ°äº†ä½¿ç”¨SQLCipherå’ŒConcealå¯¹æœ¬åœ°æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚ç”±äºéƒ½ä¸¤ç§æ–¹æ³•éƒ½é‡‡ç”¨äº†å¯¹ç§°åŠ å¯†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå·±ç®¡ç†åŠ å¯†çš„ç§˜é’¥ã€‚è¿™æ—¶ä½ ä¼šå‘ç°ï¼Œè™½ç„¶å¯¹æˆ‘ä»¬çš„æ•°æ®è¿›è¡Œäº†åŠ å¯†ï¼Œä½†æ˜¯æˆ‘ä»¬å´å¼•å…¥äº†æ–°çš„é—®é¢˜ã€‚æˆ‘ä»¬çš„åŠ å¯†æ–¹æ³•å¾ˆå®¹æ˜“é€šè¿‡åç¼–è¯‘apkè·å–åˆ°ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦å®‰å…¨çš„
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€Androidé—¹é’Ÿé‡åˆ°çš„é‚£äº›å‘</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5DAndroid%E9%97%B9%E9%92%9F%E9%81%87%E5%88%B0%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]Androidé—¹é’Ÿé‡åˆ°çš„é‚£äº›å‘/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-åšè¿‡é—¹é’Ÿçš„è¯ä½ æ‰ä¼šç†è§£çš„å‘"><a href="/1970/01/01/[Android]Androidé—¹é’Ÿé‡åˆ°çš„é‚£äº›å‘/#0x00-åšè¿‡é—¹é’Ÿçš„è¯ä½ æ‰ä¼šç†è§£çš„å‘" class="headerlink" title="0x00 åšè¿‡é—¹é’Ÿçš„è¯ä½ æ‰ä¼šç†è§£çš„å‘"></a>0x00 åšè¿‡é—¹é’Ÿçš„è¯ä½ æ‰ä¼šç†è§£çš„å‘</h2><p>ç¬¬ä¸€æ¬¡åšé—¹é’Ÿç¨‹åºæ˜¯åœ¨2012å¹´ï¼Œé‚£æ—¶å€™androidæœ€æ–°ç‰ˆæœ¬æ˜¯2.2ï¼Œ2.3å‘å¸ƒåœ¨å³ï¼Œåšäº†ä¸€ä¸ªæ•´ç‚¹æé†’çš„å°å·¥å…·ï¼Œè®°å¾—å¾ˆæ¸…æ¥šï¼Œä¸»è¦çš„é—®é¢˜æ˜¯é”å±ä¹‹åé—¹é’Ÿä¸èƒ½å‡†æ—¶è¢«å”¤é†’ï¼Œæ€»ä¼šæ™šé‚£ä¹ˆå‡ ç§’é’Ÿï¼Œåæ¥æ²¡åŠæ³•æŠŠé—¹é’Ÿæå‰è®¾ç½®å‡ ç§’é’Ÿã€‚ä¸è¿‡é‚£æ—¶å€™ç¯å¢ƒè¿˜å¥½ï¼Œæ²¡æœ‰é‡åˆ°æ”»å…‹ä¸äº†çš„é—®é¢˜ï¼Œé‡å¯ä¹Ÿå¯ä»¥å”¤èµ·é—¹é’Ÿçš„ã€‚</p>
<p>ä½†æ˜¯éšç€androidç‰ˆæœ¬çš„è¿›åŒ–ï¼Œå¼€å‘è€…èŠ‚æ“çš„ä¸¢å¤±ï¼Œé—®é¢˜å°±è¶Šæ¥è¶Šéš¾åšäº†ã€‚é—¹é’Ÿæ˜æ˜è®¾ç½®äº†å´ä¸èƒ½åˆ°æ¥ï¼›ä¸å†è®¾ç½®çš„æ—¶é—´åˆ°æ¥ï¼Œæ™šäº†å¥½ä¹…æ‰åˆ°ï¼›é‡å¯ä¹‹åé—¹é’Ÿå°±æ²¡äº†ç­‰ç­‰ã€‚å½“ç„¶ï¼Œè¿˜æœ‰å¥½å¤šå¥½å¤šï¼Œæ€»ä¹‹å¾ˆå¤šä¸œè¥¿ä¸æŒ‰ç…§è‡ªå·±æœŸå¾…çš„æ¥ã€‚</p>
<p>é¡¹ç›®ä¸Šçº¿ï¼Œè¸©è¿‡ä¹‹åæŒ‘ä¸€äº›åšæ€»ç»“ã€‚</p>
<p>ç”±äºæ—¶é—´å…³ç³»ï¼Œé¡¹ç›®æ¯”è¾ƒèµ¶ï¼Œæ‰€ä»¥æ²¡æœ‰å»è€ƒè™‘é—¹é’Ÿæ— æ³•åŠæ—¶è§¦å‘çš„é—®é¢˜ï¼Œå‡è®¾äº†ä¸€ä¸ªæœ€ç†æƒ³çš„ç¯å¢ƒã€‚ï¼ˆæ›´å¤šçš„ä¿¡æ¯å¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡ç« ï¼‰</p>
<h2 id="0x01-é—¹é’Ÿçš„åˆ›å»º"><a href="/1970/01/01/[Android]Androidé—¹é’Ÿé‡åˆ°çš„é‚£äº›å‘/#0x01-é—¹é’Ÿçš„åˆ›å»º" class="headerlink" title="0x01 é—¹é’Ÿçš„åˆ›å»º"></a>0x01 é—¹é’Ÿçš„åˆ›å»º</h2><p>è¿™é‡Œæ¶‰åŠåˆ°ä¸åŒç‰ˆæœ¬è®¾ç½®é—¹é’Ÿçš„æ–¹æ³•ï¼Œä¸‹é¢çš„å‚è€ƒæ–‡ç« ä¸­å·²ç»æåˆ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startAlarm</span><span class="params">(Calendar calendar, PendingIntent pendingIntent)</span> </span>&#123;</div><div class="line">   <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">       <span class="comment">// mManager.setWindow(AlarmManager.RTC_WAKEUP, calendar.getTimeInMillis(), 1000* 5, mFirstPIntent);</span></div><div class="line">       mManager.setExact(AlarmManager.RTC_WAKEUP, calendar.getTimeInMillis(), pendingIntent);</div><div class="line">       <span class="comment">// mManager.set(AlarmManager.RTC_WAKEUP, calendar.getTimeInMillis(), mSecondPIntent);</span></div><div class="line">   &#125; <span class="keyword">else</span> &#123;</div><div class="line">       mManager.set(AlarmManager.RTC_WAKEUP, calendar.getTimeInMillis(), pendingIntent);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="0x02-é—¹é’Ÿçš„å–æ¶ˆ"><a href="/1970/01/01/[Android]Androidé—¹é’Ÿé‡åˆ°çš„é‚£äº›å‘/#0x02-é—¹é’Ÿçš„å–æ¶ˆ" class="headerlink" title="0x02 é—¹é’Ÿçš„å–æ¶ˆ"></a>0x02 é—¹é’Ÿçš„å–æ¶ˆ</h2><p>æœ‰çš„æ—¶å€™å¯èƒ½éœ€è¦å»å–æ¶ˆä¸€ä¸ªé—¹é’Ÿã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å–æ¶ˆï¼š</p>
<ul>
<li><p>é€šè¿‡ <code>PendingIntent.cancel();</code> æ¥å–æ¶ˆ</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Cancel a currently active PendingIntent.  Only the original application</div><div class="line"> * owning a PendingIntent can cancel it.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        ActivityManagerNative.getDefault().cancelIntentSender(mTarget);</div><div class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>è¿™ç§æ–¹å¼åªæœ‰èƒ½æ‹¿åˆ° `PendingIntent` æ‰å¯ä»¥ã€‚
</code></pre><ul>
<li><p>é€šè¿‡ <code>AlarmManager.cancel(PendingIntent);</code> æ¥å–æ¶ˆ</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Remove any alarms with a matching &#123;<span class="doctag">@link</span> Intent&#125;.</div><div class="line"> * Any alarm, of any type, whose Intent matches this one (as defined by</div><div class="line"> * &#123;<span class="doctag">@link</span> Intent#filterEquals&#125;), will be canceled.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> operation IntentSender which matches a previously added</div><div class="line"> * IntentSender.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@see</span> #set</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">(PendingIntent operation)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        mService.remove(operation);</div><div class="line">    &#125; <span class="keyword">catch</span> (RemoteException ex) &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="0x03-é—¹é’Ÿçš„æŸ¥çœ‹"><a href="/1970/01/01/[Android]Androidé—¹é’Ÿé‡åˆ°çš„é‚£äº›å‘/#0x03-é—¹é’Ÿçš„æŸ¥çœ‹" class="headerlink" title="0x03 é—¹é’Ÿçš„æŸ¥çœ‹"></a>0x03 é—¹é’Ÿçš„æŸ¥çœ‹</h2><p>åˆä¸ªadbå‘½ä»¤å¯ä»¥ç”¨æ¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­å­˜åœ¨çš„é—¹é’Ÿï¼š</p>
<p><code>adb shell dumpsys alarm</code></p>
<p><img src="http://img.blog.csdn.net/20170224183136089?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHRkZXZz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>ä¸æ˜¯åœ¨æ‰€æœ‰çš„è®¾å¤‡ä¸Šéƒ½å¥½ä½¿ï¼Œæ¯”å¦‚åœ¨æˆ‘çš„é­…æ—è®¾å¤‡ä¸Šå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œè€Œåœ¨å¦ä¸€å° OPPO R7Cä¸Šå°±ä¸å¯ä»¥ã€‚</p>
<h2 id="0xFF-å‚è€ƒ"><a href="/1970/01/01/[Android]Androidé—¹é’Ÿé‡åˆ°çš„é‚£äº›å‘/#0xFF-å‚è€ƒ" class="headerlink" title="0xFF å‚è€ƒ"></a>0xFF å‚è€ƒ</h2><ul>
<li><a href="http://www.jianshu.com/p/1f919c6eeff6" target="_blank" rel="external">http://www.jianshu.com/p/1f919c6eeff6</a></li>
</ul>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-åšè¿‡é—¹é’Ÿçš„è¯ä½ æ‰ä¼šç†è§£çš„å‘&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android]Androidé—¹é’Ÿé‡åˆ°çš„é‚£äº›å‘/#0x00-åšè¿‡é—¹é’Ÿçš„è¯ä½ æ‰ä¼šç†è§£çš„å‘&quot; class=&quot;headerlink&quot; title=&quot;0x00 åšè¿‡é—¹é’Ÿçš„è¯ä½ æ‰ä¼šç†è§£çš„å‘&quot;
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€Android Studio 1.x NDKç¯å¢ƒæ­å»º</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5DAndroid%20Studio%201.x%20NDK%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸‹è½½NDK"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#ä¸‹è½½NDK" class="headerlink" title="ä¸‹è½½NDK"></a>ä¸‹è½½NDK</h2><h3 id="ä¸‹è½½"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><p><a href="http://developer.android.com/ndk/downloads/index.html" target="_blank" rel="external">NDK Download</a></p>
<p><a href="http://dl.google.com/android/ndk/android-ndk-r10e-linux-x86.bin" target="_blank" rel="external">mac: android-ndk-r10e-linux-x86.bin</a></p>
<h3 id="å®‰è£…"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">âœ  ndk ls</div><div class="line">android-ndk-r10e-darwin-x86_64.bin</div><div class="line">âœ  ndk chmod a+x android-ndk-r10e-darwin-x86_64.bin</div><div class="line">âœ  ndk ./android-ndk-r10e-darwin-x86_64.bin</div></pre></td></tr></table></figure>
<h2 id="é…ç½®ç¯å¢ƒ"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h2><h3 id="gradle-properties"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#gradle-properties" class="headerlink" title="gradle.properties"></a>gradle.properties</h3><p>åœ¨æœ«å°¾æ·»åŠ ä¸€è¡Œï¼š <code>android.useDeprecatedNdk=true</code></p>
<h3 id="æ·»åŠ buildå·¥å…·"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#æ·»åŠ buildå·¥å…·" class="headerlink" title="æ·»åŠ buildå·¥å…·"></a>æ·»åŠ buildå·¥å…·</h3><p>AS &gt; Preferences &gt; Tools &gt; External Tools</p>
<h4 id="add-javah"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#add-javah" class="headerlink" title="add javah"></a>add javah</h4><ul>
<li>Name: javah</li>
<li>Group: default(External Tools)</li>
<li>Description: generate C header</li>
<li>Options: select all</li>
<li>Show in: select all</li>
<li>Tools Settings:<ul>
<li>Program:  <code>$JDKPath$/bin/javah</code></li>
<li>Parameters:  <code>-v -d $ModuleFileDir$/src/main/jni -jni $FileClass$</code></li>
<li>Parameters:  <code>-bootclasspath $ModuleSdkPath$/platforms/android-23/android.jar -v -d $ModuleFileDir$/src/main/jni -jni $FileClass$</code> (if you need android object)</li>
<li>Working directory:  <code>$SourcepathEntry$</code></li>
</ul>
</li>
</ul>
<p>(PS: Right click on the class)</p>
<p><img src="https://raw.githubusercontent.com/ttdevs/Demo/master/ndkutil/image-javah.png" alt="é¡¹ç›®ç»“æ„"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">âœ  ~ javah</div><div class="line">ç”¨æ³•:</div><div class="line">  javah [options] &lt;classes&gt;</div><div class="line">å…¶ä¸­, [options] åŒ…æ‹¬:</div><div class="line">  -o &lt;file&gt;                è¾“å‡ºæ–‡ä»¶ (åªèƒ½ä½¿ç”¨ -d æˆ– -o ä¹‹ä¸€)</div><div class="line">  -d &lt;dir&gt;                 è¾“å‡ºç›®å½•</div><div class="line">  -v  -verbose             å¯ç”¨è¯¦ç»†è¾“å‡º</div><div class="line">  -h  --help  -?           è¾“å‡ºæ­¤æ¶ˆæ¯</div><div class="line">  -version                 è¾“å‡ºç‰ˆæœ¬ä¿¡æ¯</div><div class="line">  -jni                     ç”Ÿæˆ JNI æ ·å¼çš„æ ‡å¤´æ–‡ä»¶ (é»˜è®¤å€¼)</div><div class="line">  -force                   å§‹ç»ˆå†™å…¥è¾“å‡ºæ–‡ä»¶</div><div class="line">  -classpath &lt;path&gt;        ä»ä¸­åŠ è½½ç±»çš„è·¯å¾„</div><div class="line">  -bootclasspath &lt;path&gt;    ä»ä¸­åŠ è½½å¼•å¯¼ç±»çš„è·¯å¾„</div><div class="line">&lt;classes&gt; æ˜¯ä½¿ç”¨å…¶å…¨é™å®šåç§°æŒ‡å®šçš„</div><div class="line">(ä¾‹å¦‚, java.lang.Object)ã€‚</div></pre></td></tr></table></figure>
<h4 id="add-ndkBuild"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#add-ndkBuild" class="headerlink" title="add ndkBuild"></a>add ndkBuild</h4><ul>
<li>Name: ndkBuild</li>
<li>Group: default(External Tools)</li>
<li>Description: ndk build</li>
<li>Options: select all</li>
<li>Show in: select all</li>
<li>Tools Settings:<ul>
<li>Program:  <code>/Users/ttdevs/android/android-ndk-r10e/ndk-build</code></li>
<li>Parameters:  <code>NDK_LIBS_OUT=$ModuleFileDir$/libs</code></li>
<li>Working directory:  <code>$ModuleFileDir$/src/main</code></li>
</ul>
</li>
</ul>
<p>(PS: Right click on the module name)</p>
<p><img src="https://raw.githubusercontent.com/ttdevs/Demo/master/ndkutil/image-ndkbuild.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="ç¼–å†™ä»£ç "><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#ç¼–å†™ä»£ç " class="headerlink" title="ç¼–å†™ä»£ç "></a>ç¼–å†™ä»£ç </h2><h3 id="æ–°å»ºä¸€ä¸ªModuleï¼šndkutil"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#æ–°å»ºä¸€ä¸ªModuleï¼šndkutil" class="headerlink" title="æ–°å»ºä¸€ä¸ªModuleï¼šndkutil"></a>æ–°å»ºä¸€ä¸ªModuleï¼šndkutil</h3><h3 id="ä¿®æ”¹ndkutilçš„build-gradle"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#ä¿®æ”¹ndkutilçš„build-gradle" class="headerlink" title="ä¿®æ”¹ndkutilçš„build.gradle"></a>ä¿®æ”¹ndkutilçš„build.gradle</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ...</div><div class="line">    defaultConfig &#123;</div><div class="line">        ...</div><div class="line">        ndk &#123;</div><div class="line">            moduleName <span class="string">"ndkutil"</span></div><div class="line">//            abiFilters <span class="string">"armeabi-v7a"</span>, <span class="string">"x86"</span></div><div class="line">//            stl <span class="string">"gnustl_static"</span></div><div class="line">//            cFlags <span class="string">"-std=c++11 -Wall"</span></div><div class="line">//            ldLibs <span class="string">"log"</span>, <span class="string">"jnigraphics"</span>, <span class="string">"EGL"</span>, <span class="string">"GLESv3"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    sourceSets.main &#123;</div><div class="line">        jni.srcDirs = []</div><div class="line">        jniLibs.srcDir <span class="string">"libs"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºå·¥å…·ç±»CipherUtil"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#åˆ›å»ºå·¥å…·ç±»CipherUtil" class="headerlink" title="åˆ›å»ºå·¥å…·ç±»CipherUtil"></a>åˆ›å»ºå·¥å…·ç±»CipherUtil</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.ttdevs.ndk;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CipherUtil</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        System.loadLibrary(<span class="string">"Cipher"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">getCipherKey</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ç”Ÿæˆå¤´æ–‡ä»¶com-ttdevs-ndk-CipherUtil-h"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#ç”Ÿæˆå¤´æ–‡ä»¶com-ttdevs-ndk-CipherUtil-h" class="headerlink" title="ç”Ÿæˆå¤´æ–‡ä»¶com_ttdevs_ndk_CipherUtil.h"></a>ç”Ÿæˆå¤´æ–‡ä»¶com_ttdevs_ndk_CipherUtil.h</h3><p>åœ¨åˆšæ‰åˆ›å»ºçš„CipherUtil.javaä¸Šç‚¹å‡»å³é”® &gt; External Tools &gt; javah<br>æ­¤æ—¶ä¼šåœ¨mainç›®å½•ä¸‹ç”Ÿæˆ: jni/com_ttdevs_ndk_CipherUtil.h</p>
<h3 id="ç¼–å†™ä»£ç -1"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#ç¼–å†™ä»£ç -1" class="headerlink" title="ç¼–å†™ä»£ç "></a>ç¼–å†™ä»£ç </h3><p>éƒ½æ˜¯åœ¨ndkutil/src/main/jniç›®å½•ä¸‹</p>
<ul>
<li>åˆ›å»ºCæºç :Cipher.cpp</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"com_ttdevs_ndk_CipherUtil.h"</span></span></div><div class="line"></div><div class="line"><span class="function">JNIEXPORT jstring JNICALL <span class="title">Java_com_ttdevs_ndk_CipherUtil_getCipherKey</span><span class="params">(JNIEnv *env, jclass)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> (*env).NewStringUTF(<span class="string">"Hello World!"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åˆ›å»ºAndroid.mk</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">LOCAL_PATH := $(call my-dir)</div><div class="line"></div><div class="line">include $(CLEAR_VARS)</div><div class="line"></div><div class="line">LOCAL_MODULE := Cipher</div><div class="line">LOCAL_SRC_FILES := Cipher.cpp</div><div class="line"></div><div class="line">include $(BUILD_SHARED_LIBRARY)</div></pre></td></tr></table></figure>
<ul>
<li>åˆ›å»ºApplication.mk</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">APP_MODULE := Cipher</div><div class="line">APP_ABI := all</div></pre></td></tr></table></figure>
<h3 id="ç¼–è¯‘ç”Ÿæˆsoæ–‡ä»¶"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#ç¼–è¯‘ç”Ÿæˆsoæ–‡ä»¶" class="headerlink" title="ç¼–è¯‘ç”Ÿæˆsoæ–‡ä»¶"></a>ç¼–è¯‘ç”Ÿæˆsoæ–‡ä»¶</h3><p>åœ¨moduleï¼ˆndkutilï¼‰ä¸Šç‚¹å‡»å³é”® &gt; External Tools &gt; ndkBuild ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹logï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">/Users/ttdevs/android/android-ndk-r10d/ndk-build NDK_LIBS_OUT=/Users/ttdevs/android/workspace/Demo/ndkutil/libs</div><div class="line">[arm64-v8a] Compile++      : Cipher &lt;= Cipher.cpp</div><div class="line">[arm64-v8a] SharedLibrary  : libCipher.so</div><div class="line">[arm64-v8a] Install        : libCipher.so =&gt; /Users/ttdevs/android/workspace/Demo/ndkutil/libs/arm64-v8a/libCipher.so</div><div class="line">[x86_64] Compile++      : Cipher &lt;= Cipher.cpp</div><div class="line">[x86_64] SharedLibrary  : libCipher.so</div><div class="line">[x86_64] Install        : libCipher.so =&gt; /Users/ttdevs/android/workspace/Demo/ndkutil/libs/x86_64/libCipher.so</div><div class="line">[mips64] Compile++      : Cipher &lt;= Cipher.cpp</div><div class="line">[mips64] SharedLibrary  : libCipher.so</div><div class="line">[mips64] Install        : libCipher.so =&gt; /Users/ttdevs/android/workspace/Demo/ndkutil/libs/mips64/libCipher.so</div><div class="line">[armeabi-v7a] Compile++ thumb: Cipher &lt;= Cipher.cpp</div><div class="line">[armeabi-v7a] SharedLibrary  : libCipher.so</div><div class="line">[armeabi-v7a] Install        : libCipher.so =&gt; /Users/ttdevs/android/workspace/Demo/ndkutil/libs/armeabi-v7a/libCipher.so</div><div class="line">[armeabi] Compile++ thumb: Cipher &lt;= Cipher.cpp</div><div class="line">[armeabi] SharedLibrary  : libCipher.so</div><div class="line">[armeabi] Install        : libCipher.so =&gt; /Users/ttdevs/android/workspace/Demo/ndkutil/libs/armeabi/libCipher.so</div><div class="line">[x86] Compile++      : Cipher &lt;= Cipher.cpp</div><div class="line">[x86] SharedLibrary  : libCipher.so</div><div class="line">[x86] Install        : libCipher.so =&gt; /Users/ttdevs/android/workspace/Demo/ndkutil/libs/x86/libCipher.so</div><div class="line">[mips] Compile++      : Cipher &lt;= Cipher.cpp</div><div class="line">[mips] SharedLibrary  : libCipher.so</div><div class="line">[mips] Install        : libCipher.so =&gt; /Users/ttdevs/android/workspace/Demo/ndkutil/libs/mips/libCipher.so</div><div class="line"></div><div class="line">Process finished with exit code 0</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨ndkutil/libs/ç›®å½•ä¸‹ç”Ÿæˆçš„soæ–‡ä»¶ã€‚</p>
<h3 id="æµ‹è¯•ä»£ç "><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String cipher = CipherUtil.getCipherKey();</div></pre></td></tr></table></figure>
<h2 id="é¡¹ç›®ç»“æ„"><a href="/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><p><img src="https://raw.githubusercontent.com/ttdevs/Demo/master/ndkutil/image-dir.png" alt="é¡¹ç›®ç»“æ„"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸‹è½½NDK&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android]Android Studio 1.x NDKç¯å¢ƒæ­å»º/#ä¸‹è½½NDK&quot; class=&quot;headerlink&quot; title=&quot;ä¸‹è½½NDK&quot;&gt;&lt;/a&gt;ä¸‹è½½NDK&lt;/h2&gt;&lt;h3 id=&quot;ä¸‹è½½&quot;&gt;&lt;
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€DataBindingç»™Buttonè®¾ç½®èƒŒæ™¯æ— æ•ˆ</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5DDataBinding%E7%BB%99Button%E8%AE%BE%E7%BD%AE%E8%83%8C%E6%99%AF%E6%97%A0%E6%95%88/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]DataBindingç»™Buttonè®¾ç½®èƒŒæ™¯æ— æ•ˆ/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-é—®é¢˜"><a href="/1970/01/01/[Android]DataBindingç»™Buttonè®¾ç½®èƒŒæ™¯æ— æ•ˆ/#0x00-é—®é¢˜" class="headerlink" title="0x00 é—®é¢˜"></a>0x00 é—®é¢˜</h2><p>é€šè¿‡Data Bindingç»™Buttonè®¾ç½®èƒŒæ™¯æ— æ•ˆã€‚<br>å…·ä½“è¡¨ç°ä¸ºç»™Buttonè®¾ç½®ä¸åŒçš„èƒŒæ™¯å›¾ç‰‡ï¼Œä½†æ˜¯æ— è®ºæ€æ ·èƒŒæ™¯åªä¼šæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºæœŸæœ›çš„å›¾ç‰‡ã€‚</p>
<h2 id="0x01-åˆ†æ"><a href="/1970/01/01/[Android]DataBindingç»™Buttonè®¾ç½®èƒŒæ™¯æ— æ•ˆ/#0x01-åˆ†æ" class="headerlink" title="0x01 åˆ†æ"></a>0x01 åˆ†æ</h2><p>ç”±äºå¯¹Data Bindingä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæ‰€ä»¥å¾ˆå¥‡æ€ªä¸ºä»€ä¹ˆã€‚ä¸ç®¡æ€æ ·å…ˆæ‰“å°ä¸‹è¿™ä¸ªèµ„æºçš„å€¼ï¼Œå‘ç°åœ¨å¸ƒå±€æ–‡ä»¶ä¸­æ‰“å°èµ„æºå€¼æ˜¯æœ‰çš„ã€‚æ ¹æ®ç»éªŒï¼Œè®¾ç½®ä¸åŒçš„èƒŒæ™¯å›¾ç‰‡ï¼ŒèƒŒæ™¯ä¼šæ˜¾ç¤ºä¸åŒçš„é¢œè‰²ï¼Œé‚£è¿™ä¸ªå€¼å¯èƒ½è¢«è§£ææˆäº†é¢œè‰²å€¼ã€‚</p>
<h2 id="0x02-è§£å†³"><a href="/1970/01/01/[Android]DataBindingç»™Buttonè®¾ç½®èƒŒæ™¯æ— æ•ˆ/#0x02-è§£å†³" class="headerlink" title="0x02 è§£å†³"></a>0x02 è§£å†³</h2><p>åœ¨ç½‘ä¸Šæœäº†ä¸€ä¸‹ï¼ˆå®¹æˆ‘å¿˜è®°äº†å…·ä½“ç½‘å€ï¼‰ï¼Œéœ€è¦é€šè¿‡ä¸åŒçš„æ–¹å¼æ¥è®¾ç½®èƒŒæ™¯ï¼š<br>ä¹‹å‰çš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"200dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:onClick</span>=<span class="string">"@&#123;(view) -&gt; handler.onStartClick(view)&#125;"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"@string/button_start"</span></div><div class="line">      <span class="attr">android:textColor</span>=<span class="string">"@color/blueColor"</span></div><div class="line">      <span class="attr">android:textSize</span>=<span class="string">"@dimen/global_font_large"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"@&#123;handler.startButtonBg&#125;"</span></div><div class="line">      <span class="attr">tools:background</span>=<span class="string">"@drawable/btn_main_circle_start"</span> /&gt;</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹ä¹‹åï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"200dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:onClick</span>=<span class="string">"@&#123;(view) -&gt; handler.onStartClick(view)&#125;"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"@string/button_start"</span></div><div class="line">      <span class="attr">android:textColor</span>=<span class="string">"@color/blueColor"</span></div><div class="line">      <span class="attr">android:textSize</span>=<span class="string">"@dimen/global_font_large"</span></div><div class="line">      <span class="attr">app:backgroundResource</span>=<span class="string">"@&#123;handler.startButtonBg&#125;"</span></div><div class="line">      <span class="attr">tools:background</span>=<span class="string">"@drawable/btn_main_circle_start"</span> /&gt;</div></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯å°†ä¹‹å‰çš„ <code>android:background</code> æ¢æˆ <code>app:backgroundResource</code></p>
<h2 id="0x03-æ€»ç»“"><a href="/1970/01/01/[Android]DataBindingç»™Buttonè®¾ç½®èƒŒæ™¯æ— æ•ˆ/#0x03-æ€»ç»“" class="headerlink" title="0x03 æ€»ç»“"></a>0x03 æ€»ç»“</h2><p>æ²¡å•¥æ€»ç»“çš„ï¼ŒData Binding è¿˜æœ‰å¾ˆå¤šç­‰å¾…æ¢ç©¶ã€‚</p>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-é—®é¢˜&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android]DataBindingç»™Buttonè®¾ç½®èƒŒæ™¯æ— æ•ˆ/#0x00-é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;0x00 é—®é¢˜&quot;&gt;&lt;/a&gt;0x00 é—®é¢˜&lt;/h2&gt;&lt;p&gt;é€šè¿‡Da
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€Android Studio 2.0 NDKå¼€å‘ç¯å¢ƒæ­å»º</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5DAndroid%20Studio%202.0%20NDK%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]Android Studio 2.0 NDKå¼€å‘ç¯å¢ƒæ­å»º/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰æƒ…å›é¡¾"><a href="/1970/01/01/[Android]Android Studio 2.0 NDKå¼€å‘ç¯å¢ƒæ­å»º/#0x00-å‰æƒ…å›é¡¾" class="headerlink" title="0x00 å‰æƒ…å›é¡¾"></a>0x00 å‰æƒ…å›é¡¾</h2><p>å‰ä¸ä¹…å†™äº†ä¸€ç¯‡ç¯å¢ƒæ­å»ºï¼Œè™½ç„¶å¯ä»¥è·‘ä¸€ä¸ªdemoï¼Œä½†æ˜¯å¦‚æœä½ è·Ÿç€åšçš„è¯å°±ä¼šå‘ç°ï¼Œä»…ä»…æ˜¯å¯ä»¥è·‘ä¸€ä¸ªDemoï¼ŒçœŸåšèµ·æ¥å¾ˆæ˜¯è›‹ç–¼ã€‚ç¼–å†™æºç ï¼Œç”Ÿæˆsoï¼Œè·‘Appï¼Œæ”¹ä¸€ç‚¹ä»£ç ï¼Œå†ç”Ÿæˆsoï¼Œè·‘appã€‚è€Œä¸”ç¼–å†™ä»£ç æ²¡æœ‰æç¤ºï¼Œä¸èƒ½æ ¼å¼åŒ–ï¼Œå„ç§ä¸èƒ½ï¼Œå°±æ˜¯æœ€åŸºæœ¬çš„æ–‡æœ¬å¼€å‘ã€‚ç»è¿‡ä¸€æ®µæ—¶é—´æŠ˜è…¾å’ŒAndroid Studio 2.0çš„ releaseï¼Œå‘ç°æœ‰æ›´å®Œç¾çš„æ–¹å¼ï¼Œè€Œä¸”ä¸ç”¨ç¼–å†™Android.mkå’ŒApplication.mkã€‚çœ‹åœ¨æˆ‘åˆšå¼€å§‹å­¦çš„ä»½ä¸Šï¼Œå®¹æˆ‘å†æ¥å†™ä¸€éã€‚çœ‹å®Œè¿™ç¯‡ï¼Œä½ ä¼šå‘ç°JNIçš„å¼€å‘ä¹Ÿæ˜¯å¦‚æ­¤çš„so easyã€‚</p>
<h2 id="0x01-ç¯å¢ƒæ­å»º"><a href="/1970/01/01/[Android]Android Studio 2.0 NDKå¼€å‘ç¯å¢ƒæ­å»º/#0x01-ç¯å¢ƒæ­å»º" class="headerlink" title="0x01 ç¯å¢ƒæ­å»º"></a>0x01 ç¯å¢ƒæ­å»º</h2><p>æ‰€éœ€ç¯å¢ƒï¼š</p>
<ol>
<li>Android Studio 2.0</li>
<li>Gradle 2.10ï¼ˆæœ€ä½è¦æ±‚ï¼‰</li>
<li>NDKï¼šndk-r11cï¼ˆç›®å‰æœ€æ–°ç‰ˆï¼š2016-04-16ï¼‰</li>
<li>LLDBï¼š2.1ï¼ˆç›®å‰æœ€æ–°ç‰ˆï¼š2016-04-16ï¼‰</li>
</ol>
<p>ä¸‹é¢å¼€å§‹æ­£å¼æ“ä½œï¼š</p>
<ul>
<li><p>å®‰è£…Android Studio 2.0</p>
<p>  è¿™ä¸ªå°±ä¸ç»†è¯´äº†ã€‚</p>
</li>
<li><p>é…ç½®Gradle</p>
<p>  æœ€ä½è¦æ±‚Gradleç‰ˆæœ¬ä¸º2.10ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º2.12ã€‚ä¿®æ”¹æ–¹æ³•ï¼š</p>
<p>  <code>é¡¹ç›®æ ¹ç›®å½•/gradle/wrapper/gradle-wrapper.properties</code></p>
<p>  å°†æœ€ä¸‹é¢çš„ä¸€è¡Œæ”¹æˆä½ è¦çš„ç‰ˆæœ¬ï¼Œå¦‚ï¼š</p>
<p>  <code>distributionUrl=https\://services.gradle.org/distributions/gradle-2.10-all.zip</code></p>
</li>
<li><p>å®‰è£…NDK</p>
<p>  å®‰è£…NDKæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥ä¸‹è½½æœ€æ–°çš„NDKå®‰è£…æ–‡ä»¶è¿›è¡Œå®‰è£…ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡SDKå®‰è£…ï¼š</p>
<ol>
<li><p>NDKå®‰è£…æ–‡ä»¶</p>
<p> ä¸‹è½½å‚è€ƒ<a href="http://developer.android.com/ndk/downloads/index.html" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚æ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿä¸‹è½½ä¸åŒç‰ˆæœ¬ã€‚</p>
</li>
<li><p>é€šè¿‡SDKå®‰è£…</p>
<p> <code>Android Studio &gt; Preferences &gt; Appearance &amp; Behavior &gt; Syetem Settings &gt; Android SDK &gt; SDK Tools</code></p>
<p> åœ¨è¿™ä¸ªTabä¸­æ‰¾åˆ° <code>Android NDK</code>ï¼Œé€‰ä¸­å®‰è£…å³å¯ã€‚å®‰è£…ä¹‹åæˆ‘ä»¬å¯ä»¥åœ¨ Android SDK çš„ç›®å½•ä¸‹çœ‹åˆ°ä¸€ä¸ª <code>ndk-bundle</code> ç›®å½•ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„NDKç›®å½•ã€‚</p>
<p><img src="/1970/01/01/[Android]Android Studio 2.0 NDKå¼€å‘ç¯å¢ƒæ­å»º/image.png" alt="ndk_lldb"></p>
</li>
</ol>
</li>
<li><p>LLDB</p>
<p>  å’Œ GDB ç±»ä¼¼ï¼Œ<a href="http://lldb.llvm.org/" target="_blank" rel="external">LLDB</a>  æ˜¯ä¸€æ¬¾è°ƒè¯•å™¨ï¼Œå¯ä»¥è°ƒè¯•æˆ‘ä»¬çš„JNIä»£ç ã€‚åŒä¸Šæ‰“å¼€SDKè®¾ç½®ç•Œé¢ï¼š</p>
<p>  <code>Android Studio &gt; Preferences &gt; Appearance &amp; Behavior &gt; Syetem Settings &gt; Android SDK &gt; SDK Tools</code></p>
<p>  åœ¨è¿™ä¸ªTabä¸­æ‰¾åˆ° <code>LLDB</code>ï¼Œé€‰ä¸­å®‰è£…å³å¯ã€‚å®‰è£…ä¹‹åæˆ‘ä»¬å¯ä»¥åœ¨ Android SDK çš„ç›®å½•ä¸‹çœ‹åˆ°ä¸€ä¸ª <code>lldb</code> ç›®å½•ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„ LLDB ç›®å½•ã€‚LLDBçš„æ›´å¤šä¿¡æ¯å¯å‚è€ƒ<a href="http://lldb.llvm.org/" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
</li>
</ul>
<p>é€šè¿‡ä¸Šé¢çš„é…ç½®ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹æˆ‘ä»¬çš„JNIçš„å¼€å‘äº†ã€‚ å¯èƒ½ä½ ä¼šé—®ä¹‹å‰æˆ‘æœ‰ä»‹ç»è¿‡ä¸€ç¯‡å¼€å‘ç¯å¢ƒçš„æ­å»ºï¼Œè¿™ä¸ªæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿå¦‚æœä½ ä½¿ç”¨ä¹‹å‰çš„æ–¹æ³•ï¼Œä½ éœ€è¦é…ç½® Android.mkã€Application.mkï¼Œæ— ä»£ç è‡ªåŠ¨å®Œæˆï¼Œä¸èƒ½ä»£ç ä¸ªæ—¶å€™ï¼Œè¿è¡Œè°ƒè¯•éº»çƒ¦ï¼Œç­‰ç­‰ã€‚è¿™äº›é—®é¢˜åœ¨è¿™é‡Œéƒ½ä¸å­˜åœ¨äº†ï¼Œè®©æˆ‘ä»¬æŠŠæ›´å¤šçš„ç²¾åŠ›æ”¾åˆ°ä»£ç ç¼–å†™ä¸­ã€‚</p>
<h2 id="0x02-æµ‹è¯•Demo"><a href="/1970/01/01/[Android]Android Studio 2.0 NDKå¼€å‘ç¯å¢ƒæ­å»º/#0x02-æµ‹è¯•Demo" class="headerlink" title="0x02 æµ‹è¯•Demo"></a>0x02 æµ‹è¯•Demo</h2><p>æ–°å»ºjavaä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CipherUtils</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        System.loadLibrary(<span class="string">"CipherUtils"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç”Ÿæˆå¯¹åº”çš„C++ä»£ç ï¼š</p>
<p>ä»¤äººå…´å¥‹çš„æ˜¯ï¼ŒAndroid Studioå¯ä»¥å¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆ C ä»£ç ã€‚ç‚¹å‡» <code>add</code> æ–¹æ³•ï¼ŒOption ï¼‹ Return å³å¯ç”Ÿæˆä¸€ä¸ª <code>CipherUtils.c</code>æ–‡ä»¶ï¼Œç”±äºæˆ‘æ‰“ç®—ä½¿ç”¨C++ï¼Œå› æ­¤å°†æ‰©å±•åæ”¹ä¸º <code>cpp</code> ï¼ŒåŒæ—¶æ·»åŠ å¤´æ–‡ä»¶ï¼Œæœ€ç»ˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"utils/log.h"</span></span></div><div class="line"></div><div class="line"><span class="function">JNIEXPORT jint JNICALL <span class="title">Java_com_ttdevs_jniutils_CipherUtils_add</span><span class="params">(JNIEnv *env, jclass type, jint x, jint y)</span> </span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">input_str</span><span class="params">(<span class="string">"Test add two number!"</span>)</span></span>;</div><div class="line">    LOGE(<span class="string">"%s"</span>, input_str.c_str());</div><div class="line">    <span class="keyword">return</span> x + y;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>PSï¼šå¦‚æœæŠ¥é”™ï¼Œå¯æ˜¯å°†é”™è¯¯çš„ cppæ–‡ä»¶æ‹·è´å‡ºæ¥å†è€ƒå§å›å»ã€‚</code></p>
<p>build.gradle é…ç½®</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ......</div><div class="line">        defaultConfig &#123;</div><div class="line">        ......</div><div class="line">        ndk &#123;</div><div class="line">            moduleName <span class="string">"CipherUtils"</span></div><div class="line">            stl <span class="string">"gnustl_static"</span> <span class="comment">// stlport_static</span></div><div class="line">            abiFilters <span class="string">"armeabi"</span>, <span class="string">"armeabi-v7a"</span></div><div class="line">            ldLibs <span class="string">"log"</span>, <span class="string">"android"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">sourceSets</span>.main &#123;</div><div class="line">        <span class="comment">// å¦‚æœä¸å†™(jni.srcDirs = ['src/main/jni/'])</span></div><div class="line">        <span class="comment">// Androidå±•ç¤ºæ¨¡å¼æ²¡æœ‰jniç›®å½•</span></div><div class="line">        <span class="comment">// this file has been added after the last project sync with gradle</span></div><div class="line">        <span class="comment">// å¿…é¡»æœ‰å€¼,å¦‚: 'src/main/jni/'</span></div><div class="line">        jni.srcDirs = [<span class="string">'src/main/jni/'</span>]</div><div class="line">        <span class="comment">// jniLibs.srcDir "libs"</span></div><div class="line">    &#125;</div><div class="line">    ......</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç›´æ¥ç‚¹å‡»è¿è¡ŒæŒ‰é’®ï¼Œå³å¯è·‘æˆ‘ä»¬çš„æµ‹è¯•ç¨‹åºäº†ã€‚å°±è¿™ä¹ˆç®€å•ã€‚</p>
<h2 id="0x03-JNIå±‚çš„Debug"><a href="/1970/01/01/[Android]Android Studio 2.0 NDKå¼€å‘ç¯å¢ƒæ­å»º/#0x03-JNIå±‚çš„Debug" class="headerlink" title="0x03 JNIå±‚çš„Debug"></a>0x03 JNIå±‚çš„Debug</h2><p>è¿™ä¸ªåŒæ ·ç®€å•ã€‚é¦–å…ˆéœ€è¦åœ¨å¤–é¢çš„build.gradleä¸­é…ç½®ä¸€ä¸‹ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ......</div><div class="line">    buildTypes &#123;</div><div class="line">        debug &#123;</div><div class="line">            jniDebuggable = <span class="keyword">true</span></div><div class="line">        &#125;</div><div class="line">        ......</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨ <code>C/C++</code> æºæ–‡ä»¶ä¸Šæ·»åŠ æ–­ç‚¹ï¼Œç‚¹å‡»debugï¼Œå°±å¯ä»¥åƒdebugæˆ‘ä»¬çš„javaä»£ç ä¸€æ ·è°ƒè¯•æˆ‘ä»¬çš„åŸç”Ÿä»£ç äº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-å‰æƒ…å›é¡¾&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android]Android Studio 2.0 NDKå¼€å‘ç¯å¢ƒæ­å»º/#0x00-å‰æƒ…å›é¡¾&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰æƒ…å›é¡¾&quot;&gt;&lt;/a&gt;0x00 å‰æƒ…å›é¡¾
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€Androidä½ å¯èƒ½è¦ç”¨åˆ°çš„è‡ªå®šä¹‰Viewåˆ†äº«</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5DAndroid%E4%BD%A0%E5%8F%AF%E8%83%BD%E8%A6%81%E7%94%A8%E5%88%B0%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89View%E5%88%86%E4%BA%AB/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]Androidä½ å¯èƒ½è¦ç”¨åˆ°çš„è‡ªå®šä¹‰Viewåˆ†äº«/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-main"><a href="/1970/01/01/[Android]Androidä½ å¯èƒ½è¦ç”¨åˆ°çš„è‡ªå®šä¹‰Viewåˆ†äº«/#0x00-main" class="headerlink" title="0x00 main"></a>0x00 main</h2><p>è¿›æ­¥ã€åˆ›æ–°éƒ½æ˜¯åœ¨ä¸æ–­å˜åŒ–çš„éœ€æ±‚ä¸­è¯ç”Ÿçš„ã€‚<br>                        ï¼ï¼ By ttdevs</p>
<p>è¿™ä¸ï¼Œæ–°çš„éœ€æ±‚åˆæ¥äº†ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆä¸Šè®¾è®¡ç¨¿ï¼š</p>
<p><img src="http://img.blog.csdn.net/20160619220030319" alt="boohee design"></p>
<p>ç®€å•åˆ†æä¸Šå›¾åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šæœ€ä¸Šé¢çš„ç±»Progressbarï¼Œä¸­é—´ä¸¤ä¸ªæŒ‡ç¤ºç›˜å’Œæœ€ä¸‹é¢çš„æŒ‡ç¤ºç›˜ã€‚ç¬¬ä¸€ä¸ªç±»Progressbaræˆ‘ä»¬é¡¹ç›®ä¹‹å‰æœ‰å®ç°è¿‡ï¼Œä½†æ˜¯å’Œè¿™ä¸ªéœ€æ±‚æœ‰ä¸€äº›å·®å¼‚ï¼Œå› æ­¤å†³å®šé‡æ–°å®ç°ä¸€éã€‚å¦å¤–ä¸¤ä¸ªåœ†å½¢æŒ‡ç¤ºç›˜æœ¬æƒ³é€šè¿‡åœ¨ä¸€å¼ èƒŒæ™¯å›¾ç‰‡ä¸Šæ”¾ä¸€å¼ æŒ‡é’ˆå›¾ï¼Œæ§åˆ¶æŒ‡é’ˆå›¾çš„æ—‹è½¬æ¥å®ç°ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è¿™æ ·ä¸å¤Ÿçµæ´»ï¼Œå› æ­¤ä¹Ÿå†³å®šè‡ªå·±æ¥ç”»ã€‚Soï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å®ç°è¿™ä¸‰ä¸ªViewã€‚</p>
<p>æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œå…ˆçœ‹çœ‹æˆ‘ä»¬æœ€ç»ˆæ•ˆæœå›¾ï¼ˆå½“ç„¶ï¼ŒæŒ‡é’ˆæ˜¯å¯ä»¥åŠ¨çš„ï¼‰ï¼š</p>
<p><img src="http://img.blog.csdn.net/20160629135550259" alt="Indicator view"></p>
<h2 id="0x01-åˆ†æ"><a href="/1970/01/01/[Android]Androidä½ å¯èƒ½è¦ç”¨åˆ°çš„è‡ªå®šä¹‰Viewåˆ†äº«/#0x01-åˆ†æ" class="headerlink" title="0x01 åˆ†æ"></a>0x01 åˆ†æ</h2><ul>
<li><p>LineIndicator ï¼ˆç¬¬ä¸€ä¸ªï¼Œç±»Progressbarï¼‰</p>
<p>  ä¸»è¦åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šå·¦ä¾§çš„æç¤ºå’Œå†…å®¹ï¼Œå³ä¾§çš„æç¤ºå’Œå†…å®¹ï¼Œä¸­é—´çš„ç±»Progressbarã€‚ä¸¤ä¾§çš„æ–‡å­—æ¯”è¾ƒå®¹æ˜“å¤„ç†ï¼ŒæŒæ¡äº†æ–‡å­—çš„åŸºæœ¬ç»˜åˆ¶ï¼Œç”»èµ·æ¥æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä¸­é—´çš„ç±»Progressbarç”±äºæ‰“ç®—è‡ªå·±ç”»ï¼Œæ‰€ä»¥ä¸ä¼šç›´æ¥è´´ä¸ªProgressbaråœ¨ä¸Šé¢ã€‚æˆ‘çš„æ€è·¯æ˜¯ç”»ä¸€æ¡é•¿çš„ç›´çº¿ä½œä¸ºèƒŒæ™¯ï¼Œä¸­é—´çš„æŒ‡ç¤ºä¹Ÿæ˜¯ç›´çº¿ï¼Œæ¯”èƒŒæ™¯ç›´çº¿ç²—ï¼Œç›´çº¿çš„Paintè®¾ç½® <code>StrokeCap</code> ä¸º <code>Paint.Cap.ROUND</code> å³ <code>paint.setStrokeCap(Paint.Cap.ROUND);</code>ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰ä¸¤å¤´åŠåœ†çš„æ•ˆæœï¼›ä¸­é—´çš„æŒ‡ç¤ºæ•°å­—ç›´æ¥ç”»åœ¨ç²—çš„æŒ‡ç¤ºç›´çº¿ä¸Šé¢å³å¯ã€‚è¿™é‡Œå¯èƒ½é‡åˆ°çš„é—®é¢˜æœ‰ä¸‹é¢ä¸¤ä¸ªï¼š</p>
<ul>
<li><p><code>StrokeCap</code> è®¾ç½® ä¸º <code>Paint.Cap.ROUND</code>æ—¶çš„ä½ç½®å…³ç³»</p>
<p>  <code>StrokeCap</code> è®¾ç½® ä¸º <code>Paint.Cap.ROUND</code>ï¼Œç›´çº¿ä¸¤ä¾§çš„åŠåœ†æ˜¯ä¸ç®—åœ¨ç›´çº¿çš„é•¿åº¦é‡Œçš„ã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœviewçš„é•¿åº¦å’Œæˆ‘ç”»çš„ç›´çº¿é•¿åº¦ä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ä¸ªç›´çº¿å°±æ˜¯çŸ©å½¢è€Œä¸æ˜¯æœŸå¾…çš„ä¸¤ä¾§éƒ½æ˜¯åŠåœ†çš„æ¤­åœ†ã€‚</p>
</li>
<li><p>å½“è¿›åº¦ä¸º0æˆ–è€…ä¸º100ï¼…æ—¶çš„å±•ç¤º</p>
<p>  å¦‚æœæˆ‘ä»¬èƒŒæ™¯ç›´çº¿å’ŒæŒ‡ç¤ºç›´çº¿èµ·ç‚¹ç»ˆç‚¹ä½ç½®ä¸€è‡´ï¼Œé‚£ä¹ˆæœ€ç»ˆæ•ˆæœå°±æ˜¯å½“è¿›åº¦ä¸º0æˆ–è€…100%çš„æ—¶å€™ï¼ŒæŒ‡ç¤ºç›´çº¿æ˜¯æ˜¾ç¤ºä¸å…¨çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸¤ä¸ªä½ç½®è¿›è¡ŒçŸ«æ­£ã€‚æˆ‘çš„çŸ«æ­£æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œåœ¨0ï½xå’Œyï½100%è¿›åº¦çš„æ—¶å€™åˆ†åˆ«æ˜¾ç¤ºxå’Œyï¼ˆæœ¬ä»¥ä¸ºè‡ªå·±çš„æ€è·¯å¾ˆå±Œï¼Œåæ¥å‘ç°åˆ«äººä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„ï¼‰ã€‚</p>
</li>
</ul>
</li>
<li><p>CircleIndicator ï¼ˆä¸­é—´çš„å¤šç§é¢œè‰²ç¯ï¼‰</p>
<p>  è¿™ä¸ªViewæˆ‘å°†å…¶åˆ†è§£ä¸ºå››éƒ¨åˆ†ï¼Œä»ä¸Šå±‚åˆ°ä¸‹å±‚ï¼šä¸­é—´æŒ‡é’ˆï¼Œåˆ»åº¦ç¯ï¼Œæ˜¾ç¤ºçš„å†…å®¹ï¼Œåœ†ç¯èƒŒæ™¯å’Œå¤–å±‚æŒ‡ç¤ºæ–‡å­—ã€‚æ¯ä¸€éƒ¨åˆ†å†åšåˆ†è§£ï¼š</p>
<ul>
<li><p>ä¸­é—´æŒ‡é’ˆ</p>
<p>  è¿™ä¸ªåˆåˆ†è§£ä¸ºå…­ä¸ªéƒ¨åˆ†ï¼šæœ€ä¸‹å±‚å¤§åœ†ï¼Œä¸¤ä¸ªåœ†å½¢åŠåœ†ï¼Œä¸¤ä¸ªä¸‰è§’å½¢å’Œä¸Šå±‚å°åœ†ã€‚</p>
</li>
<li><p>åˆ»åº¦ç¯</p>
<p>  ç”±äºæ˜¯åœ†ç¯ï¼Œæ‰€ä»¥å¿…é¡»ç”»å¼§çº¿äº†ã€‚ä½†æ˜¯è¿™ä¸ªå¼§çº¿åˆæœ‰ç‚¹ç‰¹æ®Šï¼Œä¸¤ä¾§å¸¦åœ†è§’ï¼Œä¸­é—´åœ†ç¯ç›´è§’ï¼Œè¿™ä¸ªæ²¡æƒ³åˆ°å•¥å¥½åŠæ³•ï¼Œç”¨äº†å¾ˆä¸€èˆ¬çš„æ€è·¯ï¼šå…ˆç”¨ <code>Paint.Cap.ROUND</code> ç”»ä¸¤ä¾§çš„å¼§ï¼Œç„¶å <code>Paint.Style.STROKE</code> ç”»ä¸­é—´çš„éƒ¨åˆ†ã€‚</p>
</li>
<li><p>æ˜¾ç¤ºçš„å†…å®¹</p>
<p>  è¿™ä¸ªå°±æ¯”è¾ƒç®€å•äº†ï¼Œä¸»è¦åœ¨äºè®¡ç®—æ–‡å­—çš„æ˜¾ç¤ºä½ç½®ã€‚</p>
</li>
<li><p>åœ†ç¯èƒŒæ™¯å’Œå¤–å±‚æ–‡å­—</p>
<p>  æœ€ç®€å•çš„ä¸€ä¸ªåœ†ï¼ŒåŠ ä¸€ä¸ªä»¥åœ†ä¸ºè·¯å¾„ç”»çš„æ–‡å­—ã€‚</p>
</li>
</ul>
</li>
</ul>
<pre><code>æœ€åæˆ‘ä»¬ç”»çš„é¡ºåºæ­£å¥½ä¸ä¸Šé¢æ‰€è¿°é¡ºåºç›¸åã€‚
</code></pre><ul>
<li><p>ProgressIndicator ï¼ˆæœ€ä¸‹é¢çš„ä¸¤ç§é¢œè‰²ç¯ï¼‰</p>
<p>  è¿™ä¸ªç›¸è¾ƒ CircleIndicator å°±ç®€å•äº†ä¸€äº›ã€‚åœ¨ç”»åœ†ç¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆç”»ä¸€ä¸ªç°è‰²èƒŒæ™¯ï¼Œç„¶åå†ç”»ä¸€ä¸ªç»¿è‰²åœ†å¼§å³å¯ã€‚</p>
</li>
</ul>
<h2 id="0x02-å®ç°"><a href="/1970/01/01/[Android]Androidä½ å¯èƒ½è¦ç”¨åˆ°çš„è‡ªå®šä¹‰Viewåˆ†äº«/#0x02-å®ç°" class="headerlink" title="0x02 å®ç°"></a>0x02 å®ç°</h2><p>Viewçš„ç»˜åˆ¶æˆ‘ä»¬åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä¸»è¦æœ‰ä¸‹é¢ä¸‰ä¸ªè¿‡ç¨‹ï¼š onMeasureï¼ˆæµ‹é‡ï¼‰ã€onLayoutï¼ˆå¸ƒå±€ï¼‰ã€onDrawï¼ˆç»˜åˆ¶ï¼‰ã€‚é’ˆå¯¹ä¸Šè¿°ä¸‰ä¸ªViewï¼šLineIndicatorï¼Œæˆ‘ä»¬æ ¹æ®å®é™…çš„å†…å®¹æ¥è®¡ç®—Viewçš„é«˜åº¦ï¼Œå®½åº¦ç”¨æˆ·è®¾å®šï¼›CircleIndicatorå’ŒProgressIndicatorçš„å®½åº¦ç”¨æˆ·è®¾å®šï¼Œé«˜åº¦è‡ªå®šè®¡ç®—ä¸å®½åº¦ç›¸åŒã€‚onLayoutæˆ‘ä»¬ä¸éœ€è¦ã€‚æœ€åçš„æ ¹æ®å®é™…çš„å±•ç¤ºå†…å®¹æ¥ç»˜åˆ¶ã€‚</p>
<p>å¦å¤–ï¼Œç”±äºCircleIndicatorå’ŒProgressIndicatorå’Œç›¸ä¼¼åº¦é«˜ï¼Œå¾ˆå¤šä»£ç å¯ä»¥æ‹¿æ¥é‡ç”¨ï¼Œå› æ­¤ï¼Œæˆ‘å†™äº†ä¸€ä¸ªåŸºç±»æ¥å®Œæˆå…¬å…±çš„éƒ¨åˆ†ï¼Œç‰¹æ®Šéƒ¨åˆ†æ¯ä¸ª å­ç±»è‡ªå·±å®Œæˆã€‚æœ€åå†å­ç±»åœ°onDrawæ–¹æ³•ä¸­æŒ‰ç…§é¡ºåºè°ƒç”¨å³å¯ã€‚</p>
<p>ç”±äºä¸»è¦æ˜¯è®¡ç®—å„ç§åæ ‡ä½ç½®ï¼Œä»£ç è¿˜æ˜¯ä¸å°‘çš„ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç ã€‚æœ€åçš„å®ç°è¯·ç§»æ­¥æˆ‘çš„ <a href="https://github.com/ttdevs/android/tree/master/modules/indicator" target="_blank" rel="external">github</a>ã€‚ä¸‰ä¸ªViewçš„ä»£ç å·²ç»æ•´ç†å®ŒLineIndicatorï¼Œå…¶å®ƒçš„ä¸¤ä¸ªè¿˜éœ€è¦ç‚¹æ—¶é—´ï¼ˆ2016-06-19ï¼‰ã€‚</p>
<h2 id="0x03-çŸ¥è¯†ç‚¹"><a href="/1970/01/01/[Android]Androidä½ å¯èƒ½è¦ç”¨åˆ°çš„è‡ªå®šä¹‰Viewåˆ†äº«/#0x03-çŸ¥è¯†ç‚¹" class="headerlink" title="0x03 çŸ¥è¯†ç‚¹"></a>0x03 çŸ¥è¯†ç‚¹</h2><ul>
<li><p>è‡ªå®šä¹‰Viewçš„æ€è·¯</p>
<ul>
<li>åˆ›å»ºç±»ï¼Œç»§æ‰¿è‡ªViewæˆ–è€…ViewGroupæˆ–è€…å…¶å®ƒViewGroup</li>
<li>å®šä¹‰Viewçš„å¯é…ç½®å‚æ•°ï¼Œå¦‚æœä½ éœ€è¦çš„è¯</li>
<li><p>å®ç°Viewçš„å…·ä½“é€»è¾‘</p>
<p>è¿™ä¸ªå¤ªç²—ç•¥äº†ï¼Œå„ä½å¯ä»¥å‚è€ƒå…·ä½“æºç ã€‚</p>
</li>
</ul>
</li>
<li><p>æ–‡å­—ä½ç½®çš„è®¡ç®—</p>
<p>  å¦‚æœä½ æ²¡æœ‰è‡ªå·±ç”»è¿‡æ–‡å­—ï¼Œé‚£ä½ è‚¯å®šä¸å¯èƒ½ä¸€ä¸‹å­æ˜ç™½æ–‡å­—çš„ç”»æ³•ï¼Œæˆ–å¤šæˆ–å°‘çš„å‡ºç°åç§»ã€‚è¿™é‡Œç›´æ¥ç»™å¤§å®¶æ¨èä¸€ç¯‡è®²çš„éå¸¸è¯¦ç»†çš„æ–‡ç« ï¼š<a href="http://blog.csdn.net/aigestudio/article/details/41447349" target="_blank" rel="external">http://blog.csdn.net/aigestudio/article/details/41447349</a></p>
</li>
<li><p>ä½ç½®ã€åŠå¾„ã€å¼§é•¿ç­‰çš„è®¡ç®—</p>
<p>  è¿™é‡Œä¼šæ¶‰åŠåˆ°ç®€å•çš„ä¸‰è§’å‡½æ•°å’Œåœ†çš„å‘¨é•¿å¼§åº¦çš„è®¡ç®—ï¼Œå¯èƒ½è¦è¯´çš„å°±æ˜¯ä¸‰è§’å‡½æ•°çš„å‚æ•°æ˜¯å¼§åº¦åˆ¶åº¦ã€‚</p>
</li>
<li><p>ObjectAnimator</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®å†…å®¹çš„é¢œè‰²å€¼ï¼ˆéresourceçš„idï¼‰</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> contentColor å†…å®¹çš„é¢œè‰²å€¼</div><div class="line"> * <span class="doctag">@param</span> unitColor    å•ä½çš„é¢œè‰²å€¼</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentColor</span><span class="params">(<span class="keyword">int</span> contentColor, <span class="keyword">int</span> unitColor)</span> </span>&#123;</div><div class="line">    mContentColor = contentColor;</div><div class="line">    mUnitColor = unitColor;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * è®¾ç½®è¿›åº¦</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> indicator è¿›åº¦å€¼</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIndicator</span><span class="params">(<span class="keyword">float</span> indicator)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (indicator &lt;= mStartIndicator) &#123;</div><div class="line">        mIndicator = mStartIndicator;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (indicator &gt; mEndIndicator) &#123;</div><div class="line">        mIndicator = mEndIndicator;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        mIndicator = indicator;</div><div class="line">    &#125;</div><div class="line">    postInvalidate();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * è·å–è¿›åº¦</div><div class="line"> *</div><div class="line"> * <span class="doctag">@return</span> å½“å‰è¿›åº¦å€¼</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getIndicator</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> mStartIndicator;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateIndicator</span><span class="params">(<span class="keyword">float</span> indicator)</span> </span>&#123;</div><div class="line">    Interpolator interpolator = <span class="keyword">new</span> AnticipateOvershootInterpolator(<span class="number">1.8f</span>);</div><div class="line">    ObjectAnimator animation = ObjectAnimator.ofFloat(<span class="keyword">this</span>, <span class="string">"indicator"</span>, indicator);</div><div class="line">    animation.setDuration(<span class="number">2000</span>);</div><div class="line">    animation.setInterpolator(interpolator);</div><div class="line">    animation.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>å¤„ç†å±å¹•çš„æ—‹è½¬</p>
<p>  ç”±äºæ—¶é—´æ¯”è¾ƒç´§ï¼Œè¿™ä¸ªæˆ‘è¿˜æ²¡åšã€‚ä¸»è¦åœ¨Viewçš„ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ä¸­å®ç°ï¼š</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> Parcelable <span class="title">onSaveInstanceState</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> <span class="keyword">super</span>.onSaveInstanceState();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span><span class="params">(Parcelable state)</span> </span>&#123;</div><div class="line">   <span class="keyword">super</span>.onRestoreInstanceState(state);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>æœ€åæ¬¢è¿å„ä½åæ§½å¹¶æä¾›æ›´å¥½çš„å»ºè®®ï½ï½</p>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-main&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android]Androidä½ å¯èƒ½è¦ç”¨åˆ°çš„è‡ªå®šä¹‰Viewåˆ†äº«/#0x00-main&quot; class=&quot;headerlink&quot; title=&quot;0x00 main&quot;&gt;&lt;/a&gt;0x00 main&lt;/h2&gt;
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€MediaPlayerå•æ›²å¾ªç¯ä¸å¡é¡¿</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5DMediaPlayer%E5%8D%95%E6%9B%B2%E5%BE%AA%E7%8E%AF%E4%B8%8D%E5%8D%A1%E9%A1%BF/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]MediaPlayerå•æ›²å¾ªç¯ä¸å¡é¡¿/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-éœ€æ±‚"><a href="/1970/01/01/[Android]MediaPlayerå•æ›²å¾ªç¯ä¸å¡é¡¿/#0x00-éœ€æ±‚" class="headerlink" title="0x00 éœ€æ±‚"></a>0x00 éœ€æ±‚</h2><p>å•æ›²å¾ªç¯æ’­æ”¾æ­Œæ›²ï¼Œè¦æ±‚è¿‡åº¦è¿è´¯ï¼Œå¬ä¸å‡ºæ¥å¡é¡¿æ„Ÿè§‰ã€‚</p>
<h2 id="0x01-è§£å†³æ€è·¯"><a href="/1970/01/01/[Android]MediaPlayerå•æ›²å¾ªç¯ä¸å¡é¡¿/#0x01-è§£å†³æ€è·¯" class="headerlink" title="0x01 è§£å†³æ€è·¯"></a>0x01 è§£å†³æ€è·¯</h2><ol>
<li><p>MediaPlayer</p>
<p> å¯¹äºå¸¸è§çš„éŸ³ä¹æ’­æ”¾ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„åº”è¯¥å°±æ˜¯å®ƒï¼Œå®ƒæœ‰ä¸€ä¸ªæ–¹æ³•</p>
<p> <code>MediaPlayer.setLooping(true);</code></p>
<p> å°±æ˜¯ç”¨æ¥è¿›è¡Œå•æ›²å¾ªç¯çš„ã€‚ä½†æ˜¯å¾ˆé—æ†¾ï¼Œå¦‚æœä½ ç®€å•çš„è¿™ä¹ˆåšï¼Œä¸Šé¢çš„ç›®çš„æ˜¯è¾¾ä¸åˆ°çš„ï¼Œä¼šå‡ºç°ä¸Šä¸€éç»“æŸå‡ºç°ä¸€ä¸ªæ˜æ˜¾çš„åœæ­¢æ‰å¼€å§‹æ’­æ”¾ä¸‹ä¸€æ¬¡çš„ç°è±¡ã€‚</p>
<p> ä¸è¿‡æœ€åå°±æ˜¯ç”¨çš„è¿™ä¸ªç»„ä»¶ï¼Œä¸è¿‡ä¸æ˜¯ç®€å•çš„è®¾ç½® <code>setLooping(true)</code>ã€‚</p>
</li>
<li><p>SoundPool</p>
<p>ä¸€æ®µæ—¶é—´å†…å¯èƒ½ä¼šæ’­æ”¾å¾ˆå¤šéŸ³ä¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆåº”è¯¥é€‰æ‹©è¿™ä¸ªã€‚</p>
</li>
<li><p>ç¬¬ä¸‰æ–¹ç»„ä»¶</p>
<p> å¦‚æœæ²¡æœ‰ç‰¹æ®Šçš„éœ€æ±‚ï¼Œè¿™ä¸ªä¸æ˜¯é¦–é€‰ï¼Œç‰¹åˆ«æ˜¯å½“å¼•å…¥çš„ç»„ä»¶ç‰¹åˆ«é‡çš„æ—¶å€™ã€‚    </p>
</li>
</ol>
<p>å› ä¸ºä¹‹å‰è¸©è¿‡å‘ï¼šiOSä¸Šç›´æ¥æ’­æ”¾mp3æ–‡ä»¶ï¼Œå•æ›²å¾ªç¯çš„æ—¶å€™æ’­æ”¾çš„é—´éš™ç‰¹åˆ«é•¿ï¼Œå¡é¡¿çš„æ„Ÿè§‰æ— æ³•æ¥å—ï¼Œè§£å†³æ–¹æ³•æ˜¯å°†mp3è½¬æ¢æˆm4aï¼ŒåŸºæœ¬ä¸Šå¬ä¸å‡ºä¸­é—´çš„è¿‡åº¦é—´éš™ã€‚<br>é¦–å…ˆå°è¯•äº†ä½¿ç”¨ <code>MediaPlayer</code> æ¥æ’­æ”¾ï¼Œåœ¨æˆ‘çš„æœºå™¨ï¼ˆMX4 Proï¼‰ä¸Šæ’­æ”¾è¿˜å‹‰å¼ºèƒ½æ¥å—ï¼Œé—´éš™ä¸æ˜¯éå¸¸æ˜æ˜¾ï¼Œæ¢åˆ°é…ç½®å·®ä¸€ç‚¹çš„æœºå™¨ä¸Šå°±ä¸èƒ½å¿äº†ã€‚ç„¶åå°è¯•äº† <code>SoudPool</code> ï¼Œæ— è®ºæ˜¯é¢„åŠ è½½ä¸€æ¬¡å¾ªç¯æ’­æ”¾ï¼Œè¿˜æ˜¯é¢„åŠ è½½ä¸¤æ¬¡å¾ªç¯æ’­æ”¾ï¼Œä¸­é—´çš„å¡é¡¿æ„Ÿè§‰å’Œç”¨ <code>MediaPlayer.setLooping(true);</code> ä¸€æ ·ä¸€æ ·çš„ã€‚å†ç„¶åï¼Œå°è¯•macOS ä¸‹ç¼–è¯‘ <code>vlc for android</code> ï¼Œæˆ‘å¤±è´¥äº†â•®(â•¯â–½â•°)â•­ï¼‰é—®é¢˜æ€»è¦è§£å†³çš„ï¼Œå†æ‰¾å…¶ä»–åŠæ³•ã€‚</p>
<h2 id="0x02-æ­»å¾ªç¯"><a href="/1970/01/01/[Android]MediaPlayerå•æ›²å¾ªç¯ä¸å¡é¡¿/#0x02-æ­»å¾ªç¯" class="headerlink" title="0x02 æ­»å¾ªç¯"></a>0x02 æ­»å¾ªç¯</h2><p>æ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œæœ€åä½¿ç”¨ä¸€ä¸ªå¾ªç¯æ’­æ”¾çš„æ–¹æ³•è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>åˆ›å»ºç¬¬ä¸€ä¸ªæ’­æ”¾å™¨ï¼Œæ’­æ”¾ï¼›</li>
<li>åŒæ—¶åˆ›å»ºç¬¬äºŒä¸ªæ’­æ”¾å™¨ï¼Œå‡†å¤‡ï¼›</li>
<li>ç¬¬ä¸€ä¸ªæ’­æ”¾å™¨æ’­æ”¾å®Œæ¯•ç«‹é©¬å¯åŠ¨ç¬¬äºŒä¸ªï¼›</li>
<li>ç„¶ååˆ›å»ºç¬¬ä¸‰ä¸ªæ’­æ”¾å™¨ï¼Œå‡†å¤‡ï¼›</li>
<li>å¦‚æ­¤å¾€å¤ï¼Œç›´åˆ°ç”¨æˆ·åœæ­¢â€¦</li>
</ul>
<p>ç”±äºå¯¹ <code>MediaPlayer</code> æ²¡æœ‰è¿‡æ·±å…¥çš„ç ”ç©¶å’Œä½¿ç”¨ï¼Œè¿™ä¸ªæ€è·¯æ¥ä¸€æ—¶åŠä¼šè‡ªå·±è¿˜æ˜¯æƒ³ä¸å‡ºæ¥çš„ï¼ˆæ€»æ˜¯ä¼šæƒ³åªè¦åˆ›å»ºä¸€ä¸ªæ’­æ”¾å™¨å°±å¤Ÿäº†ï¼‰ã€‚è¿™ä¹ˆåšä¸‹æ¥çœŸçš„å¾ªç¯æ’­æ”¾å°±æ²¡æœ‰é—´éš™æ„Ÿäº†â€¦â€¦</p>
<p>ç”±äº <code>mPlayer.setLooping(true);</code> æ˜¯nativeæ–¹æ³•ï¼Œæ‰€ä»¥æ²¡æœ‰å»è·Ÿå…·ä½“çš„å®ç°é€»è¾‘ã€‚çŒœæµ‹å¯èƒ½æ˜¯é‡æ–°åŠ è½½æˆ–è€…å…¶ä»–åŸå› å¯¼è‡´å•æ›²å¾ªç¯ä¸­é—´é—´éš™è¾ƒå¤§ï¼ˆåŸè°…æˆ‘çš„æ‡’ï¼Œæ²¡æœ‰å»æ‹¿å¤§æ–‡ä»¶å°è¯•ï¼‰ã€‚è€Œä½¿ç”¨ä¸Šé¢çš„æ–¹å¼ï¼Œå½“æ’­æ”¾æ—¶é—´å¤§äºé¢„åŠ è½½æ—¶é—´çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªæ’­æ”¾å™¨æ’­æ”¾çš„æ—¶å€™æœ‰ç¬¬äºŒä¸ªæ’­æ”¾å™¨æœ‰å……è¶³çš„æœºä¼šå»å®ŒæˆåŠ è½½ç„¶åç­‰å¾…æ’­æ”¾ï¼ˆæ’­æ”¾æ—¶é—´å°äºåŠ è½½æ—¶é—´çš„å¯èƒ½æ€§ä¸æ˜¯å¾ˆå¤§ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> MediaPlayer mPlayer, mNextPlayer;</div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> mPlayResId = R.raw.water;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoopPlayer</span><span class="params">()</span> </span>&#123;</div><div class="line">    mPlayer = MediaPlayer.create(<span class="keyword">this</span>, mPlayResId);</div><div class="line">    mPlayer.setOnPreparedListener(<span class="keyword">new</span> MediaPlayer.OnPreparedListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPrepared</span><span class="params">(MediaPlayer mediaPlayer)</span> </span>&#123;</div><div class="line">            mPlayer.start();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    createNextMediaPlayer();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createNextMediaPlayer</span><span class="params">()</span> </span>&#123;</div><div class="line">    mNextPlayer = MediaPlayer.create(<span class="keyword">this</span>, mPlayResId);</div><div class="line">    mPlayer.setNextMediaPlayer(mNextPlayer);</div><div class="line">    mPlayer.setOnCompletionListener(<span class="keyword">new</span> MediaPlayer.OnCompletionListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</div><div class="line">            mp.release();</div><div class="line"></div><div class="line">            mPlayer = mNextPlayer;</div><div class="line"></div><div class="line">            createNextMediaPlayer();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="0x03-æ€»ç»“"><a href="/1970/01/01/[Android]MediaPlayerå•æ›²å¾ªç¯ä¸å¡é¡¿/#0x03-æ€»ç»“" class="headerlink" title="0x03 æ€»ç»“"></a>0x03 æ€»ç»“</h2><p>è¿™æ›´åƒä¸€ä¸ªå¼€è„‘æ´çš„é—®é¢˜ã€‚</p>
<h2 id="0x04-å‚è€ƒ"><a href="/1970/01/01/[Android]MediaPlayerå•æ›²å¾ªç¯ä¸å¡é¡¿/#0x04-å‚è€ƒ" class="headerlink" title="0x04 å‚è€ƒ"></a>0x04 å‚è€ƒ</h2><ul>
<li><a href="http://stackoverflow.com/questions/26274182/not-able-to-achieve-gapless-audio-looping-so-far-on-android" target="_blank" rel="external">http://stackoverflow.com/questions/26274182/not-able-to-achieve-gapless-audio-looping-so-far-on-android</a></li>
</ul>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-éœ€æ±‚&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android]MediaPlayerå•æ›²å¾ªç¯ä¸å¡é¡¿/#0x00-éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;0x00 éœ€æ±‚&quot;&gt;&lt;/a&gt;0x00 éœ€æ±‚&lt;/h2&gt;&lt;p&gt;å•æ›²å¾ªç¯æ’­æ”¾æ­Œæ›²ï¼Œè¦
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€Toobarçš„ä¸€ä¸ªç®€å•å°è£…</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5DToobar%E7%9A%84%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E5%B0%81%E8%A3%85/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]Toobarçš„ä¸€ä¸ªç®€å•å°è£…/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>Toolbarå’ŒActionBarçš„ç›´è§‚åŒºåˆ«å°±æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±å°†ToolBaråŠ åˆ°è‡ªå·±çš„å¸ƒå±€æ–‡ä»¶ä¸­ã€‚ç›®å‰çš„æƒ…å†µæ˜¯ï¼šåœ¨æˆ‘ä»¬çš„ç°æœ‰é¡¹ç›®ä¸Šæ”¹åŠ¨ï¼Œå¤šæ•°çš„Activityéƒ½æ˜¯ç»§æ‰¿ä¸€ä¸ªBaseActivityã€‚ä¸ºäº†ç”¨æœ€å°çš„ä»£ä»·è¾¾åˆ°ç›®çš„ï¼Œç®€å•çš„æ€è€ƒä¹‹åï¼Œåšäº†å¦‚ä¸‹çš„æ”¹åŠ¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * å¸¦ToolBarçš„åŸºç±»</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BASE_VIEW_ID = R.layout.activity_base;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> LayoutParams LAYOUT_PARAMS = <span class="keyword">new</span> LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT);</div><div class="line"></div><div class="line">    <span class="keyword">private</span> LinearLayout mParentView;</div><div class="line">    <span class="keyword">private</span> Toolbar mToolBar;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        ViewUtils.startTranslucent(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(BASE_VIEW_ID);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentView</span><span class="params">(<span class="keyword">int</span> layoutResID)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (BASE_VIEW_ID == layoutResID) &#123;</div><div class="line">            <span class="keyword">super</span>.setContentView(layoutResID);</div><div class="line"></div><div class="line">            mParentView = (LinearLayout) findViewById(R.id.base_parent_view);</div><div class="line">            mToolBar = (Toolbar) findViewById(R.id.toolbar);</div><div class="line">            initToolbar(mToolBar);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        mParentView.addView(getLayoutInflater().inflate(layoutResID, <span class="keyword">null</span>), LAYOUT_PARAMS);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentView</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        mParentView.addView(view, LAYOUT_PARAMS);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initToolbar</span><span class="params">(Toolbar toolbar)</span> </span>&#123;</div><div class="line">        setSupportActionBar(toolbar);</div><div class="line">        getSupportActionBar().setDisplayHomeAsUpEnabled(<span class="keyword">true</span>);</div><div class="line">        toolbar.setNavigationOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                finish();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Toolbar <span class="title">getToolBar</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mToolBar;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBackground</span><span class="params">(<span class="keyword">int</span> colorId)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mParentView) &#123;</div><div class="line">            mParentView.setBackgroundColor(getResources().getColor(colorId));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¸ƒå±€æ–‡ä»¶activity_base.xmlï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line">&lt;LinearLayout</div><div class="line">   xmlns:android="http://schemas.android.com/apk/res/android"</div><div class="line">   android:id="@+id/base_parent_view"</div><div class="line">   android:layout_width="match_parent"</div><div class="line">   android:layout_height="match_parent"</div><div class="line">   android:background="@color/global_background_status_bar"</div><div class="line">   android:fitsSystemWindows="true"</div><div class="line">   android:orientation="vertical"&gt;</div><div class="line">    </div><div class="line">   &lt;include layout="@layout/subview_toolbar"/&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>åœ¨åŸºç±»ä¸­æ·»åŠ å¦‚ä¸Šä»£ç ï¼ŒåŸºæœ¬å¯ä»¥ç”¨æœ€å°çš„æ”¹åŠ¨è¾¾åˆ°ä½¿ç”¨Toolbarçš„ç›®çš„ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ä¹Ÿå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¼šä½¿æˆ‘ä»¬çš„æ¯ä¸ªActivityçš„å¸ƒå±€å±‚æ¬¡å¤šäº†ä¸€å±‚ã€‚</p>
<p>å¦‚æœæœ‰æ›´å¥½çš„æ€è·¯ï¼Œæ¬¢è¿åˆ†äº«ï½ï½</p>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Toolbarå’ŒActionBarçš„ç›´è§‚åŒºåˆ«å°±æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±å°†ToolBaråŠ åˆ°è‡ªå·±çš„å¸ƒå±€æ–‡ä»¶ä¸­ã€‚ç›®å‰çš„æƒ…å†µæ˜¯ï¼šåœ¨æˆ‘ä»¬çš„ç°æœ‰é¡¹ç›®ä¸Šæ”¹åŠ¨ï¼Œå¤šæ•°çš„Activityéƒ½æ˜¯ç»§æ‰¿ä¸€ä¸ªBaseActivityã€‚ä¸ºäº†ç”¨æœ€å°çš„ä»£ä»·è¾¾åˆ°ç›®çš„ï¼Œç®€å•çš„æ€è€ƒä¹‹åï¼Œåšäº†å¦‚ä¸‹çš„æ”¹åŠ¨ï¼š&lt;/p&gt;
&lt;figu
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€*ä¸åŒContextåŒºåˆ«</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5D%E4%B8%8D%E5%90%8CContext%E5%8C%BA%E5%88%AB/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]ä¸åŒContextåŒºåˆ«/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">AlertDialog dialog = <span class="keyword">new</span> AlertDialog</div><div class="line">    .Builder(context)</div><div class="line">    .setTitle(title)</div><div class="line">    .setCancelable(<span class="keyword">false</span>)</div><div class="line">    .setPositiveButton(<span class="string">"ç¡®å®š"</span>, listener)</div><div class="line">    .create();</div><div class="line">dialog.show();</div></pre></td></tr></table></figure>
<p>é”™è¯¯ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">android.view.WindowManager$BadTokenException: Unable to add window -- token <span class="keyword">null</span> is not <span class="keyword">for</span> an </div><div class="line">	at android.view.ViewRootImpl.setView(ViewRootImpl.java:<span class="number">589</span>)</div><div class="line">	at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:<span class="number">326</span>)</div><div class="line">	at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:<span class="number">224</span>)</div><div class="line">	at android.view.WindowManagerImpl$CompatModeWrapper.addView(WindowManagerImpl.java:<span class="number">149</span>)</div><div class="line">	at android.app.Dialog.show(Dialog.java:<span class="number">293</span>)</div><div class="line">	at com.ttdevs.easysecuritysmartbar.StartHandler.handleMessage(StartHandler.java:<span class="number">39</span>)</div><div class="line">	at android.os.Handler.dispatchMessage(Handler.java:<span class="number">99</span>)</div><div class="line">	at android.os.Looper.loop(Looper.java:<span class="number">137</span>)</div><div class="line">	at android.app.ActivityThread.main(ActivityThread.java:<span class="number">4866</span>)</div><div class="line">	at java.lang.reflect.Method.invokeNative(Native Method)</div><div class="line">	at java.lang.reflect.Method.invoke(Method.java:<span class="number">511</span>)</div><div class="line">	at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">786</span>)</div><div class="line">	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">553</span>)</div><div class="line">	at dalvik.system.NativeStart.main(Native Method)</div></pre></td></tr></table></figure>
<p>å…¶ä¸­contextæ˜¯é€š <code>getApplicationContext()</code> è·å–çš„ï¼Œå°†å…¶æ¢æˆ <code>Activity</code> é—®é¢˜è§£å†³ã€‚</p>
<h2 id="0xFF-å‚è€ƒ"><a href="/1970/01/01/[Android]ä¸åŒContextåŒºåˆ«/#0xFF-å‚è€ƒ" class="headerlink" title="0xFF å‚è€ƒ"></a>0xFF å‚è€ƒ</h2><ol>
<li><a href="http://blog.csdn.net/lmj623565791/article/details/40481055" target="_blank" rel="external">http://blog.csdn.net/lmj623565791/article/details/40481055</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;l
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŒAndroidã€LayoutInflateé‡åˆ°çš„å‘</title>
    <link href="https://ttdevs.github.io/1970/01/01/%5BAndroid%5DLayoutInflate%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"/>
    <id>https://ttdevs.github.io/1970/01/01/[Android]LayoutInflateé‡åˆ°çš„å‘/</id>
    <published>1969-12-31T16:00:00.000Z</published>
    <updated>2017-04-27T11:07:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-é—®é¢˜"><a href="/1970/01/01/[Android]LayoutInflateé‡åˆ°çš„å‘/#0x01-é—®é¢˜" class="headerlink" title="0x01 é—®é¢˜"></a>0x01 é—®é¢˜</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initVoiceItem</span><span class="params">()</span> </span>&#123;</div><div class="line">    viewMusicList.removeAllViews();</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> localResource = SysPreferences.getAlarmVoiceResource();</div><div class="line">    LayoutInflater inflater = LayoutInflater.from(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; VOICE_KEY.length; i++) &#123;</div><div class="line">        View view = inflater.inflate(R.layout.item_voice_name, viewMusicList); <span class="comment">// <span class="doctag">TODO:</span> 2017/2/10</span></div><div class="line">        view.setOnClickListener(mClickListener);</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> View.OnClickListener mClickListener = <span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> size = viewMusicList.getChildCount();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">            View view = viewMusicList.getChildAt(i);</div><div class="line">            ...</div><div class="line">            <span class="keyword">if</span> (v == view) &#123;</div><div class="line">                &#123;...<span class="number">1</span>...&#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                &#123;...<span class="number">2</span>...&#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>æœ‰ä¸Šé¢ä¸€ä¸²ä»£ç ï¼Œä½ èƒ½å‘ç°æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</p>
<p>å—¯å—¯ï¼Œæ˜¯è¿™æ ·çš„ï¼šåªä¼šæ‰§è¡Œä»£ç å—{1}ï¼Œå¹¶æ²¡æœ‰åƒæˆ‘ä»¬æœŸå¾…çš„é‚£æ ·ç‚¹å‡»çš„æ—¶å€™æ‰§è¡Œåˆ°ä»£ç å—{2}ä¸­å»ã€‚æ²¡æœ‰ç»†ç©¶ï¼Œé€šè¿‡ä¸‹é¢çš„ä»£ç ç›´æ¥è·¨è¿‡å»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initVoiceItem</span><span class="params">()</span> </span>&#123;</div><div class="line">   viewMusicList.removeAllViews();</div><div class="line">   </div><div class="line">   <span class="keyword">int</span> localResource = SysPreferences.getAlarmVoiceResource();</div><div class="line">   LayoutInflater inflater = LayoutInflater.from(<span class="keyword">this</span>);</div><div class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; VOICE_KEY.length; i++) &#123;</div><div class="line">       View view = inflater.inflate(R.layout.item_voice_name, <span class="keyword">null</span>); <span class="comment">// <span class="doctag">TODO:</span> 2017/2/10</span></div><div class="line">       view.setOnClickListener(mClickListener);</div><div class="line">       ...</div><div class="line">       viewMusicList.addView(view);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è™½ç„¶ä¸çŸ¥é“ä»€ä¹ˆåŸå› ï¼Œä½†æ˜¯æ‰¾åˆ°è§£å†³åŠæ³•ï¼Œä¸è¿‡è¿˜æ˜¯æŒºæƒ­æ„§çš„Â·Â·Â·Â·Â·Â·</p>
<h2 id="0x02-åˆ†æ"><a href="/1970/01/01/[Android]LayoutInflateé‡åˆ°çš„å‘/#0x02-åˆ†æ" class="headerlink" title="0x02 åˆ†æ"></a>0x02 åˆ†æ</h2><p>å¾ˆå¤šäººå¯èƒ½è·Ÿæˆ‘ä¸€æ ·ï¼Œå¼€å§‹å­¦çš„æ—¶å€™ï¼Œè®°ä½è¯¥æ€ä¹ˆå†™ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¹²å˜›çš„ã€‚ä½†æ˜¯å¾ˆéš¾é¿å…ä¼šè®°é”™æŸä¸ªæ–¹æ³•ï¼Œå°±åƒæˆ‘ä»¬ä¼šå†™é”™æŸä¸ªå­—ä¸€æ ·ï¼Œå½“åˆ«äººçº æ­£çš„æ—¶å€™æ‰çŸ¥é“ï¼Œè¿™ä¸ªå­—è‡ªå·±å·²ç»å†™é”™åå‡ æ´»ç€å‡ åå¹´äº†ã€‚æ¥çœ‹ä¸€ä¸‹ <code>View.inflate()</code> è¿™ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* Inflate a new view hierarchy from the specified xml resource. Throws</div><div class="line">* &#123;<span class="doctag">@link</span> InflateException&#125; if there is an error.</div><div class="line">* </div><div class="line">* <span class="doctag">@param</span> resource ID for an XML layout resource to load (e.g.,</div><div class="line">*        &lt;code&gt;R.layout.main_page&lt;/code&gt;)</div><div class="line">* <span class="doctag">@param</span> root Optional view to be the parent of the generated hierarchy.</div><div class="line">* <span class="doctag">@return</span> The root View of the inflated hierarchy. If root was supplied,</div><div class="line">*         this is the root View; otherwise it is the root of the inflated</div><div class="line">*         XML file.</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> View <span class="title">inflate</span><span class="params">(@LayoutRes <span class="keyword">int</span> resource, @Nullable ViewGroup root)</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> inflate(resource, root, root != <span class="keyword">null</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬ä¼ å…¥äº† <code>root</code> Viewï¼Œé‚£ä¹ˆè¿”å›çš„å°±æ˜¯root Viewï¼Œ å¦‚æœä¸ä¼ ï¼Œåˆ™è¿”å›æ ¹æ®å¸ƒå±€æ–‡ä»¶ç”Ÿæˆçš„ Viewã€‚è€Œæ ¹æ®æˆ‘ä¸Šé¢çš„ä»£ç ï¼Œæ˜¾ç„¶è¢«æˆ‘é”™è¯¯çš„ç†è§£ï¼Œæ— è®ºä¼ ä¸ä¼  <code>root</code> Viewï¼Œè¿”å›çš„éƒ½æ˜¯æ ¹æ®å¸ƒå±€æ–‡ä»¶ç”Ÿæˆçš„ Viewï¼Œè€Œæˆ‘å°±è¿™ä¹ˆç›¸å®‰æ— äº‹çš„ç”¨äº†å¥½å‡ å¹´Â·Â·Â·Â·Â·Â·</p>
<h2 id="0x03-ä½ ä»¥ä¸ºè¿™å°±è¿™æ ·ç»“æŸäº†"><a href="/1970/01/01/[Android]LayoutInflateé‡åˆ°çš„å‘/#0x03-ä½ ä»¥ä¸ºè¿™å°±è¿™æ ·ç»“æŸäº†" class="headerlink" title="0x03 ä½ ä»¥ä¸ºè¿™å°±è¿™æ ·ç»“æŸäº†"></a>0x03 ä½ ä»¥ä¸ºè¿™å°±è¿™æ ·ç»“æŸäº†</h2><p>å¦‚æœä½ æ‰§è¡Œæˆ‘çš„é”™è¯¯ä»£ç ï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢è¿™ä¸ªå›¾ï¼š</p>
<p><img src="http://img.blog.csdn.net/20170212223305559?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHRkZXZz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>è¿™ä¸ªè¿™ä¸ªå›¾æœ‰ä¸¤ä¸ªä¿¡æ¯ï¼š</p>
<ul>
<li>åé¢å‡ ä¸ªItemæ˜¾ç¤ºçš„åç§°æ˜¯é”™è¯¯çš„</li>
<li>ç‚¹å‡»æŸä¸ªItemï¼Œå…¶ä»–å‡ ä¸ªItemçš„checkboxä¹Ÿè¢«é€‰æ‹©</li>
</ul>
<p>æˆ‘ä»¬æŒ‰ç…§é”™è¯¯çš„ä»£ç æ‰§è¡Œçš„é€»è¾‘è¿›è¡Œåˆ†æã€‚é¦–å…ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; VOICE_KEY.length; i++) &#123;</div><div class="line">  View view = inflater.inflate(R.layout.item_voice_name, viewMusicList);</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ä¼šå¾ªç¯å¤šæ¬¡ï¼Œå°†inflateåçš„å¸ƒå±€æ·»åŠ åˆ°viewMusicListï¼Œè¿™æ ·viewMusicListä¸‹é¢å°±æœ‰å¤šä¸ª <code>item_voice_name</code> å› æ­¤æœ€ç»ˆç»™æˆ‘ä»¬å±•ç°çš„ç»“æœå°±æ˜¯çœ‹åˆ°æœ‰å¤šä¸ªItemã€‚</p>
<p>å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä» <code>view.findViewById()</code> è¯´èµ·ï¼Œä»Viewä¸­ä½ ä¼šå‘ç°è¿™ä¸¤æ®µä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* Look for a child view with the given id.  If this view has the given</div><div class="line">* id, return this view.</div><div class="line">*</div><div class="line">* <span class="doctag">@param</span> id The id to search for.</div><div class="line">* <span class="doctag">@return</span> The view that has the given id in the hierarchy or null</div><div class="line">*/</div><div class="line"><span class="meta">@Nullable</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> View <span class="title">findViewById</span><span class="params">(@IdRes <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">   <span class="keyword">if</span> (id &lt; <span class="number">0</span>) &#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> findViewTraversal(id);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">* &#123;<span class="doctag">@hide</span>&#125;</div><div class="line">* <span class="doctag">@param</span> id the id of the view to be found</div><div class="line">* <span class="doctag">@return</span> the view of the specified id, null if cannot be found</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">protected</span> View <span class="title">findViewTraversal</span><span class="params">(@IdRes <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">   <span class="keyword">if</span> (id == mID) &#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ˜¯ä¸æ˜¯å¤ªç®€å•ï¼Œæ ¹æœ¬æ²¡æ‰¾åˆ°æˆ‘ä»¬æœŸå¾…çš„é€»è¾‘â€”â€”ViewGroupä¸­æ€ä¹ˆå¤„ç†ï¼Œç»†å¿ƒçš„ä½ ä¼šå‘ç°ViewGroupé‡å†™äº† <code>findViewTraversal()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> View <span class="title">findViewTraversal</span><span class="params">(@IdRes <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">   <span class="keyword">if</span> (id == mID) &#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="keyword">final</span> View[] where = mChildren;</div><div class="line">   <span class="keyword">final</span> <span class="keyword">int</span> len = mChildrenCount;</div><div class="line"></div><div class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">       View v = where[i];</div><div class="line"></div><div class="line">       <span class="keyword">if</span> ((v.mPrivateFlags &amp; PFLAG_IS_ROOT_NAMESPACE) == <span class="number">0</span>) &#123;</div><div class="line">           v = v.findViewById(id);</div><div class="line"></div><div class="line">           <span class="keyword">if</span> (v != <span class="keyword">null</span>) &#123;</div><div class="line">               <span class="keyword">return</span> v;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»è¿™æ®µä»£ç å¯ä»¥çœ‹å‡ºï¼Œåœ¨ViewGroupä¸­æ ¹æ®IDæŸ¥æ‰¾ï¼Œæ‰¾åˆ°å°±è¿”å›ï¼Œè€Œæ‰¾åˆ°çš„æ°¸è¿œæ˜¯æœ€å‰é¢çš„Viewã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªItemå’Œå…¶ä»–çš„ä¸åŒäº†ã€‚</p>
<p>ï¼ˆå¯¹äºç‚¹å‡»æŸä¸ªItemï¼Œå…¶ä»–Itemä¹Ÿå‡ºç°æ³¢çº¹æ•ˆæœï¼ŒçŒœæµ‹å¯èƒ½æ˜¯å› ä¸ºæ³¢çº¹æ•ˆæœæ˜¯æ ¹æ®IDæ¥å®ç°çš„ã€‚TODO ï¼‰</p>
<h2 id="0x04-æ€»ç»“"><a href="/1970/01/01/[Android]LayoutInflateé‡åˆ°çš„å‘/#0x04-æ€»ç»“" class="headerlink" title="0x04 æ€»ç»“"></a>0x04 æ€»ç»“</h2><p>ä¸Šé¢é‡åˆ°çš„View inflateæ˜¯æˆ‘ä¸ªäººé‡åˆ°çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºå¯¹åŸºç¡€çŸ¥è¯†æŒæ¡æœ‰é—®é¢˜ã€‚å¦å¤–åœ¨ä½¿ç”¨inflateçš„æ—¶å€™ï¼Œå¯èƒ½è¿˜ä¼šé‡åˆ°LayoutParamè®¾ç½®æ— æ•ˆçš„é—®é¢˜ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡å¥—ä¸€ä¸ªViewçš„æ–¹å¼è§£å†³ï¼Œä»…æ­¤è®°å½•ã€‚ </p>
<p><img src="https://raw.githubusercontent.com/ttdevs/ttdevs.github.io/common/images/logo.png" alt="Create by ttdevs"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x01-é—®é¢˜&quot;&gt;&lt;a href=&quot;/1970/01/01/[Android]LayoutInflateé‡åˆ°çš„å‘/#0x01-é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;0x01 é—®é¢˜&quot;&gt;&lt;/a&gt;0x01 é—®é¢˜&lt;/h2&gt;&lt;figure class=
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://ttdevs.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://ttdevs.github.io/tags/Android/"/>
    
  </entry>
  
</feed>
